"use strict";(self.webpackChunksc_tbm=self.webpackChunksc_tbm||[]).push([[9911],{85746:(e,r,t)=>{t.d(r,{X:()=>b});var s=t(35143),i=t(91967),o=t(5632),a=t(46053),c=(t(81806),t(76460),t(47249),t(85842)),u=t(57662),n=t(57824),d=t(44513);class h{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=u.O7.Outline}destroy(){this._destroyResources()}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){var r;this._renderGroup=e;const t=null===(r=this._resources)||void 0===r?void 0:r.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){var e;this._destroyResources();const r=this._resourceFactory.createResources(),t=new l({view:this._resourceFactory.view,renderGroup:this._renderGroup}),s=null===(e=this._resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;this._resources={layerView:new l({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:r,geometriesAdded:!1},s&&(this._resources.drapeSourceRenderer=s.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){var e;if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const r=null===(e=this._resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;r&&r.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,n.q.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,n.q.UPDATE),this._resources.geometriesAdded=!0))}}let l=class extends((0,o.sA)(i.A)){constructor(e){super(e),this.drapeSourceType=u.Om.Features,this.updatePolicy=d.q.SYNC,this.renderGroup=u.O7.Outline}};(0,s._)([(0,a.MZ)({constructOnly:!0})],l.prototype,"view",void 0),(0,s._)([(0,a.MZ)({readOnly:!0})],l.prototype,"drapeSourceType",void 0),(0,s._)([(0,a.MZ)()],l.prototype,"renderGroup",void 0),l=(0,s._)([(0,c.$)("DrapedVisualElementLayerView")],l);var _=t(69230),p=t(68134),y=t(87634),m=t(37046),v=t(8918);class R{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(null==this._resources||!e)return;const r=this._resources.object;this._resources.external.forEach((r=>{r.type!==y.X.Mesh&&r.type!==y.X.Line&&r.type!==y.X.Point||e.remove(r)})),r.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,r,this._resources.layer),this._resources.external.forEach((r=>{r.type!==y.X.Mesh&&r.type!==y.X.Line&&r.type!==y.X.Point||e.add(r)}))}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,r=e.view,t=r._stage;if(!t)return;const s=new v.x(t,{pickable:!1,updatePolicy:d.q.SYNC}),i=new m.B({castShadow:!1}),o=e.createResources(i,s);o.forEach((e=>{t.add(e),e.type===y.X.Texture&&e.load(t.renderView.renderingContext)})),t.add(i),s.add(i);const a=e.cameraChanged,c=a?(0,p.wB)((()=>r.state.camera),(e=>a(e)),p.Vh):null;this._resources={layer:s,object:i,external:o,cameraHandle:c},this._syncVisible()}_destroyResources(){var e;if(null==this._resources)return;const r=this._resourceFactory.view._stage;r&&(r.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach((e=>{r.remove(e),e.type===y.X.Texture&&e.unload()}))),this._resources.object.dispose(),null!==(e=this._resources.cameraHandle)&&void 0!==e&&e.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class b extends _.B{constructor(e){var r;super(e),this._isDraped=!1,this.object3dResources=new R(this.createObject3DResourceFactory(e.view)),this.drapedResources=new h(this.createDrapedResourceFactory(e.view)),this.isDraped=null!==(r=e.isDraped)&&void 0!==r&&r}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}},47996:(e,r,t)=>{t.d(r,{n:()=>D});var s=t(68134),i=t(34761),o=t(13191),a=t(20664),c=t(9392),u=t(43047),n=t(55855),d=t(75762),h=t(18117),l=t(85746),_=t(33169),p=t(50468),y=t(51799),m=t(62577),v=t(45463),R=t(442),b=t(66470),g=t(76956),G=t(425);class D extends l.X{constructor(e){super(e),this._maxSize=0,this._position=(0,c.vt)(),this._up=(0,c.vt)(),this._right=(0,c.vt)(),this._renderOccluded=v.m$.OccludeAndTransparent,this._color=(0,n.fA)(1,0,0,1),this._outlineColor=(0,n.fA)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=v.m$.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e)}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,u.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,u.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const r=0===this._outlineSize!=(0===e);this._outlineSize=e,r?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry(e){let{previous:r,center:t,next:s}=e;this._maxSize=Math.min((0,a.q)(t,r),(0,a.q)(t,s))/3,(0,a.n)(this._up,(0,a.f)(this._up,r,t)),(0,a.n)(this._right,(0,a.f)(this._right,s,t)),(0,a.c)(this._position,t),this.recreateGeometry()}_createObject3DResources(e){const r=new g.v(this._quadMaterialParameters),t=0===this._outlineSize?void 0:new G.W(this._outlineMaterialParameters);return this._createObject3DGeometries(e,r,t),{quadMaterial:r,outlineMaterial:t,forEach:e=>{e(r),t&&e(t)}}}_createObject3DGeometries(e,r,t){if((0,a.j)(this._up,c.uY)&&(0,a.j)(this._right,c.uY))return;const s=this._createGeometries(r,t);for(const i of s)e.addGeometry(i);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new g.v(this._quadMaterialParameters),r=0===this._outlineSize?void 0:new G.W(this._outlineMaterialParameters),t=this._createGeometries(e,r).map((e=>new R.$(e)));return this._setTransformDraped(t),{quadMaterial:e,outlineMaterial:r,geometries:t,pixelRatioHandle:(0,s.wB)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}))}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_createGeometries(e,r){const{up:t,right:s,corner:i}=this._getVertices(),o=this._quadGeometryData(t,s,i,e);return r?[o,(0,m.Z8)(r,[t,i,s])]:[o]}_getVertices(){let e=this._up,r=this._right;const t=(0,a.g)(d.rq.get(),e,r);return this.isDraped&&(e=(0,a.c)(d.rq.get(),e),r=(0,a.c)(d.rq.get(),r),e[2]=0,r[2]=0,t[2]=0),{up:e,right:r,corner:t}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object3dResources.object;if(!e)return;const r=this.view.state.camera,t=this._size*r.computeScreenPixelSizeAt(this._position),s=Math.min(this._maxSize,t);(0,i.kN)(O,this._position),(0,i.hs)(O,O,[s,s,s]),e.transformation=O}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:r},state:{contentPixelRatio:t}}}=this,{_position:s,_size:o}=this,c=(0,a.c)(d.rq.get(),s);c[2]=_.bi;const u=f;u.spatialReference=r.renderer.spatialReference,u.x=c[0],u.y=c[1];const n=o*(this.view.overlayPixelSizeInMapUnits(u)*t),h=Math.min(this._maxSize,n);(0,i.kN)(O,c),(0,i.hs)(O,O,[h,h,1]);for(const i of e)i.transformation=O}_quadGeometryData(e,r,t,s){return new y.V(s,[[b.r.POSITION,new p.n([0,0,0,...r,...e,...t],[0,1,2,1,2,3],3,!0)]])}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){var e,r;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.quadMaterial.setParameters(this._quadMaterialParameters),null===(r=this.drapedResources.resources)||void 0===r||r.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){var e,r;null!==(e=this.object3dResources.resources)&&void 0!==e&&null!==(e=e.outlineMaterial)&&void 0!==e&&e.setParameters(this._outlineMaterialParameters),null===(r=this.drapedResources.resources)||void 0===r||null===(r=r.outlineMaterial)||void 0===r||r.setParameters(this._outlineMaterialParameters)}}const O=(0,o.vt)(),f=(0,h.T)(0,0,void 0,null)},17072:(e,r,t)=>{t.d(r,{QO:()=>n,XG:()=>d,jq:()=>h});var s=t(76931),i=t(19555),o=t(20664),a=t(9392),c=t(18117),u=t(12482);function n(e,r,t,s){t.projectToRenderScreen(e,p),t.projectToRenderScreen(r,y),(0,i.Re)(s,y,p),(0,i.S8)(s,s)}function d(e,r,t,s){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,a.vt)();const c=(0,o.c)(_,e);return c[2]=(0,u.xS)(s,c,r,t)||0,s.renderCoordsHelper.toRenderCoords(c,r,i),i}function h(e,r,t,i){return"2d"===i.type?(l.x=e[0],l.y=e[1],l.spatialReference=r,i.toScreen(l)):(d(e,r,t,i,_),i.state.camera.projectToScreen(_,m),(0,s.tc)(m[0],m[1]))}const l=(0,c.T)(0,0,0,null),_=(0,a.vt)(),p=(0,s.QG)(),y=(0,s.QG)(),m=(0,s.gs)()},90659:(e,r,t)=>{t.d(r,{M:()=>o,U:()=>a});var s=t(7137),i=t(80963);function o(e,r,t,o){for(var a=arguments.length,c=new Array(a>4?a-4:0),u=4;u<a;u++)c[u-4]=arguments[u];return(0,i.EA)(e)&&(0,s.TT)(e)?r.apply(void 0,c):(0,i.K8)(e)?t.apply(void 0,c):o.apply(void 0,c)}const a=1e5}}]);
//# sourceMappingURL=9911.7a06530d.chunk.js.map