"use strict";(self.webpackChunksc_tbm=self.webpackChunksc_tbm||[]).push([[9565],{28608:(e,t,i)=>{function r(){return new Float32Array(4)}function n(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(e,t,i,r){const n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function o(){return r()}function a(){return s(1,1,1,1)}function l(){return s(1,0,0,0)}function d(){return s(0,1,0,0)}function c(){return s(0,0,1,0)}function u(){return s(0,0,0,1)}i.d(t,{fA:()=>s,o8:()=>n});const h=o(),p=a(),f=l(),g=d(),_=c(),v=u();Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_W:v,UNIT_X:f,UNIT_Y:g,UNIT_Z:_,ZEROS:h,clone:n,create:r,createView:function(e,t){return new Float32Array(e,t,4)},fromValues:s,ones:a,unitW:u,unitX:l,unitY:d,unitZ:c,zeros:o},Symbol.toStringTag,{value:"Module"}))},46530:(e,t,i)=>{function r(e){var t;const i=e.layer;return"floorInfo"in i&&null!==(t=i.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?s(e.view.floors,i.floorInfo.floorField):null}function n(e,t){var i;return"floorInfo"in t&&null!==(i=t.floorInfo)&&void 0!==i&&i.floorField?s(e,t.floorInfo.floorField):null}function s(e,t){if(null===e||void 0===e||!e.length)return null;const i=e.filter((e=>""!==e)).map((e=>"'".concat(e,"'")));return i.push("''"),"".concat(t," IN (").concat(i.join(","),") OR ").concat(t," IS NULL")}i.d(t,{E:()=>r,f:()=>n})},3233:(e,t,i)=>{i.d(t,{s:()=>te});var r=i(69539),n=i(59784),s=(i(81806),i(54901)),o=i(20664),a=i(9392),l=i(14487),d=i(12482),c=i(43047),u=i(28608),h=i(49595),p=i(4763),f=i(44230),g=i(95925),_=i(85746),v=i(99469),y=i(33169),m=i(62577),S=i(45463),w=i(442),E=i(66470),x=i(425);class b extends _.X{constructor(e){super(e),this._ray=(0,g.vt)(),this._isWorldDown=!1,this._start=(0,a.vt)(),this._end=(0,a.fA)(1,0,0),this._width=1,this._color=(0,u.fA)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,u.fA)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=P.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=S.m$.OccludeAndTransparent,this._fadedExtensions=M,this._laserline=new v.o({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,o.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,o.f)(this._end,e,this._end),(0,g.Cr)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,o.j)(this._start,e)||((0,o.c)(this._start,e),(0,g.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,o.j)(this._end,e)||((0,o.c)(this._end,e),(0,g.Cr)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,c.a)(e,this._color)||((0,c.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,c.a)(e,this._innerColor)||((0,c.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){null!=e&&null!=this._stippleOffColor&&(0,c.a)(e,this._stippleOffColor)||(this._stippleOffColor=null!=e?(0,u.o8)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===S.m$.OccludeAndTransparentStencil?S.m$.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=null!==e&&void 0!==e?e:M,this.recreateGeometry()}_updateMaterial(){var e,t;const{materialParameters:i}=this;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(i),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(i)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new x.W(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_destroyExternalResources(e){e.geometries=[]}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const r=this._createGeometry(e);i.push(r),t.addGeometry(r),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new x.W(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);return this._updateVerticesDraped(t),new w.$(t)}_createGeometry(e){const t=this.extensionType===P.FADED,i=t?[(0,a.vt)(),(0,a.vt)(),(0,a.vt)(),(0,a.vt)()]:[(0,a.vt)(),(0,a.vt)()];return(0,m.Z8)(e,i,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===P.FADED?this._updateLineSegmentFinite(D):this._updateLineSegmentInfinite(this._extensionType,D)}_updateLineSegmentFinite(e){return(0,f.Cr)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch((0,h.$e)(this._ray,R),e){case P.LINE:R.c0=-Number.MAX_VALUE;break;case P.RAY:case P.GROUND_RAY:{var r;const e=this._ray.origin,t=null!==(r=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"))&&void 0!==r?r:0,i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&(0,o.F)(R.ray.direction,R.ray.direction),this._extensionType===P.GROUND_RAY&&null!=t&&(R.c1=Math.abs(i-t));break}}if(!(0,p.ig)(i.frustum,R))return this._updateLineSegmentFinite(t);const n=(0,h.j1)(R,C),s=(0,h.mO)(R,O);return(0,f.Cr)(n,s,t)}_updateVertexAttributesObject3D(e,t){var i;const r=null===(i=e.geometries[0].getMutableAttribute(E.r.POSITION))||void 0===i?void 0:i.data;if(!r)return;let n=0;for(const s of this._lineVertices(t))r[n++]=s[0],r[n++]=s[1],r[n++]=s[2];e.geometryVertexAttributeUpdated(e.geometries[0],E.r.POSITION)}_updateVertexAttributesDraped(e,t){var i;const r=null===(i=e.getMutableAttribute(E.r.POSITION))||void 0===i?void 0:i.data;if(!r)return;let n=0;for(const s of this._lineVertices(t))r[n++]=s[0],r[n++]=s[1],r[n++]=y.bi;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===P.FADED?(yield(0,f.sd)(e,-this.fadedExtensions.start,C),yield(0,f.sd)(e,0,C),yield(0,f.sd)(e,1,C),yield(0,f.sd)(e,1+this.fadedExtensions.end,C)):(yield(0,f.sd)(e,0,C),yield(0,f.sd)(e,1,C))}}const R=(0,h.vt)(),C=(0,a.vt)(),O=(0,a.vt)(),D=(0,f.vt)();var P;!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(P||(P={}));const T=1/3,M={start:T,end:T};var A=i(68134),L=i(76931),F=i(19555),V=i(72745),G=i(18117);class I extends _.X{constructor(e){super(e),this._location=(0,a.vt)(),this._direction=(0,a.fA)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,u.fA)(1,0,1,1),this._renderOccluded=S.m$.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyObject3DResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}get location(){return this._location}set location(e){(0,o.j)(this._location,e)||((0,o.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,o.j)(this._direction,e)||((0,o.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,o.n)(this._direction,(0,o.f)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,c.a)(e,this._color)||((0,c.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new x.W(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_destroyObject3DResources(e){e.geometries.length=0}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const[r,n]=this._createGeometries(e);t.addGeometry(r),t.addGeometry(n),i.push(r),i.push(n),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new x.W(this.materialParameters),t=(0,A.wB)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}));return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=this._createGeometries(e);return this._updateVerticesDraped(t),t.map((e=>new w.$(e)))}_createGeometries(e){return[(0,m.Z8)(e,[(0,a.vt)(),(0,a.vt)()]),(0,m.Z8)(e,[(0,a.vt)(),(0,a.vt)()])]}_updateMaterial(){var e,t;const{materialParameters:i}=this;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(i),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(i)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,q),(0,o.g)(j,this.location,this.direction),t.projectToScreen(j,Z),(0,F.S8)(Z,(0,F.Re)(Z,Z,q)),this._updateVertexAttributesObject3D(t,e,0,q,Z,1),this._updateVertexAttributesObject3D(t,e,1,q,Z,-1)}_updateVertexAttributesObject3D(e,t,i,r,n,s){var o;const a=t.geometries[i],l=null===(o=a.getMutableAttribute(E.r.POSITION))||void 0===o?void 0:o.data;if(!l)return;const{start:d,end:c}=this._computeStartEnd(n,r,s,this.offset,this.width,this.length);e.unprojectFromScreen((0,L.PR)(d),j),l[0]=j[0],l[1]=j[1],l[2]=j[2],e.unprojectFromScreen((0,L.PR)(c),j),l[3]=j[0],l[4]=j[1],l[5]=j[2],t.geometryVertexAttributeUpdated(a,E.r.POSITION)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{location:r,width:n,length:s,offset:o}=this,a=X;a.spatialReference=t.renderer.spatialReference,a.x=r[0],a.y=r[1];const l=this.view.overlayPixelSizeInMapUnits(a)*i,d=n*l,c=s*l,u=o*l;this._updateVertexAttributesDraped(e[0],d,c,u,-1),this._updateVertexAttributesDraped(e[1],d,c,u,1)}_updateVertexAttributesDraped(e,t,i,r,n){var s;const o=null===(s=e.getMutableAttribute(E.r.POSITION))||void 0===s?void 0:s.data;if(!o)return;const{location:a,direction:l}=this,{start:d,end:c}=this._computeStartEnd(l,a,n,r,t,i);o[0]=d[0],o[1]=d[1],o[2]=y.bi,o[3]=c[0],o[4]=c[1],o[5]=y.bi,e.invalidateBoundingInfo()}_computeStartEnd(e,t,i,r,n,s){const o=(0,F.hs)(N,(0,F.hZ)(N,e[1]*i,e[0]*-i),r+n/2),a=(0,F.WQ)(z,(0,F.WQ)(z,(0,F.WQ)(z,t,(0,F.hs)(z,e,s/2)),o),o);return{start:a,end:(0,F.WQ)(H,a,(0,F.hs)(H,e,-s))}}}const j=(0,a.vt)(),N=(0,V.vt)(),z=(0,V.vt)(),H=(0,V.vt)(),q=(0,L.gs)(),Z=(0,L.gs)(),X=(0,G.T)(0,0,void 0,null);var W=i(83574),U=i(47996),k=i(57662),$=i(23862),Q=i(63078),B=i(99791),Y=i(9730),J=i(14727),K=i(23543),ee=i(17072);class te extends J.b{sortUniqueHints(e){return e.sort(((e,t)=>(t instanceof K.c?t.length:0)-(e instanceof K.c?e.length:0)))}visualizeIntersectionPoint(e,t){const{spatialReference:i,view:r}=t,n=ie(t);return(0,s.DQ)(new W.l({view:r,primitive:"circle",geometry:(0,$.io)(e.intersectionPoint,i),elevationInfo:e.isDraped?d.Tq:d.qt,size:20,outlineSize:2,color:n.intersectionPointColor,outlineColor:n.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){const{view:i,spatialReference:r}=t,n=ie(t),o=re(e.point,e.domain,t);return(0,s.DQ)(new W.l({view:i,primitive:"circle",geometry:(0,$.io)(o,r),elevationInfo:ne(e,t),size:20,outlineSize:2,color:n.pointColor,outlineColor:n.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){const{view:i,spatialReference:r}=t,n=ie(t),o=re(e.lineStart,e.domain,t),a=re(e.lineEnd,e.domain,t);return(0,s.DQ)(this._createLineSegmentHint(e.type,o,a,r,ne(e,t),i,n,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:i,spatialReference:r}=t,n=ie(t),{isDraped:a}=e,l=ne(e,t),d=re(e.lineStart,e.domain,t),c=re(e.lineEnd,e.domain,t),u=oe(d,r,l,i,a),h=oe(c,r,l,i,a),p=(0,o.m)(h,u,h,.5),f=new I({view:i,attached:!1,offset:Q.N.parallelLineHintOffset,length:Q.N.parallelLineHintLength,width:Q.N.parallelLineHintWidth,color:n.parallelSignColor,location:p,renderOccluded:a?S.m$.OccludeAndTransparent:S.m$.Opaque,isDraped:a,renderGroup:k.O7.SnappingHint,isDecoration:!0});return f.setDirectionFromPoints(u,p),f.attached=!0,(0,s.DQ)(f)}visualizeRightAngleQuad(e,t){const{view:i,spatialReference:r}=t,n=ie(t),o=ne(e,t),{isDraped:a}=e,l=re(e.previousVertex,e.domain,t),d=re(e.centerVertex,e.domain,t),c=re(e.nextVertex,e.domain,t),u=oe(l,r,o,i,a),h=oe(d,r,o,i,a),p=oe(c,r,o,i,a);return(0,s.DQ)(new U.n({view:i,attached:!0,color:a?n.rightAngleColorDraped:n.rightAngleColor,renderOccluded:a?S.m$.OccludeAndTransparent:S.m$.Transparent,outlineRenderOccluded:a?S.m$.OccludeAndTransparent:S.m$.Opaque,outlineColor:n.rightAngleOutlineColor,outlineSize:Q.N.rightAngleHintOutlineSize,size:Q.N.rightAngleHintSize,isDraped:a,geometry:{previous:u,center:h,next:p},renderGroup:k.O7.SnappingHint,isDecoration:!0}))}_createLineSegmentHint(e,t,i,r,n,s,o){let a=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],d=!(arguments.length>9&&void 0!==arguments[9])||arguments[9];const c=oe(t,r,n,s,a),u=oe(i,r,n,s,a),h=new b({view:s,extensionType:P.FADED,start:c,end:u,isDraped:a,color:o.lineColor,renderOccluded:a?S.m$.OccludeAndTransparent:S.m$.Opaque,renderGroup:k.O7.SnappingHint,isDecoration:!0});switch(e){case Y.H3.TARGET:h.width=Q.N.lineHintWidthTarget,h.fadedExtensions={start:0,end:Q.N.lineHintFadedExtensions};break;case Y.H3.REFERENCE_EXTENSION:h.width=Q.N.lineHintWidthReference,h.fadedExtensions={start:0,end:0};break;case Y.H3.REFERENCE:h.width=Q.N.lineHintWidthReference,h.fadedExtensions={start:l?Q.N.lineHintFadedExtensions:0,end:d?Q.N.lineHintFadedExtensions:0}}return h.attached=!0,h}}function ie(e){const{effectiveTheme:t}=e.view,i=r.A.toUnitRGBA(t.accentColor),s=[0,0,0,0];return{intersectionPointColor:s,intersectionPointOutlineColor:i,pointColor:s,pointOutlineColor:i,lineColor:i,lineOutlineColor:void 0,parallelSignColor:i,rightAngleColor:i,rightAngleColorDraped:r.A.toUnitRGBA((0,n._L)(t.accentColor,.5)),rightAngleOutlineColor:i}}function re(e,t,i){const r=se(t,i);return null==r?e:(0,$.vt)(e[0],e[1],r)}function ne(e,t){return null!=se(e.domain,t)?t.selfSnappingZ.elevationInfo:e.isDraped?d.Tq:d.qt}function se(e,t){let{selfSnappingZ:i}=t;return e===B.n.SELF&&null!=i?i.value:null}function oe(e,t,i,r,n){const s=(0,a.vt)();if(n){const i=r.basemapTerrain.overlayManager.renderer.spatialReference;(0,l.F)(e,t,s,i)}else(0,ee.XG)(e,t,i,r,s);return s}},7947:(e,t,i)=>{i.d(t,{AA:()=>f,Og:()=>r,xk:()=>v,z7:()=>_});i(35238);var r,n=i(76931),s=(i(20664),i(9392)),o=(i(9624),i(13927)),a=i(95925),l=(i(96190),i(75762)),d=(i(12482),i(37431)),c=i(29808),u=i(3112),h=i(97974),p=(i(70825),i(13904));function f(e,t){return g(e,(()=>t))}function g(e,t){const i=(0,s.vt)(),r=(0,s.vt)();let a=!1;return s=>{const c=t(s);if("start"===s.action){const t=(0,n.WA)(s.screenStart,(0,n.PR)(l.oG.get())),r=(0,d.Z4)(e.state.camera,t,y);null!=r&&(a=(0,o.Ui)(c,r,i))}if(!a)return null;const u=(0,n.WA)(s.screenEnd,(0,n.PR)(l.oG.get())),h=(0,d.Z4)(e.state.camera,u,y);return null==h?null:(0,o.Ui)(c,h,r)?{...s,renderStart:i,renderEnd:r,plane:c,ray:h}:null}}function _(e){let t=null;return i=>{switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":null!=t&&(t.remove(),t=null)}return i}}function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=(0,c.hz)(e.state.viewingMode);i.options.selectionMode=!0,i.options.store=u.oH.MIN,i.options.hud=!1;const o=(0,n.gs)(),a={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},l=(0,s.vt)(),d=null!==t&&void 0!==t?t:e.spatialReference,f=t=>{e.map.ground&&e.map.ground.opacity<1?a.exclude.add(h.fo):a.exclude.delete(h.fo),e.sceneIntersectionHelper.intersectIntersectorScreen((0,n.WA)(t,o),i,a);const s=i.results.min;let c;if(s.getIntersectionPoint(l))c=s.intersector===u.dz.TERRAIN?r.GROUND:r.OTHER;else{if(!i.results.ground.getIntersectionPoint(l))return null;c=r.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(l,new p.A({spatialReference:d})),surfaceType:c}};let g;return e=>{if("start"===e.action){const t=f(e.screenStart);g=null!=t?t.location:null}if(null==g)return null;const t=f(e.screenEnd);return null!=(null===t||void 0===t?void 0:t.location)?{...e,mapStart:g,mapEnd:t.location,surfaceType:t.surfaceType}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(r||(r={}));(0,s.vt)(),(0,s.vt)();const y=(0,a.vt)()},56119:(e,t,i)=>{i.d(t,{X:()=>Me});var r=i(54901),n=i(77944),s=i(19276),o=i(68134),a=i(35143),l=i(91967),d=i(46053),c=(i(81806),i(76460)),u=(i(47249),i(85842));let h=class extends l.A{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new s.A}};(0,a._)([(0,d.MZ)({constructOnly:!0})],h.prototype,"layer",void 0),(0,a._)([(0,d.MZ)()],h.prototype,"enabled",void 0),(0,a._)([(0,d.MZ)()],h.prototype,"updating",void 0),(0,a._)([(0,d.MZ)()],h.prototype,"availability",void 0),(0,a._)([(0,d.MZ)()],h.prototype,"sublayerSources",void 0),h=(0,a._)([(0,u.$)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],h);const p=h;var f=i(63078),g=i(18690);let _=class extends l.A{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new s.A,this.distance=f.N.distance,this.touchSensitivityMultiplier=f.N.touchSensitivityMultiplier,this.constraintsActive=!1}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){var e,t,i;const r=this.featureSources;r.some(y)&&c.A.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const n=r.filter(S),o=null!==(e=null===(t=this._get("_effectiveFeatureSources"))||void 0===t?void 0:t.filter(y))&&void 0!==e?e:new s.A;for(const s of n){const e=o.find((e=>e.layer===s.layer.parent));if(e)e.sublayerSources.includes(s)||e.sublayerSources.add(s);else if(s.layer.parent){const e=new p({layer:s.layer.parent});e.sublayerSources.add(s),o.add(e)}}for(const s of o){const e=s.sublayerSources.filter((e=>!n.includes(e)));s.sublayerSources.removeMany(e)}o.removeMany(o.filter((e=>0===e.sublayerSources.length)));const a=r.filter(m),l=null!==(i=this._get("_effectiveFeatureSources"))&&void 0!==i?i:new s.A,{added:d,removed:u}=(0,g.iv)(l.toArray(),[...a,...o]);return l.removeMany(u),l.addMany(d),l}};(0,a._)([(0,d.MZ)()],_.prototype,"enabled",void 0),(0,a._)([(0,d.MZ)()],_.prototype,"enabledToggled",void 0),(0,a._)([(0,d.MZ)()],_.prototype,"forceDisabled",void 0),(0,a._)([(0,d.MZ)()],_.prototype,"selfEnabled",void 0),(0,a._)([(0,d.MZ)()],_.prototype,"featureEnabled",void 0),(0,a._)([(0,d.MZ)({type:s.A.ofType(p)})],_.prototype,"featureSources",void 0),(0,a._)([(0,d.MZ)()],_.prototype,"distance",void 0),(0,a._)([(0,d.MZ)()],_.prototype,"touchSensitivityMultiplier",void 0),(0,a._)([(0,d.MZ)()],_.prototype,"constraintsActive",void 0),(0,a._)([(0,d.MZ)({readOnly:!0})],_.prototype,"effectiveEnabled",null),(0,a._)([(0,d.MZ)({readOnly:!0})],_.prototype,"effectiveSelfEnabled",null),(0,a._)([(0,d.MZ)({readOnly:!0})],_.prototype,"effectiveFeatureEnabled",null),(0,a._)([(0,d.MZ)({readOnly:!0})],_.prototype,"_effectiveFeatureSources",null),_=(0,a._)([(0,u.$)("esri.views.interactive.snapping.SnappingOptions")],_);const v=_;function y(e){return"subtype-group"===e.layer.type}function m(e){return"subtype-group"!==e.layer.type}function S(e){return"subtype-sublayer"===e.layer.type}var w=i(50346),E=i(31633),x=i(19555),b=i(20664),R=i(9392),C=i(53494),O=i(19451),D=i(12482),P=i(75543),T=i(23862),M=i(34154),A=i(8203),L=i(46530),F=i(31933),V=i(9730),G=i(90992);let I=class extends l.A{get layerView(){var e;return null===(e=this.view)||void 0===e||null===(e=e.allLayerViews)||void 0===e?void 0:e.find((e=>e.layer===this.layer))}get valid(){return this._valid}get subtypeFilter(){var e,t,i;const{layer:r,snappingSource:n}=this;if(!(0,F.F2)(r)||null===(e=r.subtypes)||void 0===e||!e.length)return{mode:"not-in-use",filter:null};const s=n.layerSource.sublayerSources.filter((e=>{var t;return e.enabled&&e.layer.visible&&(0,G.JU)(null===(t=this.view)||void 0===t?void 0:t.scale,e.layer.effectiveScaleRange.minScale,e.layer.effectiveScaleRange.maxScale)})).map((e=>e.layer.subtypeCode));if(!s.length)return{mode:"none-visible",filter:null};if(s.length===r.subtypes.length)return{mode:"all-visible",filter:null};const o=null!==(t=null===(i=r.fieldsIndex.get(r.subtypeField))||void 0===i?void 0:i.name)&&void 0!==t?t:r.subtypeField;return 1===s.length?{mode:"in-use",filter:"".concat(o," = ").concat(s.getItemAt(0))}:{mode:"in-use",filter:"".concat(o," IN (").concat(s.join(", "),")")}}get floorFilter(){const{view:e,layer:t}=this;return e&&t?(0,L.E)({view:e,layer:t}):null}constructor(e){super(e),this.rulesTable=null,this._valid=!1}initialize(){if(!this.snappingSource||!this.layer)return;const{layer:e,snappingSource:t}=this;if("refresh"in e){const i=e;this.addHandles(i.on("refresh",(()=>t.refresh())))}this.loadRules(),this.addHandles([(0,o.wB)((()=>t.updating),(e=>t.layerSource.updating=e),o.pc),(0,o.wB)((()=>t.availability),(e=>t.layerSource.availability=e),o.pc)])}getFetchCandidatesParameters(e,t,i){var r,n,s,o,a;if(!this.valid)return[];const{layer:l,layerView:d,floorFilter:c,rulesTable:u,subtypeFilter:h}=this,p={distance:i,mode:null!==(r=null===(n=this.view)||void 0===n?void 0:n.type)&&void 0!==r?r:"2d",point:e,coordinateHelper:t.coordinateHelper,...this._types,filter:d&&"filter"in d?d.filter:null};if(c&&(p.filter=j(p.filter,c)),"not-in-use"!==h.mode&&"all-visible"!==h.mode){if("none-visible"===h.mode)return[];p.filter?p.filter.where=(0,M.m)(p.filter.where,h.mode):p.filter=new A.A({where:h.filter})}const f=t.feature,g="subtype-sublayer"===(null===f||void 0===f||null===(s=f.sourceLayer)||void 0===s?void 0:s.type)?f.sourceLayer.parent:null===f||void 0===f?void 0:f.sourceLayer;if(u&&f&&(0,V.Tu)(null===(o=this.view)||void 0===o?void 0:o.map)&&((0,F.yZ)(l)||(0,F.F2)(l))&&l.layerId&&((0,F.yZ)(g)||(0,F.F2)(g))&&null!==(a=this.view.map.utilityNetworks)&&void 0!==a&&a.find((e=>e.isUtilityLayer(g)))){var _;if("loaded"!==u.loadStatus)return[];const e=[],t=l.layerId,i=null===(_=u.getFeatureSQL(g,f))||void 0===_?void 0:_[t];if(!i)return[];const r=i.anyVertex;let n=i.endVertex;return n&&r&&n===r&&(n=""),n&&e.push({...p,returnEdge:!1,vertexMode:"ends",filter:j(p.filter,n)}),r&&e.push({...p,returnEdge:!1,vertexMode:"all",filter:j(p.filter,r)}),e}return[p]}async loadRules(){const{layer:e,view:t}=this;if(e&&t&&(0,V.Tu)(null===t||void 0===t?void 0:t.map)&&((0,F.yZ)(e)||(0,F.F2)(e))){var i;const n=null===(i=t.map.utilityNetworks)||void 0===i?void 0:i.find((t=>t.isUtilityLayer(e)));if(n)try{var r;this.rulesTable=await n.getRulesTable(),await(null===(r=this.rulesTable)||void 0===r?void 0:r.load())}catch(h){return void c.A.getLogger("esri.views.interactive.snapping.FeatureSnappingSourceInfo").error("Failed to load rules table for snapping source",e.title)}}this._valid=!0}get _types(){return{returnEdge:!0,vertexMode:"all"}}remove(){this.destroy()}destroy(){var e;null===(e=this.snappingSource)||void 0===e||e.destroy()}};function j(e,t){return null==e?new A.A({where:t}):e.where?new A.A({where:(0,M.m)(e.where,t)}):new A.A({where:t})}(0,a._)([(0,d.MZ)({constructOnly:!0})],I.prototype,"layer",void 0),(0,a._)([(0,d.MZ)({constructOnly:!0})],I.prototype,"snappingSource",void 0),(0,a._)([(0,d.MZ)({constructOnly:!0})],I.prototype,"view",void 0),(0,a._)([(0,d.MZ)()],I.prototype,"layerView",null),(0,a._)([(0,d.MZ)()],I.prototype,"rulesTable",void 0),(0,a._)([(0,d.MZ)()],I.prototype,"valid",null),(0,a._)([(0,d.MZ)()],I.prototype,"subtypeFilter",null),(0,a._)([(0,d.MZ)()],I.prototype,"floorFilter",null),(0,a._)([(0,d.MZ)()],I.prototype,"_valid",void 0),I=(0,a._)([(0,u.$)("esri.views.interactive.snapping.FeatureSnappingSourceInfo")],I);var N,z=i(99791),H=i(80794),q=i(9876),Z=i(61751),X=i(30003),W=i(23543),U=i(56572);class k extends X.C{constructor(e){let{targetPoint:t,constraint:i,previousVertex:r,otherVertex:n,otherVertexType:s,objectId:o,isDraped:a}=e;super(t,i,a,z.n.SELF),this.previousVertex=r,this.otherVertex=n,this.otherVertexType=s,this.objectId=o}get hints(){const e=this.previousVertex,t=this.otherVertexType===N.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===N.CENTER?this.targetPoint:this.otherVertex;return[new W.c(V.H3.TARGET,t,i,this.isDraped,this.domain),new W.c(V.H3.REFERENCE,e,t,this.isDraped,this.domain),new U.l(this.previousVertex,t,i,this.isDraped,this.domain)]}}!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(N||(N={}));var $=i(17072);let Q=class extends l.A{get updating(){return this._snappingSources.some((e=>null==e||e.valid&&e.snappingSource.updating))||this._updatingHandles.updating}constructor(e){super(e),this.options=null,this._domain=z.n.FEATURE,this._updatingHandles=new O.U,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){const e=(0,o.lZ)((()=>{var e;return null===(e=this.options)||void 0===e?void 0:e._effectiveFeatureSources}),((e,t)=>this._createSourceInfo(e,t)));this._snappingSources=e,this.addHandles((0,r.DQ)(e))}destroy(){this._set("options",null),this._updatingHandles.destroy()}async fetchCandidates(e,t,i,r){if(!(t&this._domain&&null!=this.options&&this.options.effectiveFeatureEnabled))return[];const n=[],s=this._computeScreenSizeDistanceParameters(e,i);for(const l of this._snappingSources){var o;if(null==l||!l.valid||!l.snappingSource.layerSource.enabled||null!==(o=l.layerView)&&void 0!==o&&o.suspended)continue;const t=l.getFetchCandidatesParameters(e,i,s);for(const e of t)n.push(l.snappingSource.fetchCandidates(e,r).then((e=>e.filter((e=>!this._candidateIsExcluded(l.snappingSource,e,i.excludeFeature))))))}const a=(await(0,w.nA)(n)).flat();return this._addRightAngleCandidates(a,e,s,i),(0,w.Te)(r),(0,V.xX)(e,a),a}_addRightAngleCandidates(e,t,i,r){var n,s,o,a;const l=null!=r.vertexHandle?null===(n=r.vertexHandle.rightEdge)||void 0===n||null===(n=n.rightVertex)||void 0===n?void 0:n.pos:null!=r.editGeometryOperations&&"polygon"===r.editGeometryOperations.data.type?null===(s=r.editGeometryOperations.data.components[0])||void 0===s||null===(s=s.getFirstVertex())||void 0===s?void 0:s.pos:null,d=null!=r.vertexHandle?null===(o=r.vertexHandle.leftEdge)||void 0===o||null===(o=o.leftVertex)||void 0===o?void 0:o.pos:null!=r.editGeometryOperations?null===(a=r.editGeometryOperations.data.components[0])||void 0===a||null===(a=a.getLastVertex())||void 0===a?void 0:a.pos:null,{view:c}=this,u=(0,T.Lp)(l,c,r),h=(0,T.Lp)(d,c,r),p=e.length;for(let f=0;f<p;f++)this._addRightAngleCandidate(e[f],h,t,i,e),this._addRightAngleCandidate(e[f],u,t,i,e)}_addRightAngleCandidate(e,t,i,r,n){if(null==t||!function(e){return(e instanceof q.z||e instanceof H.X)&&!function(e){let{constraint:{start:t,end:i}}=e;const r=(0,b.a)(t,i),n=(0,x.hG)((0,T.Xz)(t),(0,T.Xz)(i));return r<(0,C.FD)()||n/r<K}(e)}(e))return;const s=e.constraint.closestTo(t),o=(s[0]-i[0])/r.x,a=(s[1]-i[1])/r.y,{start:l,end:d}=e.constraint;if(o*o+a*a<=1){const i=new k({targetPoint:s,otherVertex:t,otherVertexType:N.NEXT,previousVertex:(0,x.hG)((0,T.Xz)(s),(0,T.Xz)(l))>(0,x.hG)((0,T.Xz)(s),(0,T.Xz)(d))?l:d,constraint:new P.FX(t,s),objectId:e.objectId,isDraped:e.isDraped});n.push(i)}}_computeScreenSizeDistanceParameters(e,t){let i=null!=this.options?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;return null==this.view?{x:i,y:i,z:i,distance:i}:"2d"===this.view.type?(i*=this.view.resolution,{x:i,y:i,z:i,distance:i}):this._computeScreenSizeDistanceParameters3D(e,i,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,i,r){const{spatialReference:n}=r;i.renderCoordsHelper.toRenderCoords(e,n,Y);const s=i.state.camera.computeScreenPixelSizeAt(Y),o=s*i.renderCoordsHelper.unitInMeters,a=o/(0,E.GA)(n),l=o/(0,E.G9)(n),d=t*a,c=t*l,u=(0,$.jq)(e,n,D.qt,i),h=u?B(u,e,a,0,0,i,r):0,p=u?B(u,e,0,a,0,i,r):0,f=u?B(u,e,0,0,l,i,r):0;return{x:0===h?0:d/h,y:0===p?0:d/p,z:0===f?0:c/f,distance:s*t}}_candidateIsExcluded(e,t,i){if(null==i)return!1;const r=this._getCandidateObjectId(t);if(null==r)return!1;const n=e.layerSource.layer;return"graphics"===n.type?i.uid===r:i.sourceLayer===n&&!(!i.attributes||!("objectIdField"in n))&&i.attributes[n.objectIdField]===r}_getCandidateObjectId(e){return e instanceof Z.w?e.objectId:null}async _createSourceInfo(e,t){const i=e.layer;i.loaded||(await i.load(),(0,w.Te)(t));const{view:r}=this,n=await this._createFeatureSnappingSourceType(e);return(0,w.Te)(t),new I(null==n?{}:{snappingSource:n,view:r,layer:i})}async _createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}async _createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;return null==t||"3d"!==t.type?null:new((await this._getSourceModule("scene")).SceneLayerSnappingSource)({layerSource:e,view:t})}async _createFeatureSnappingSourceFeatureLayer(e){var t;switch(null===(t=e.layer.source)||void 0===t?void 0:t.type){case"feature-layer":case"oriented-imagery":return new((await this._getSourceModule("featureService")).FeatureServiceSnappingSource)({spatialReference:this.spatialReference,view:this.view,layerSource:e});case"memory":case"csv":case"geojson":case"wfs":return"mesh"===e.layer.geometryType?null:new((await this._getSourceModule("featureCollection")).FeatureCollectionSnappingSource)({layerSource:e,view:this.view})}return null}async _createFeatureSnappingSourceGraphicsLayer(e){return new((await this._getSourceModule("graphics")).GraphicsSnappingSource)({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _createFeatureSnappingSourceMapNotesLayer(e){return new((await this._getSourceModule("notes")).GraphicsSnappingSource)({getGraphicsLayers:()=>{var t,i;return null!==(t=null===(i=e.layer.sublayers)||void 0===i?void 0:i.toArray())&&void 0!==t?t:[]},spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _getSourceModule(e){const t=this._sourceModules[e];if(null==t.loader){const t=this._loadSourceModule(e),i={module:null,loader:t};this._sourceModules[e]=i;const r=await t,n={module:r,loader:t};return this._sourceModules[e]=n,r}return null==t.module?t.loader:t.module}_loadSourceModule(e){const t=this._updatingHandles;switch(e){case"featureService":return t.addPromise(i.e(5376).then(i.bind(i,85376)));case"featureCollection":return t.addPromise(i.e(7567).then(i.bind(i,77567)));case"graphics":case"notes":return t.addPromise(Promise.all([i.e(7216),i.e(3620),i.e(2003),i.e(1047),i.e(9546)]).then(i.bind(i,99546)));case"scene":return t.addPromise(i.e(3537).then(i.bind(i,13537)))}}get test(){return{snappingSources:this._snappingSources}}};function B(e,t,i,r,n,s,o){let{spatialReference:a}=o;const l=(0,b.c)(J,t);l[0]+=i,l[1]+=r,l[2]+=n;const d=(0,$.jq)(l,a,D.qt,s);return d?(0,V.Mo)(d,e):1/0}(0,a._)([(0,d.MZ)({constructOnly:!0})],Q.prototype,"spatialReference",void 0),(0,a._)([(0,d.MZ)({constructOnly:!0})],Q.prototype,"view",void 0),(0,a._)([(0,d.MZ)()],Q.prototype,"options",void 0),(0,a._)([(0,d.MZ)({readOnly:!0})],Q.prototype,"updating",null),(0,a._)([(0,d.MZ)()],Q.prototype,"_snappingSources",void 0),Q=(0,a._)([(0,u.$)("esri.views.interactive.snapping.FeatureSnappingEngine")],Q);const Y=(0,R.vt)(),J=(0,R.vt)(),K=1e-4;var ee=i(54099),te=i(9624),ie=i(73582),re=i(24648);class ne{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=f.N.shortLineThreshold*f.N.shortLineThreshold}snap(e,t){return null!=t.vertexHandle?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold((0,T.Lp)(e.leftVertex.pos,this.view,t),(0,T.Lp)(e.rightVertex.pos,this.view,t),t)}exceedsShortLineThreshold(e,t,i){let{spatialReference:r}=i;return 0===this.squaredShortLineThreshold||(0,V.pM)((0,$.jq)(t,r,D.qt,this.view),(0,$.jq)(e,r,D.qt,this.view))>this.squaredShortLineThreshold}isVertical(e,t,i){let{spatialReference:r}=i;const n=(0,E.GA)(r);return(0,x.Io)((0,T.Xz)(e),(0,T.Xz)(t))*n<f.N.verticalLineThresholdMeters}squaredProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}}class se extends X.C{constructor(e){let{lineStart:t,lineEnd:i,targetPoint:r,isDraped:n}=e;super(r,new P.WG(t,i),n,z.n.SELF),this._referenceLineHint=new W.c(V.H3.REFERENCE_EXTENSION,t,i,n,this.domain)}get hints(){return[this._referenceLineHint,new W.c(V.H3.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}var oe=i(89646),ae=i(92854),le=i(79337),de=i(74050);class ce extends ne{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=i.edges.length,n=[];if(r<1)return n;const{spatialReference:s}=t,o=(0,$.jq)(e,s,D.qt,this.view),{view:a}=this,l=i.edges[r-1];let d=l;do{if(this.edgeExceedsShortLineThreshold(d,t)){const i=(0,V.is)(d,a,t);this._processCandidateProposal(i.left,i.right,e,o,t,n)}d=d.leftVertex.leftEdge}while(d&&d!==l);return n}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,n=r.component;if(n.edges.length<2)return i;const{view:s}=this,{spatialReference:o}=t,a=(0,$.jq)(e,o,D.qt,s),l=r.leftEdge,d=r.rightEdge;l&&d&&this.edgeExceedsShortLineThreshold(l,t)&&this.edgeExceedsShortLineThreshold(d,t)&&this._processCandidateProposal((0,T.Lp)(l.leftVertex.pos,s,t),(0,T.Lp)(d.rightVertex.pos,s,t),e,a,t,i);const c=n.edges[0];let u=c;do{if(u!==r.leftEdge&&u!==r.rightEdge&&this.edgeExceedsShortLineThreshold(u,t)){const r=(0,V.is)(u,s,t);this._processCandidateProposal(r.left,r.right,e,a,t,i)}u=u.rightVertex.rightEdge}while(u&&u!==c);return i}_processCandidateProposal(e,t,i,r,n,s){var o;const{spatialReference:a,pointer:l}=n,d=(0,R.vt)();this._projectedLine(d,e,t,i,n);const c=(0,T._7)(d);(0,V.pM)(r,(0,$.jq)(c,a,D.qt,this.view))<this.squaredProximityThreshold(l)&&s.push(new se({lineStart:e,lineEnd:t,targetPoint:c,isDraped:"on-the-ground"===(null===(o=n.elevationInfo)||void 0===o?void 0:o.mode)}))}_projectedLine(e,t,i,r,n){this._projectToLineGeodesic(e,t,i,r,n)||this._projectToLinePlanar(e,r,t,i)}_projectToLineGeodesic(e,t,i,r,n){let{spatialReference:s}=n;const o=(0,oe.IP)(t,i,s,s);if(null==o)return!1;const a=(0,oe.IP)(i,r,s,s);if(null==a)return!1;const l=(0,ae.n3)(i,r,s);if(null==l)return!1;const d=Math.abs(ie.wf.shortestSignedDiff(o,a))>Math.PI/2?ie.uC.normalize(o+Math.PI):o;return(0,oe.rT)(e,i,s,(0,re.l3)(l,"meters"),(0,re.Wq)(d,"radians","geographic"),"geodesic"),e[2]=r[2],!0}_projectToLinePlanar(e,t,i,r){(0,le.Yv)(t,{start:i,end:r,type:de.Vv.LINE},e),e[2]=t[2]}}var ue=i(72745),he=i(20578);class pe extends X.C{constructor(e){let{referenceLine:t,lineStart:i,targetPoint:r,isDraped:n}=e;const s=(0,R.o8)(i),{left:o,right:a}=t;(0,b.f)(s,(0,b.g)(s,s,a),o),super(r,new P.WG(i,(0,T._7)(s)),n,z.n.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new W.c(V.H3.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new he.r(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map((e=>new W.c(V.H3.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((i=>{(0,b.j)(e.right,i.edge.left)&&(i.fadeLeft=!1,t.fadeRight=!1),(0,b.j)(e.right,i.edge.right)&&(i.fadeRight=!1,t.fadeRight=!1),(0,b.j)(e.left,i.edge.right)&&(i.fadeRight=!1,t.fadeLeft=!1),(0,b.j)(e.left,i.edge.left)&&(i.fadeLeft=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}class fe extends ne{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=i.edges.length,n=i.vertices.length,s=[];if(r<2)return s;const{view:o}=this,a=(0,$.jq)(e,t.spatialReference,D.qt,o),l=(0,T.Lp)(i.vertices[n-1].pos,o,t),d=(0,T.Lp)(i.vertices[0].pos,o,t),c=i.edges[r-1];let u=c;do{if(this.edgeExceedsShortLineThreshold(u,t)){const i=(0,V.is)(u,o,t);this._checkEdgeForParallelLines(i,l,e,a,t,s),this._checkEdgeForParallelLines(i,d,e,a,t,s)}u=u.leftVertex.leftEdge}while(u&&u!==c);return s}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,n=r.component;if(n.edges.length<3)return i;const{view:s}=this,o=(0,$.jq)(e,t.spatialReference,D.qt,s),a=r.leftEdge,l=r.rightEdge,d=n.vertices[0],c=(0,T.Lp)(d.pos,s,t),u=n.vertices.length,h=n.vertices[u-1],p=(0,T.Lp)(h.pos,s,t),f=n.edges[0];let g=f;do{if(g!==a&&g!==l&&this.edgeExceedsShortLineThreshold(g,t)){const n=(0,V.is)(g,s,t);a&&this._checkEdgeForParallelLines(n,(0,T.Lp)(a.leftVertex.pos,s,t),e,o,t,i),l&&this._checkEdgeForParallelLines(n,(0,T.Lp)(l.rightVertex.pos,s,t),e,o,t,i),r===d?this._checkEdgeForParallelLines(n,p,e,o,t,i):r===h&&this._checkEdgeForParallelLines(n,c,e,o,t,i)}g=g.rightVertex.rightEdge}while(g&&g!==f);return i}_checkEdgeForParallelLines(e,t,i,r,n,s){const o=e.left,a=e.right;if((0,de.fg)(ge,(0,T.Xz)(t),(0,T.Xz)(o),(0,T.Xz)(a)),(0,x.hG)(ge,(0,T.Xz)(t))<f.N.parallelLineThreshold)return;(0,de.fg)(ge,(0,T.Xz)(i),(0,T.Xz)(o),(0,T.Xz)(a),(0,T.Xz)(t));const{spatialReference:l,pointer:d}=n,c=(0,T.fA)(ge[0],ge[1],i[2]);if((0,V.pM)(r,(0,$.jq)(c,l,D.qt,this.view))<this.squaredProximityThreshold(d)){var u;if(this.isVertical(c,t,n)||this.isVertical(o,a,n))return;if(this._parallelToPreviousCandidate(e,s))return;s.push(new pe({referenceLine:e,lineStart:t,targetPoint:c,isDraped:"on-the-ground"===(null===(u=n.elevationInfo)||void 0===u?void 0:u.mode)}))}}_parallelToPreviousCandidate(e,t){const i=e.left,r=e.right;for(const n of t)if((0,de.fg)(ge,(0,T.Xz)(r),(0,T.Xz)(n.constraint.start),(0,T.Xz)(n.constraint.end),(0,T.Xz)(i)),(0,x.hG)(ge,(0,T.Xz)(r))<f.N.parallelLineThreshold)return n.addReferenceLine(e),!0;return!1}}const ge=(0,ue.vt)();class _e extends ne{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=[];if(i.vertices.length<2)return r;const{view:n}=this,s=(0,$.jq)(e,t.spatialReference,D.qt,n),o=i.vertices.at(-1);this._checkForSnappingCandidate(r,o.leftEdge,o,o.leftEdge.leftVertex,e,s,t);const a=i.vertices[0];return this._checkForSnappingCandidate(r,a.rightEdge,a,a.rightEdge.rightVertex,e,s,t),r}snapExistingVertex(e,t){const i=[],r=t.vertexHandle;if(r.component.vertices.length<3)return i;const{view:n}=this,s=(0,$.jq)(e,t.spatialReference,D.qt,n),o=r.leftEdge,a=r.rightEdge;if(null!==o&&void 0!==o&&o.leftVertex.leftEdge){const r=o.leftVertex.leftEdge;this._checkForSnappingCandidate(i,r,r.rightVertex,r.leftVertex,e,s,t)}if(null!==a&&void 0!==a&&a.rightVertex.rightEdge){const r=a.rightVertex.rightEdge;this._checkForSnappingCandidate(i,r,r.leftVertex,r.rightVertex,e,s,t)}return i}_checkForSnappingCandidate(e,t,i,r,n,s,o){if(!this.edgeExceedsShortLineThreshold(t,o))return;const a=this.view,l=(0,T.Lp)(i.pos,a,o),d=(0,T.Lp)(r.pos,a,o);this._checkForSnappingCandidateNormalized(e,d,l,n,s,o)}_checkForSnappingCandidateNormalized(e,t,i,r,n,s){this._projectionRay(ye,t,i,r,s),this._checkForSnappingCandidateAlongProjectedRay(e,t,i,ye,r,n,s)}_projectionRay(e,t,i,r,n){this._projectionRayGeodesic(e,t,i,r,n)||this._projectionRayPlanar(e,t,i)}_projectionRayGeodesic(e,t,i,r,n){let{spatialReference:s}=n;const o=(0,oe.IP)(t,i,s,s);if(null==o)return!1;const a=(0,oe.IP)(i,r,s,s);if(null==a)return!1;const l=Math.sign(ie.uC.shortestSignedDiff(o,a))*Math.PI*.5,d=(0,re.Wq)(o+l,"radians","geographic"),c=(0,R.vt)(),u=(0,ae.n3)(i,r,s);return null!=u&&((0,oe.rT)(c,i,s,(0,re.l3)(u,"meters"),d,"geodesic"),(0,b.f)(e,c,i),!0)}_projectionRayPlanar(e,t,i){const r=(0,x.Re)(ve,(0,T.Xz)(i),(0,T.Xz)(t));(0,b.s)(e,r[1],-r[0],0)}_checkForSnappingCandidateAlongProjectedRay(e,t,i,r,n,s,o){var a;const{spatialReference:l,pointer:d}=o,c=(0,x.Re)(ve,(0,T.Xz)(n),(0,T.Xz)(i)),u=(0,x.Om)(r,c)/(0,x.m3)(r),h=(0,x.Ln)(ve,(0,T.Xz)(i),r,u),p=(0,T.fA)(h[0],h[1],n[2]);if((0,V.pM)(s,(0,$.jq)(p,l,D.qt,this.view))>this.squaredProximityThreshold(d)||this.isVertical(p,i,o)||this.isVertical(i,t,o))return;const f=(0,b.r)((0,R.vt)(),i,r,Math.sign(u));e.push(new k({targetPoint:p,constraint:new P.FX(i,(0,T._7)(f)),previousVertex:t,otherVertex:i,otherVertexType:N.CENTER,isDraped:"on-the-ground"===(null===(a=o.elevationInfo)||void 0===a?void 0:a.mode)}))}}const ve=(0,ue.vt)(),ye=(0,R.vt)();class me extends X.C{constructor(e){let{targetPoint:t,point1:i,point2:r,isDraped:n}=e;super(t,new P.ej((0,T._7)((0,b.m)((0,R.vt)(),i,r,.5)),.5*(0,x.Io)((0,T.Xz)(i),(0,T.Xz)(r))),n,z.n.SELF),this._p1=i,this._p2=r}get hints(){return[new W.c(V.H3.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new W.c(V.H3.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new U.l(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}class Se extends ne{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=[],n=i.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||n<2)return r;const{view:s}=this,o=i.vertices[0],a=i.vertices[n-1],l=(0,T.Lp)(o.pos,s,t),d=(0,T.Lp)(a.pos,s,t);return this._processCandidateProposal(l,d,e,t,r),r}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,n=r.component;if(n.edges.length<2)return i;if("polyline"===t.editGeometryOperations.data.type&&(0===r.index||r.index===n.vertices.length-1))return i;const{view:s}=this,o=(0,T.Lp)(r.leftEdge.leftVertex.pos,s,t),a=(0,T.Lp)(r.rightEdge.rightVertex.pos,s,t);return this._processCandidateProposal(o,a,e,t,i),i}_processCandidateProposal(e,t,i,r,n){if(!this.exceedsShortLineThreshold(e,t,r))return;const s=(0,x.Cc)(we,(0,T.Xz)(e),(0,T.Xz)(t),.5),o=.5*(0,x.Io)((0,T.Xz)(e),(0,T.Xz)(t)),a=(0,de.Dh)(we,(0,T.Xz)(i),s,o),l=(0,T.fA)(a[0],a[1],i[2]),{spatialReference:d,pointer:c}=r,u=(0,$.jq)(i,d,D.qt,this.view);if((0,V.pM)(u,(0,$.jq)(l,d,D.qt,this.view))<this.squaredProximityThreshold(c)){var h;if(this.isVertical(e,l,r)||this.isVertical(l,t,r))return;n.push(new me({targetPoint:l,point1:e,point2:t,isDraped:"on-the-ground"===(null===(h=r.elevationInfo)||void 0===h?void 0:h.mode)}))}}}const we=(0,ue.vt)();let Ee=class extends l.A{constructor(e){super(e),this.updating=!1,this._snappers=new s.A,this._domain=z.n.SELF}initialize(){this._snappers.push(new fe(this.view,this.options),new ce(this.view,this.options),new _e(this.view,this.options),new Se(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t,i){if(!(t&this._domain&&this.options.effectiveSelfEnabled))return[];const r=[];for(const n of this._snappers.items)for(const t of n.snap(e,i))r.push(t);return(0,V.xX)(e,r),r}};function xe(e,t){return[new Ee({view:e,options:t}),new Q({view:e,options:t,spatialReference:e.spatialReference})]}(0,a._)([(0,d.MZ)({readOnly:!0})],Ee.prototype,"updating",void 0),(0,a._)([(0,d.MZ)({constructOnly:!0})],Ee.prototype,"view",void 0),(0,a._)([(0,d.MZ)()],Ee.prototype,"options",null),Ee=(0,a._)([(0,u.$)("esri.views.interactive.snapping.SelfSnappingEngine")],Ee);var be=i(30484);class Re extends X.C{constructor(e,t,i,r){super(e,new P.i7(e),r,z.n.ALL),this.first=t,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new be.v(this.targetPoint,this.isDraped,this.domain)]}}let Ce=class extends(ee.A.EventedMixin(l.A)){constructor(e){super(e),this.options=new v,this.snappingEnginesFactory=xe,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Oe.MAIN}initialize(){this.addHandles([(0,o.wB)((()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:r,constraintsActive:n}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:r,constraintsActive:n}}),(()=>{this.doneSnapping(),this.emit("changed")}),o.OH),(0,o.wB)((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),o.OH),(0,o.wB)((()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory})),(e=>{let{viewReady:t,snappingEnginesFactory:i}=e;return this._recreateEngines(t,i)}),o.pc)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:i,options:r}=this;this._engines=t(i,r)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}get _squaredSatisfiesConstraintThreshold(){return f.N.satisfiesConstraintScreenThreshold*f.N.satisfiesConstraintScreenThreshold}snap(e){return function(e){return null!=e.scenePoint}(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:i}=e;this._removeVisualization();const r=this._currentMainCandidate;if(null==r)return t;const n=this._selectUpdateInput(e);if(null==n)return t;const{spatialReference:s}=i,o=(0,te.project)(n,s);if(null==o)return t;const{view:a}=this,{elevationInfo:l,visualizer:d}=i,c=[],u=(0,T.vf)(o,a,l),h=r.constraint.closestTo(u);if(!this._arePointsWithinScreenThreshold(u,h,i))return this._resetSnappingState(),t;r.targetPoint=h,c.push(...r.hints);for(const p of this._currentOtherActiveCandidates)p.targetPoint=h,c.push(...p.hints);return null!=d&&this.addHandles(d.draw(c,{spatialReference:s,elevationInfo:Pe(i),view:a,selfSnappingZ:i.selfSnappingZ}),De),(0,T.xF)(h,a,t,i)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput(e){let{point:t,scenePoint:i}=e;switch(this._currentSnappedType){case Oe.MAIN:return t;case Oe.SCENE:return i}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Oe.MAIN}_removeVisualization(){this.removeHandles(De)}async _snapSinglePoint(e){let{point:t,context:i,signal:r}=e;const{view:n}=this,{elevationInfo:s}=i,o=(0,T.vf)(t,n,s),a=await this._fetchCandidates(o,z.n.ALL,i,r);return this._createSnapResult(o,Oe.MAIN,a,n,t,i,r)}async _snapMultiPoint(e){var t,i;let{point:r,scenePoint:n,context:s,signal:o}=e;const{view:a}=this,{coordinateHelper:l,elevationInfo:d,spatialReference:c}=s;await(0,te.initializeProjection)(n.spatialReference,c);const u=(0,te.project)(n,c),h=(0,T.vf)(u,a,d),p=await this._fetchCandidates(h,z.n.FEATURE,s,o);if(p.length>0){const e=await this._fetchCandidates(h,z.n.SELF,s,o);return this._createSnapResult(h,Oe.SCENE,[...p,...e],a,u,s,o)}const f=(0,T.vf)(r,a,d),g=await this._fetchCandidates(f,z.n.SELF,s,o);return this._createSnapResult(f,Oe.MAIN,g,a,{z:l.hasZ()&&r.hasZ?null!==(t=r.z)&&void 0!==t?t:0:void 0,m:l.hasM()&&r.hasM?null!==(i=r.m)&&void 0!==i?i:0:void 0},s,o)}async _fetchCandidates(e,t,i,r){return(await Promise.all(this._engines.map((n=>n.fetchCandidates(e,t,i,r))))).flat()}_createSnapResult(e,t,i,r,n,s,o){return{get valid(){return!(0,w.G4)(o)},apply:()=>{const{spatialReference:o}=s,{snappedPoint:a,hints:l}=this._processCandidates(e,t,i,s);return this._removeVisualization(),null!=s.visualizer&&this.addHandles(s.visualizer.draw(l,{spatialReference:o,elevationInfo:D.qt,view:r,selfSnappingZ:s.selfSnappingZ}),De),(0,T.xF)(a,r,n,s)}}}_processCandidates(e,t,i,r){if(i.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),(0,V.xX)(e,i);const n=this._currentMainCandidate;if(null!=n){const s=this._findOldConstraintInNewCandidates(n,i);if(s>=0){if(!(i[s]instanceof Re))return this._intersectWithOtherCandidates(s,i,e,t,r);if(this._arePointsWithinScreenThreshold(e,n.targetPoint,r))return this._updateSnappingCandidate(n,t,i,r)}}return this._intersectWithOtherCandidates(0,i,e,t,r)}_findOldConstraintInNewCandidates(e,t){return e instanceof Re?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,i,r,n){const{coordinateHelper:s}=n,o=t[e],a=[];for(let l=0;l<t.length;++l){if(l===e)continue;const r=t[l],n=o.constraint.intersect(r.constraint);if(n)for(const e of n.closestPoints(o.targetPoint))a.push([new Re(e,o,r,r.isDraped),this._squaredScreenDistance(i,e,s)])}return a.length>0&&(a.sort(((e,t)=>e[1]-t[1])),a[0][1]<this._squaredPointProximityThreshold(n.pointer))?this._updateSnappingCandidate(a[0][0],r,t,n):this.options.constraintsActive&&(o instanceof se||o instanceof q.z||o instanceof k||o instanceof pe)?{snappedPoint:i,hints:[]}:this._updateSnappingCandidate(o,r,t,n)}_updateSnappingCandidate(e,t,i,r){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const n=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const o of i){if(e instanceof Re){if(o.constraint.equals(e.first.constraint)||o.constraint.equals(e.second.constraint))continue}else if(o.constraint.equals(e.constraint))continue;const t=o.constraint.closestTo(n);this._squaredScreenDistance(t,n,r.coordinateHelper)<this._squaredSatisfiesConstraintThreshold&&(o.targetPoint=n,this._currentOtherActiveCandidates.push(o),s.push(...o.hints))}return{snappedPoint:n,hints:s}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,i){return this._squaredScreenDistance(e,t,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(e,t,i){return(0,V.pM)(this._toScreen(e,i),this._toScreen(t,i))}_toScreen(e,t){return(0,$.jq)(e,t.spatialReference,D.qt,this.view)}_findOldCandidateIndex(e,t){let i=-1;for(let r=0;r<e.length;++r)if(t.constraint.equals(e[r].constraint)){i=r;break}return i}get test(){return{visualizationsActive:this.hasHandles(De),engines:this._engines}}};var Oe;(0,a._)([(0,d.MZ)({constructOnly:!0})],Ce.prototype,"view",void 0),(0,a._)([(0,d.MZ)()],Ce.prototype,"options",void 0),(0,a._)([(0,d.MZ)({readOnly:!0})],Ce.prototype,"updating",null),(0,a._)([(0,d.MZ)()],Ce.prototype,"snappingEnginesFactory",void 0),(0,a._)([(0,d.MZ)()],Ce.prototype,"_engines",void 0),(0,a._)([(0,d.MZ)()],Ce.prototype,"_squaredMouseProximityThreshold",null),(0,a._)([(0,d.MZ)()],Ce.prototype,"_squaredTouchProximityThreshold",null),(0,a._)([(0,d.MZ)()],Ce.prototype,"_squaredSatisfiesConstraintThreshold",null),Ce=(0,a._)([(0,u.$)("esri.views.interactive.snapping.SnappingManager")],Ce),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(Oe||(Oe={}));const De="visualization-handle";function Pe(e){let{coordinateHelper:t,elevationInfo:i}=e;return t.hasZ()?D.qt:i}const Te=new Map;function Me(e){if(!Te.has(e)){const t=function(e,t){var i,r;const n=new v({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:null!==(i=null===t||void 0===t?void 0:t.distance)&&void 0!==i?i:f.N.distance,touchSensitivityMultiplier:null!==(r=null===t||void 0===t?void 0:t.touchSensitivityMultiplier)&&void 0!==r?r:f.N.touchSensitivityMultiplier});return{...(0,o.wB)((()=>{var t,i;return null!==(t=null===(i=e.map)||void 0===i||null===(i=i.allLayers)||void 0===i?void 0:i.toArray())&&void 0!==t?t:[]}),(e=>{n.featureSources=new s.A(e.map((e=>new p({layer:e,enabled:!0}))))}),o.Vh),options:n}}(e,{distance:10}),i=function(e,t){return new Ce({view:e,options:t,snappingEnginesFactory:(t,i)=>[new Q({view:e,spatialReference:e.spatialReference,options:i})]})}(e,t.options);Te.set(e,{referenceCount:0,snappingManager:i,remove:()=>{t.remove(),i.destroy()}})}const t=Te.get(e);t.referenceCount++;const i=(0,r.hA)((()=>function(e,t){t.referenceCount--,t.referenceCount>0||(0,n.d)((()=>{0===t.referenceCount&&(t.remove(),Te.delete(e))}))}(e,t)));return{snappingManager:t.snappingManager,...i}}},80794:(e,t,i)=>{i.d(t,{X:()=>a});var r=i(75543),n=i(9730),s=i(61751),o=i(23543);class a extends s.w{constructor(e){super({...e,isDraped:!0,constraint:new r.en(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new o.c(n.H3.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},9876:(e,t,i)=>{i.d(t,{z:()=>a});var r=i(75543),n=i(9730),s=i(61751),o=i(23543);class a extends s.w{constructor(e){super({...e,constraint:new r.Mn(e.edgeStart,e.edgeEnd)})}get hints(){return[new o.c(n.H3.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},61751:(e,t,i)=>{i.d(t,{w:()=>s});var r=i(99791),n=i(30003);class s extends n.C{constructor(e){let{targetPoint:t,objectId:i,constraint:n,isDraped:s}=e;super(t,n,s,r.n.FEATURE),this.objectId=i}}},30003:(e,t,i)=>{i.d(t,{C:()=>r});class r{constructor(e,t,i,r){this.targetPoint=e,this.constraint=t,this.isDraped=i,this.domain=r}}},92854:(e,t,i)=>{i.d(t,{n3:()=>h,Og:()=>u});i(35238);var r=i(24648),n=i(9392),s=i(63391);i(20664),i(482);(0,n.vt)();var o=i(98799),a=i(7137),l=i(80963),d=i(90659),c=i(13312);function u(e,t){if(!(0,l.aI)(e.spatialReference,t.spatialReference))return null;const{spatialReference:i}=e;return v[0]=e.x,v[1]=e.y,v[2]=e.hasZ?e.z:0,y[0]=t.x,y[1]=t.y,y[2]=t.hasZ?t.z:0,h(v,y,i)}function h(e,t,i){return(0,d.M)(i,p,f,g,e,t,i)}function p(e,t,i){return(0,r.d_)((0,a._3)(_,e,t,i).distance,"meters")}function f(e,t,i){return(0,r.d_)((0,s.geodesicLength)(function(e,t,i){return{type:"polyline",spatialReference:i,paths:[[[...e],[...t]]]}}(e,t,i),"meters"),"meters")}function g(e,t,i){return(0,o.H)(e,i,m)&&(0,o.H)(t,i,S)?(0,r.d_)((0,a._3)(_,m,S,c.A.WGS84).distance,"meters"):null}const _=new a.Zj,v=(0,n.vt)(),y=(0,n.vt)(),m=(0,n.vt)(),S=(0,n.vt)()}}]);
//# sourceMappingURL=9565.2e1492ef.chunk.js.map