"use strict";(self.webpackChunksc_tbm=self.webpackChunksc_tbm||[]).push([[4527,8775,6141],{12016:(t,e,n)=>{n.d(e,{B:()=>c});var r=n(18690),s=n(54901),o=n(76460),i=n(50346),a=n(16783);class c{constructor(t,e,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};this._mainMethod=e,this._transferLists=n,this._listeners=[],this._promise=(0,a.ho)(t,{...s,schedule:r}).then((t=>{if(void 0===this._thread){this._thread=t,this._promise=null,s.hasInitialize&&this.broadcast({},"initialize");for(const t of this._listeners)this._connectListener(t)}else t.close()})),this._promise.catch((e=>o.A.getLogger("esri.core.workers.WorkerHandle").error("Failed to initialize ".concat(t," worker: ").concat(e))))}on(t,e){const n={removed:!1,eventName:t,callback:e,threadHandle:null};return this._listeners.push(n),this._connectListener(n),(0,s.hA)((()=>{n.removed=!0,(0,r.TF)(this._listeners,n),this._thread&&null!=n.threadHandle&&n.threadHandle.remove()}))}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(t,e){return this.invokeMethod(this._mainMethod,t,e)}invokeMethod(t,e,n){if(this._thread){const r=this._transferLists[t],s=r?r(e):[];return this._thread.invoke(t,e,{transferList:s,signal:n})}return this._promise?this._promise.then((()=>((0,i.Te)(n),this.invokeMethod(t,e,n)))):Promise.reject(null)}broadcast(t,e){return this._thread?Promise.all(this._thread.broadcast(e,t)).then((()=>{})):this._promise?this._promise.then((()=>this.broadcast(t,e))):Promise.reject()}get promise(){return this._promise}_connectListener(t){this._thread&&this._thread.on(t.eventName,t.callback).then((e=>{t.removed||(t.threadHandle=e)}))}}},77176:(t,e,n)=>{n.d(e,{b:()=>o});var r=n(15941),s=n(38496);function o(t,e,n){var o;const u=Array.isArray(t),h=u?t.length/e:t.byteLength/(4*e),d=u?t:new Uint32Array(t,0,h*e),f=null!==(o=null===n||void 0===n?void 0:n.minReduction)&&void 0!==o?o:0,g=(null===n||void 0===n?void 0:n.originalIndices)||null,p=g?g.length:0,m=(null===n||void 0===n?void 0:n.componentOffsets)||null;let v=0;if(m)for(let r=0;r<m.length-1;r++){const t=m[r+1]-m[r];t>v&&(v=t)}else v=h;const N=Math.floor(1.1*v)+1;(null==l||l.length<2*N)&&(l=new Uint32Array((0,r.cU)(2*N)));for(let r=0;r<2*N;r++)l[r]=0;let I=0;const A=!!m&&!!g,w=A?p:h;let O=(0,s.my)(h);const y=new Uint32Array(p),S=1.96;let E=0!==f?Math.ceil(4*S*S/(f*f)*f*(1-f)):w,_=1,T=m?m[1]:w;for(let r=0;r<w;r++){if(r===E){const t=1-I/r;if(t+S*Math.sqrt(t*(1-t)/r)<f)return null;E*=2}if(r===T){for(let t=0;t<2*N;t++)l[t]=0;if(g)for(let t=m[_-1];t<m[_];t++)y[t]=O[g[t]];T=m[++_]}const t=A?g[r]:r,n=t*e,s=c(d,n,e);let o=s%N,a=I;for(;0!==l[2*o+1];){if(l[2*o]===s){const t=l[2*o+1]-1;if(i(d,n,t*e,e)){a=O[t];break}}o++,o>=N&&(o-=N)}a===I&&(l[2*o]=s,l[2*o+1]=t+1,I++),O[t]=a}if(0!==f&&1-I/h<f)return null;if(A){for(let t=m[_-1];t<y.length;t++)y[t]=O[g[t]];O=(0,s.Dg)(y)}const L=u?new Array(I):new Uint32Array(I*e);I=0;for(let r=0;r<w;r++)O[r]===I&&(a(d,(A?g[r]:r)*e,L,I*e,e),I++);if(g&&!A){const t=new Uint32Array(p);for(let e=0;e<t.length;e++)t[e]=O[g[e]];O=(0,s.Dg)(t)}return{buffer:Array.isArray(L)?L:L.buffer,indices:O,uniqueCount:I}}function i(t,e,n,r){for(let s=0;s<r;s++)if(t[e+s]!==t[n+s])return!1;return!0}function a(t,e,n,r,s){for(let o=0;o<s;o++)n[r+o]=t[e+o]}function c(t,e,n){let r=0;for(let s=0;s<n;s++)r=t[e+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let l=null},12580:(t,e,n)=>{n.d(e,{L:()=>s,s:()=>o});var r=n(48549);function s(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:new r.l5(t.layout)}}function o(t){return new r.q3(t.layout).createView(t.buffer)}},74527:(t,e,n)=>{n.d(e,{U:()=>a});var r=n(78393),s=n(12016),o=n(12580),i=n(8775);class a extends s.B{constructor(t){super("EdgeProcessingWorker","extract",{extract:t=>[t.dataBuffer],extractComponentsEdgeLocations:t=>[t.dataBuffer],extractEdgeLocations:t=>[t.dataBuffer]},t)}async process(t,e,n){return n?(0,i.o6)(t):function(t){return{regular:{instancesData:(0,o.s)(t.regular.instancesData),lodInfo:{lengths:new Float32Array(t.regular.lodInfo.lengths)}},silhouette:{instancesData:(0,o.s)(t.silhouette.instancesData),lodInfo:{lengths:new Float32Array(t.silhouette.lodInfo.lengths)}},averageEdgeLength:t.averageEdgeLength}}(await this.invoke(new c(t),e))}async extractEdgeLocations(t,e){const n=await this.invokeMethod("extractEdgeLocations",new c(t),e);return(0,o.s)(n)}async extractComponentsEdgeLocations(t,e){const n=await this.invokeMethod("extractComponentsEdgeLocations",new c(t),e);return(0,o.s)(n)}}class c{constructor(t){this.dataBuffer=t.data.buffer,this.writerSettings=t.writerSettings,this.skipDeduplicate=t.skipDeduplicate,this.indices=(0,r.cy)(t.indices)?t.indices:t.indices.buffer,this.indicesType=(0,r.cy)(t.indices)?"Array":(0,r.XJ)(t.indices)?"Uint32Array":"Uint16Array",this.indicesLength=t.indicesLength}}},96141:(t,e,n)=>{n.d(e,{EdgeInputBufferLayout:()=>i,In:()=>u,gr:()=>l,vG:()=>h,vJ:()=>a,wO:()=>c});var r=n(57481),s=n(48549),o=n(66470);const i=(0,s.BP)().vec3f(o.r.POSITION).u16(o.r.COMPONENTINDEX).freeze(),a=(0,s.BP)().vec2u8(o.r.SIDENESS).freeze(),c=(0,r.U)(a),l=(0,s.BP)().vec3f(o.r.POSITION0).vec3f(o.r.POSITION1).vec2i16(o.r.NORMALCOMPRESSED).u16(o.r.COMPONENTINDEX).u8(o.r.VARIANTOFFSET,{glNormalized:!0}).u8(o.r.VARIANTSTROKE).u8(o.r.VARIANTEXTENSION,{glNormalized:!0}).freeze(),u=(0,s.BP)().vec3f(o.r.POSITION0).vec3f(o.r.POSITION1).vec2i16(o.r.NORMALCOMPRESSED).vec2i16(o.r.NORMAL2COMPRESSED).u16(o.r.COMPONENTINDEX).u8(o.r.VARIANTOFFSET,{glNormalized:!0}).u8(o.r.VARIANTSTROKE).u8(o.r.VARIANTEXTENSION,{glNormalized:!0}).freeze(),h=new Map([[o.r.POSITION0,0],[o.r.POSITION1,1],[o.r.COMPONENTINDEX,2],[o.r.VARIANTOFFSET,3],[o.r.VARIANTSTROKE,4],[o.r.VARIANTEXTENSION,5],[o.r.NORMALCOMPRESSED,6],[o.r.NORMAL2COMPRESSED,7],[o.r.SIDENESS,8]])},69413:(t,e,n)=>{n.d(e,{T:()=>v,k:()=>N});var r=n(47249),s=n(20664),o=n(9392),i=n(57481),a=n(25672),c=n(96141);class l{updateSettings(t){this.settings=t,this._edgeHashFunction=t.reducedPrecision?g:f}write(t,e,n){A.seed=this._edgeHashFunction(n);const r=A.getIntRange(0,255),s=A.getIntRange(0,this.settings.variants-1),o=A.getFloat(),i=255*(.5*function(t,e){return Math.abs(t)**e*Math.sign(t)}(-(1-Math.min(o/.7,1))+Math.max(0,o-.7)/(1-.7),1.2)+.5);t.position0.setVec(e,n.position0),t.position1.setVec(e,n.position1),t.componentIndex.set(e,n.componentIndex),t.variantOffset.set(e,r),t.variantStroke.set(e,s),t.variantExtension.set(e,i)}}const u=new Float32Array(6),h=new Uint32Array(u.buffer),d=new Uint32Array(1);function f(t){return u[0]=t.position0[0],u[1]=t.position0[1],u[2]=t.position0[2],u[3]=t.position1[0],u[4]=t.position1[1],u[5]=t.position1[2],d[0]=31*(31*(31*(31*(31*(166811+h[0])+h[1])+h[2])+h[3])+h[4])+h[5],d[0]}function g(t){const e=u;e[0]=m(t.position0[0]),e[1]=m(t.position0[1]),e[2]=m(t.position0[2]),e[3]=m(t.position1[0]),e[4]=m(t.position1[1]),e[5]=m(t.position1[2]),d[0]=5381;for(let n=0;n<h.length;n++)d[0]=31*d[0]+h[n];return d[0]}const p=1e4;function m(t){return Math.round(t*p)/p}class v{constructor(){this._commonWriter=new l}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return c.gr.createBuffer(t)}write(t,e,n){this._commonWriter.write(t,e,n),(0,s.g)(I,n.faceNormal0,n.faceNormal1),(0,s.n)(I,I);const{typedBuffer:r,typedBufferStride:o}=t.normalCompressed;(0,a.aT)(r,e,I[0],I[1],I[2],o)}}v.Layout=c.gr,v.glLayout=(0,i.U)(c.gr,1);class N{constructor(){this._commonWriter=new l}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return c.In.createBuffer(t)}write(t,e,n){this._commonWriter.write(t,e,n);{const{typedBuffer:r,typedBufferStride:s}=t.normalCompressed;(0,a.aT)(r,e,n.faceNormal0[0],n.faceNormal0[1],n.faceNormal0[2],s)}{const{typedBuffer:r,typedBufferStride:s}=t.normal2Compressed;(0,a.aT)(r,e,n.faceNormal1[0],n.faceNormal1[1],n.faceNormal1[2],s)}}}N.Layout=c.In,N.glLayout=(0,i.U)(c.In,1);const I=(0,o.vt)(),A=new r.A},7150:(t,e,n)=>{n.d(e,{K:()=>c});var r=n(15941),s=n(68930),o=n(20664),i=n(9392);const a=-1;function c(t,e,n){const r=t.vertices.position,s=t.vertices.componentIndex,i=p.position0,c=p.position1,h=p.faceNormal0,f=p.faceNormal1,{edges:g,normals:m}=u(t),v=g.length/4,N=e.allocate(v);let I=0;const A=v,y=null===n||void 0===n?void 0:n.allocate(A);let E=0,_=0,T=0;d.length=0;for(let a=0;a<v;++a){const t=4*a;r.getVec(g.data[t],i),r.getVec(g.data[t+1],c);const e=d.pushNew();e.index=4*a,e.length=(0,o.j)(i,c)}d.sort(((t,e)=>e.length-t.length));const L=new Array,M=new Array;d.forAll((t=>{let{length:u,index:d}=t;const v=g.data[d],A=g.data[d+1],P=g.data[d+2],b=g.data[d+3],k=b===a;if(r.getVec(v,i),r.getVec(A,c),k){const t=3*P;(0,o.i)(h,m.data[t],m.data[t+1],m.data[t+2]),(0,o.c)(f,h),p.componentIndex=s.get(v),p.cosAngle=(0,o.f)(h,f)}else{let t=3*P;if((0,o.i)(h,m.data[t],m.data[t+1],m.data[t+2]),t=3*b,(0,o.i)(f,m.data[t],m.data[t+1],m.data[t+2]),p.componentIndex=s.get(v),p.cosAngle=(0,o.f)(h,f),function(t,e){return t.cosAngle>e}(p,O))return;p.cosAngle<-.9999&&(0,o.c)(f,h)}_+=u,T++,k||function(t,e){return t.cosAngle<e}(p,S)?(e.write(N,I++,p),L.push(u)):l(p,w)&&(y&&n&&n.write(y,E++,p),M.push(u))}));const P=new Float32Array(L.reverse()),b=new Float32Array(M.reverse()),k=y&&n?{instancesData:y.slice(0,E),lodInfo:{lengths:b}}:void 0;return{regular:{instancesData:N.slice(0,I),lodInfo:{lengths:P}},silhouette:k,averageEdgeLength:_/T}}function l(t,e){const n=(0,r.XM)(t.cosAngle);return(0,o.o)(v,t.position1,t.position0),n*((0,o.f)((0,o.e)(m,t.faceNormal0,t.faceNormal1),v)>0?-1:1)>e}function u(t){const e=t.faces.length/3,n=t.faces,r=t.neighbors,s=t.vertices.position;f.length=g.length=0;for(let i=0;i<e;i++){const t=3*i,e=r[t],c=r[t+1],l=r[t+2],u=n[t],h=n[t+1],d=n[t+2];s.getVec(u,N),s.getVec(h,I),s.getVec(d,A),(0,o.d)(I,I,N),(0,o.d)(A,A,N),(0,o.e)(N,I,A),(0,o.n)(N,N),g.pushArray(N),(e===a||u<h)&&(f.push(u),f.push(h),f.push(i),f.push(e)),(c===a||h<d)&&(f.push(h),f.push(d),f.push(i),f.push(c)),(l===a||d<u)&&(f.push(d),f.push(u),f.push(i),f.push(l))}return{edges:f,normals:g}}class h{constructor(){this.index=0,this.length=0}}const d=new s.A({allocator:t=>t||new h,deallocator:null}),f=new s.A({deallocator:null}),g=new s.A({deallocator:null}),p=new class{constructor(){this.position0=(0,i.vt)(),this.position1=(0,i.vt)(),this.faceNormal0=(0,i.vt)(),this.faceNormal1=(0,i.vt)(),this.componentIndex=0,this.cosAngle=0}},m=(0,i.vt)(),v=(0,i.vt)(),N=(0,i.vt)(),I=(0,i.vt)(),A=(0,i.vt)(),w=(0,r.kU)(4),O=Math.cos(w),y=(0,r.kU)(35),S=Math.cos(y)},8775:(t,e,n)=>{n.d(e,{o6:()=>u,extractComponentsEdgeLocationsLayout:()=>m,hx:()=>h,Jb:()=>p});var r=n(77176);function s(t,e,n){const r=e/3,s=new Uint32Array(n+1),o=new Uint32Array(n+1),i=(t,e)=>{t<e?s[t+1]++:o[e+1]++};for(let v=0;v<r;v++){const e=t[3*v],n=t[3*v+1],r=t[3*v+2];i(e,n),i(n,r),i(r,e)}let a=0,c=0;for(let v=0;v<n;v++){const t=s[v+1],e=o[v+1];s[v+1]=a,o[v+1]=c,a+=t,c+=e}const l=new Uint32Array(6*r),u=s[n],h=(t,e,n)=>{if(t<e){const r=s[t+1]++;l[2*r]=e,l[2*r+1]=n}else{const r=o[e+1]++;l[2*u+2*r]=t,l[2*u+2*r+1]=n}};for(let v=0;v<r;v++){const e=t[3*v],n=t[3*v+1],r=t[3*v+2];h(e,n,v),h(n,r,v),h(r,e,v)}const d=(t,e)=>{const n=2*t,r=e-t;for(let s=1;s<r;s++){const t=l[n+2*s],e=l[n+2*s+1];let r=s-1;for(;r>=0&&l[n+2*r]>t;r--)l[n+2*r+2]=l[n+2*r],l[n+2*r+3]=l[n+2*r+1];l[n+2*r+2]=t,l[n+2*r+3]=e}};for(let v=0;v<n;v++)d(s[v],s[v+1]),d(u+o[v],u+o[v+1]);const f=new Int32Array(3*r),g=(e,n)=>e===t[3*n]?0:e===t[3*n+1]?1:e===t[3*n+2]?2:-1,p=(t,e)=>{const n=g(t,e);f[3*e+n]=-1},m=(t,e,n,r)=>{const s=g(t,e);f[3*e+s]=r;const o=g(n,r);f[3*r+o]=e};for(let v=0;v<n;v++){let t=s[v];const e=s[v+1];let n=o[v];const r=o[v+1];for(;t<e&&n<r;){const e=l[2*t],r=l[2*u+2*n];e===r?(m(v,l[2*t+1],r,l[2*u+2*n+1]),t++,n++):e<r?(p(v,l[2*t+1]),t++):(p(r,l[2*u+2*n+1]),n++)}for(;t<e;)p(v,l[2*t+1]),t++;for(;n<r;)p(l[2*u+2*n],l[2*u+2*n+1]),n++}return f}var o=n(48549),i=n(66470),a=n(96141),c=n(69413),l=n(7150);function u(t){const e=h(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return f.updateSettings(t.writerSettings),g.updateSettings(t.writerSettings),(0,l.K)(e,f,g)}function h(t,e,n,o){if(e){const e=s(n,o,t.count);return new d(n,o,e,t)}const i=(0,r.b)(t.buffer,t.stride/4,{originalIndices:n,originalIndicesLength:o}),c=s(i.indices,o,i.uniqueCount);return{faces:i.indices,facesLength:i.indices.length,neighbors:c,vertices:a.EdgeInputBufferLayout.createView(i.buffer)}}class d{constructor(t,e,n,r){this.faces=t,this.facesLength=e,this.neighbors=n,this.vertices=r}}const f=new c.T,g=new c.k,p=(0,o.BP)().vec3f(i.r.POSITION0).vec3f(i.r.POSITION1),m=(0,o.BP)().vec3f(i.r.POSITION0).vec3f(i.r.POSITION1).u16(i.r.COMPONENTINDEX)}}]);
//# sourceMappingURL=4527.4563b2ab.chunk.js.map