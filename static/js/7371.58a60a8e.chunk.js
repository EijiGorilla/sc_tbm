"use strict";(self.webpackChunksc_tbm=self.webpackChunksc_tbm||[]).push([[7371],{80069:(e,t,n)=>{n.d(t,{F:()=>c,a:()=>d,b:()=>h});var r,i=n(57528),o=n(73398),s=n(72790),l=n(64839),a=n(32307),u=n(70367);class c extends l.Y{}function h(){const e=new a.N5;return e.include(o.c),e.outputs.add("fragColor","vec4",0),e.fragment.uniforms.add(new u.N("colorTexture",(e=>e.color)),new u.N("focusArea",(e=>e.focusArea)),new s.c("focusAreaEffectMode",(e=>{var t;return null!==(t=e.effect)&&void 0!==t?t:1}))).main.add((0,l.H)(r||(r=(0,i.A)(["float mask = texture( focusArea, uv, 0.0 ).r;\nvec4 color = texture( colorTexture, uv, 0.0 );\nvec4 colorDeSaturate = vec4(color.r * 0.25 + color.g * 0.5 + color.b * 0.25);\nif (focusAreaEffectMode == 1) {\nfragColor = mask > 0.0 ? color : 0.55 * colorDeSaturate + 0.45;\n} else {\nfragColor = mask > 0.0 ? color : 0.33 * mix(color, colorDeSaturate, 0.);\n}"])))),e}const d=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaColorPassParameters:c,build:h},Symbol.toStringTag,{value:"Module"}))},40366:(e,t,n)=>{n.d(t,{F:()=>f,a:()=>x,b:()=>v});var r,i,o=n(57528),s=n(34761),l=n(13191),a=n(9392),u=n(64839),c=n(43425),h=n(32307),d=n(66470);class f extends u.Y{constructor(){super(...arguments),this.origin=a.uY}}function v(){const e=new h.N5;return e.attributes.add(d.r.POSITION,"vec3"),e.outputs.add("fragColor","vec4",0),e.vertex.uniforms.add(new c.X("proj",((e,t)=>t.camera.projectionMatrix)),new c.X("view",((e,t)=>(0,s.Tl)(p,t.camera.viewMatrix,e.origin)))).main.add((0,u.H)(r||(r=(0,o.A)(["gl_Position = proj * view * vec4(position, 1.0);"])))),e.fragment.main.add((0,u.H)(i||(i=(0,o.A)(["fragColor = vec4(1., 0., 0., 1.);"])))),e}const p=(0,l.vt)(),x=Object.freeze(Object.defineProperty({__proto__:null,FocusAreaMaskPassParameters:f,build:v},Symbol.toStringTag,{value:"Module"}))},38983:(e,t,n)=>{function r(e,t,n){n=n||2;var r,o,l,a,u,c,d,f=t&&t.length,v=f?t[0]*n:e.length,p=i(e,0,v,n,!0),x=[];if(!p||p.next===p.prev)return x;if(f&&(p=h(e,t,p,n)),e.length>80*n){r=l=e[0],o=a=e[1];for(var y=n;y<v;y+=n)(u=e[y])<r&&(r=u),(c=e[y+1])<o&&(o=c),u>l&&(l=u),c>a&&(a=c);d=0!==(d=Math.max(l-r,a-o))?1/d:0}return s(p,x,n,r,o,d),x}function i(e,t,n,r,i){var o,s;if(i===R(e,t,n,r)>0)for(o=t;o<n;o+=r)s=N(o,e[o],e[o+1],s);else for(o=n-r;o>=t;o-=r)s=N(o,e[o],e[o+1],s);if(s&&m(s,s.next)){var l=s.next;S(s),s=l}return s}function o(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==A(r.prev,r,r.next))r=r.next;else{var i=r.prev;if(S(r),(r=t=i)===r.next)break;n=!0}}while(n||r!==t);return t}function s(e,t,n,r,i,h,d){if(e){!d&&h&&x(e,r,i,h);for(var f,v,p=e;e.prev!==e.next;)if(f=e.prev,v=e.next,h?a(e,r,i,h):l(e))t.push(f.i/n),t.push(e.i/n),t.push(v.i/n),S(e),e=v.next,p=v.next;else if((e=v)===p){d?1===d?s(e=u(o(e),t,n),t,n,r,i,h,2):2===d&&c(e,t,n,r,i,h):s(o(e),t,n,r,i,h,1);break}}}function l(e){var t=e.prev,n=e,r=e.next;if(A(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(_(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&A(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function a(e,t,n,r){var i=e.prev,o=e,s=e.next;if(A(i,o,s)>=0)return!1;for(var l=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,a=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,u=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,c=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,h=y(l,a,t,n,r),d=y(u,c,t,n,r),f=e.prevZ,v=e.nextZ;f&&f.z>=h&&v&&v.z<=d;){if(f!==e.prev&&f!==e.next&&_(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&A(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,v!==e.prev&&v!==e.next&&_(i.x,i.y,o.x,o.y,s.x,s.y,v.x,v.y)&&A(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;f&&f.z>=h;){if(f!==e.prev&&f!==e.next&&_(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&A(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;v&&v.z<=d;){if(v!==e.prev&&v!==e.next&&_(i.x,i.y,o.x,o.y,s.x,s.y,v.x,v.y)&&A(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function u(e,t,n){var r=e;do{var i=r.prev,s=r.next.next;!m(i,s)&&b(i,r,r.next,s)&&C(i,s)&&C(s,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(s.i/n),S(r),S(r.next),r=e=s),r=r.next}while(r!==e);return o(r)}function c(e,t,n,r,i,l){var a=e;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&w(a,u)){var c=Z(a,u);return a=o(a,a.next),c=o(c,c.next),s(a,t,n,r,i,l),void s(c,t,n,r,i,l)}u=u.next}a=a.next}while(a!==e)}function h(e,t,n,r){var s,l,a,u=[];for(s=0,l=t.length;s<l;s++)(a=i(e,t[s]*r,s<l-1?t[s+1]*r:e.length,r,!1))===a.next&&(a.steiner=!0),u.push(g(a));for(u.sort(d),s=0;s<u.length;s++)n=o(n=v(u[s],n),n.next);return n}function d(e,t){return e.x-t.x}function f(e){if(e.next.prev===e)return e;let t=e;for(;;){const n=t.next;if(n.prev===t||n===t||n===e)break;t=n}return t}function v(e,t){var n=function(e,t){var n,r=t,i=e.x,o=e.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var l=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(l<=i&&l>s){if(s=l,l===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===s)return n;var a,u=n,c=n.x,h=n.y,d=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&_(o<h?i:s,o,c,h,o<h?s:i,o,r.x,r.y)&&(a=Math.abs(o-r.y)/(i-r.x),C(r,e)&&(a<d||a===d&&(r.x>n.x||r.x===n.x&&p(n,r)))&&(n=r,d=a)),r=r.next}while(r!==u);return n}(e,t);if(!n)return t;var r=Z(n,e),i=o(n,n.next);let s=f(r);return o(s,s.next),i=f(i),f(t===n?i:t)}function p(e,t){return A(e.prev,e,t.prev)<0&&A(t.next,e,e.next)<0}function x(e,t,n,r){var i=e;do{null===i.z&&(i.z=y(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,s,l,a,u=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,r=n,l=0,t=0;t<u&&(l++,r=r.nextZ);t++);for(a=u;l>0||a>0&&r;)0!==l&&(0===a||!r||n.z<=r.z)?(i=n,n=n.nextZ,l--):(i=r,r=r.nextZ,a--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,u*=2}while(s>1)}(i)}function y(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function g(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function _(e,t,n,r,i,o,s,l){return(i-s)*(t-l)-(e-s)*(o-l)>=0&&(e-s)*(r-l)-(n-s)*(t-l)>=0&&(n-s)*(o-l)-(i-s)*(r-l)>=0}function w(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&b(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(C(e,t)&&C(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(A(e.prev,e,t.prev)||A(e,t.prev,t))||m(e,t)&&A(e.prev,e,e.next)>0&&A(t.prev,t,t.next)>0)}function A(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,n,r){var i=M(A(e,t,n)),o=M(A(e,t,r)),s=M(A(n,r,e)),l=M(A(n,r,t));return i!==o&&s!==l||!(0!==i||!E(e,n,t))||!(0!==o||!E(e,r,t))||!(0!==s||!E(n,e,r))||!(0!==l||!E(n,t,r))}function E(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function M(e){return e>0?1:e<0?-1:0}function C(e,t){return A(e.prev,e,e.next)<0?A(e,t,e.next)>=0&&A(e,e.prev,t)>=0:A(e,t,e.prev)<0||A(e,e.next,t)<0}function Z(e,t){var n=new T(e.i,e.x,e.y),r=new T(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function N(e,t,n,r){var i=new T(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function S(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function T(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function R(e,t,n,r){for(var i=0,o=t,s=n-r;o<n;o+=r)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}n.d(t,{e:()=>r}),r.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,s=Math.abs(R(e,0,o,n));if(i)for(var l=0,a=t.length;l<a;l++){var u=t[l]*n,c=l<a-1?t[l+1]*n:e.length;s-=Math.abs(R(e,u,c,n))}var h=0;for(l=0;l<r.length;l+=3){var d=r[l]*n,f=r[l+1]*n,v=r[l+2]*n;h+=Math.abs((e[d]-e[v])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[v+1]-e[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},r.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var s=0;s<t;s++)n.vertices.push(e[i][o][s]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n}},77176:(e,t,n)=>{n.d(t,{b:()=>o});var r=n(15941),i=n(38496);function o(e,t,n){var o;const c=Array.isArray(e),h=c?e.length/t:e.byteLength/(4*t),d=c?e:new Uint32Array(e,0,h*t),f=null!==(o=null===n||void 0===n?void 0:n.minReduction)&&void 0!==o?o:0,v=(null===n||void 0===n?void 0:n.originalIndices)||null,p=v?v.length:0,x=(null===n||void 0===n?void 0:n.componentOffsets)||null;let y=0;if(x)for(let r=0;r<x.length-1;r++){const e=x[r+1]-x[r];e>y&&(y=e)}else y=h;const g=Math.floor(1.1*y)+1;(null==u||u.length<2*g)&&(u=new Uint32Array((0,r.cU)(2*g)));for(let r=0;r<2*g;r++)u[r]=0;let _=0;const w=!!x&&!!v,A=w?p:h;let m=(0,i.my)(h);const b=new Uint32Array(p),E=1.96;let M=0!==f?Math.ceil(4*E*E/(f*f)*f*(1-f)):A,C=1,Z=x?x[1]:A;for(let r=0;r<A;r++){if(r===M){const e=1-_/r;if(e+E*Math.sqrt(e*(1-e)/r)<f)return null;M*=2}if(r===Z){for(let e=0;e<2*g;e++)u[e]=0;if(v)for(let e=x[C-1];e<x[C];e++)b[e]=m[v[e]];Z=x[++C]}const e=w?v[r]:r,n=e*t,i=a(d,n,t);let o=i%g,l=_;for(;0!==u[2*o+1];){if(u[2*o]===i){const e=u[2*o+1]-1;if(s(d,n,e*t,t)){l=m[e];break}}o++,o>=g&&(o-=g)}l===_&&(u[2*o]=i,u[2*o+1]=e+1,_++),m[e]=l}if(0!==f&&1-_/h<f)return null;if(w){for(let e=x[C-1];e<b.length;e++)b[e]=m[v[e]];m=(0,i.Dg)(b)}const N=c?new Array(_):new Uint32Array(_*t);_=0;for(let r=0;r<A;r++)m[r]===_&&(l(d,(w?v[r]:r)*t,N,_*t,t),_++);if(v&&!w){const e=new Uint32Array(p);for(let t=0;t<e.length;t++)e[t]=m[v[t]];m=(0,i.Dg)(e)}return{buffer:Array.isArray(N)?N:N.buffer,indices:m,uniqueCount:_}}function s(e,t,n,r){for(let i=0;i<r;i++)if(e[t+i]!==e[n+i])return!1;return!0}function l(e,t,n,r,i){for(let o=0;o<i;o++)n[r+o]=e[t+o]}function a(e,t,n){let r=0;for(let i=0;i<n;i++)r=e[t+i]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let u=null},10294:(e,t,n)=>{n.d(t,{S:()=>a});var r=n(15941),i=n(31633),o=n(20664),s=n(5568),l=n(13927);function a(e,t,n){const a=function(e,t,n,r){const s=(e=>!Array.isArray(e[0]))(t)?(e,n)=>t[3*e+n]:(e,n)=>t[e][n],a=r?(0,i.GA)(r)/(0,i.G9)(r):1;return(0,l.lU)(e,((e,t)=>(0,o.i)(e,s(t,0)*a,s(t,1)*a,s(t,2))),n)}(u,e,t,n)?(0,l.Qj)(u):[0,0,1];return Math.abs(a[2])>Math.cos((0,r.kU)(80))?s._.Z:Math.abs(a[1])>Math.abs(a[0])?s._.Y:s._.X}const u=(0,l.vt)()},99785:(e,t,n)=>{n.d(t,{Wq:()=>r,lO:()=>d,oR:()=>f});var r,i,o=n(38983),s=n(5568),l=n(5262),a=n(44815),u=n(38496),c=n(10294),h=n(77176);function d(e){const t=f(e.rings,e.hasZ,r.CCW_IS_HOLE,e.spatialReference),n=new Array;let i=0,s=0;for(const r of t.polygons){const e=r.count,l=r.index,c=(0,a.l5)(t.position,3*l,3*e),h=r.holeIndices.map((e=>e-l)),d=(0,u.Dg)((0,o.e)(c,h,3));n.push({position:c,faces:d}),i+=c.length,s+=d.length}const l=function(e,t,n){if(1===e.length)return e[0];const r=(0,a.jh)(t),i=new Array(n);let o=0,s=0,l=0;for(const a of e){for(let e=0;e<a.position.length;e++)r[o++]=a.position[e];for(const e of a.faces)i[s++]=e+l;l=o/3}return{position:r,faces:(0,u.Dg)(i)}}(n,i,s),c=Array.isArray(l.position)?(0,h.b)(l.position,3,{originalIndices:l.faces}):(0,h.b)(l.position.buffer,6,{originalIndices:l.faces});return l.position=(0,a.xm)(new Float64Array(c.buffer)),l.faces=c.indices,l}function f(e,t,n,i){const o=e.length,s=new Array(o),l=new Array(o),u=new Array(o);let c=0;for(let r=0;r<o;++r)c+=e[r].length;let h=0,d=0,f=0;const x=(0,a.jh)(3*c);let y=0;for(let a=o-1;a>=0;a--){const c=e[a],g=n===r.CCW_IS_HOLE&&p(c,t,i);if(g&&1!==o)s[h++]=c;else{let e=c.length;for(let t=0;t<h;++t)e+=s[t].length;const n={index:y,pathLengths:new Array(h+1),count:e,holeIndices:new Array(h)};n.pathLengths[0]=c.length,c.length>0&&(u[f++]={index:y,count:c.length}),y=g?v(c,c.length-1,-1,x,y,c.length,t):v(c,0,1,x,y,c.length,t);for(let r=0;r<h;++r){const e=s[r];n.holeIndices[r]=y,n.pathLengths[r+1]=e.length,e.length>0&&(u[f++]={index:y,count:e.length}),y=v(e,0,1,x,y,e.length,t)}h=0,n.count>0&&(l[d++]=n)}}for(let r=0;r<h;++r){const e=s[r];e.length>0&&(u[f++]={index:y,count:e.length}),y=v(e,0,1,x,y,e.length,t)}return l.length=d,u.length=f,{position:x,polygons:l,outlines:u}}function v(e,t,n,r,i,o,s){i*=3;for(let l=0;l<o;++l){const o=e[t];r[i++]=o[0],r[i++]=o[1],r[i++]=s&&o[2]?o[2]:0,t+=n}return i/3}function p(e,t,n){if(!t)return!(0,l.$3)(e);const r=e.length-1;switch((0,c.S)(e,r,n)){case s._.X:return!(0,l.$3)(e,s._.Y,s._.Z);case s._.Y:return!(0,l.$3)(e,s._.X,s._.Z);case s._.Z:return!(0,l.$3)(e,s._.X,s._.Y)}}(i=r||(r={}))[i.NONE=0]="NONE",i[i.CCW_IS_HOLE=1]="CCW_IS_HOLE"},66185:(e,t,n)=>{n.r(t),n.d(t,{default:()=>V});var r=n(35143),i=n(30726),o=n(68134),s=n(46053),l=n(85842),a=n(38983),u=n(13191),c=n(20664),h=n(9392),d=n(5809),f=n(44815),v=n(38496),p=n(45136),x=n(64465),y=n(83491),g=n(49296),_=n(16266),w=n(36423),A=n(87925),m=(n(81806),n(76460),n(47249),n(16455)),b=n(36451),E=n(16506),M=n(59246),C=n(80069),Z=n(57162);class N extends M.w{constructor(e,t,r){super(e,t,new E.$(C.a,(()=>n.e(5915).then(n.bind(n,75915)))),r)}initializePipeline(){return(0,Z.Ey)({colorWrite:Z.kn})}}var S=n(40366),T=n(93345);class R extends M.w{constructor(e,t,r){super(e,t,new E.$(S.a,(()=>n.e(7144).then(n.bind(n,47144)))),r)}initializePipeline(){return(0,Z.Ey)({colorWrite:Z.kn,depthTest:{func:T.MT.LEQUAL}})}}var I=n(32119),P=n(11850),O=n(69008),H=n(76718);let F=class extends b.A{constructor(e){super(e),this.consumes={required:["final-color"]},this.produces="final-color",this.focusAreaGeometries=new Array,this._vaos=Array(),this._count=new Array,this._origins=new Array,this._colorParameters=new C.F,this._maskParameters=new S.F,e.techniques.precompile(R),e.techniques.precompile(N)}initialize(){this.setExtrudedVolume()}destroy(){this._vaos.forEach((e=>e.dispose())),this._vaos=[],this._count=[],this._origins=[]}render(e){const t=this.techniques.acquire(R),n=this.techniques.acquire(N),r=this.bindParameters,i=e.find((e=>{let{name:t}=e;return"final-color"===t})),o=null===i||void 0===i?void 0:i.getTexture(),s=r.camera,l=s.fullViewport[2],a=s.fullViewport[3],u=this.fboCache.acquire(l,a,"focusArea",m.N.RGBA),c=this.fboCache.acquire(l,a,this.produces);if(!t.compiled||!n.compiled||!this._vaos||this.effect===k.NONE)return this.requestRender(),t.release(),n.release(),c.release(),u.release(),i;const h=this.renderingContext;u.attachDepth(i.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),h.bindFramebuffer(u.fbo),h.clear(T.NV.COLOR|T.NV.STENCIL),h.setViewport(0,0,l,a),h.gl.clearStencil(0),h.gl.clear(h.gl.STENCIL_BUFFER_BIT),h.setClearStencil(0);for(let d=0;d<this._vaos.length;d++){const e=this._vaos[d],n=this._count[d];e&&(this._maskParameters.origin=this._origins[d],h.bindTechnique(t,r,this._maskParameters),h.setFaceCullingEnabled(!1),h.setStencilTestEnabled(!0),h.setStencilWriteMask(255),h.setStencilFunction(T.MT.ALWAYS,0,255),h.setStencilOpSeparate(T.Y7.FRONT,T.eA.KEEP,T.eA.INCR_WRAP,T.eA.KEEP),h.setStencilOpSeparate(T.Y7.BACK,T.eA.KEEP,T.eA.DECR_WRAP,T.eA.KEEP),h.setDepthWriteEnabled(!1),h.setColorMask(!1,!1,!1,!1),h.bindVAO(e),h.drawArrays(T.WR.TRIANGLES,0,n),h.setFaceCullingEnabled(!1),h.setDepthTestEnabled(!1),h.setStencilFunction(T.MT.NOTEQUAL,0,255),h.setStencilWriteMask(0),h.setColorMask(!0,!0,!0,!0),h.drawArrays(T.WR.TRIANGLES,0,n))}return t.release(),h.gl.clear(h.gl.STENCIL_BUFFER_BIT),h.bindFramebuffer(c.fbo),this._colorParameters.color=o,this._colorParameters.focusArea=u.getTexture(),this._colorParameters.effect=this.effect,h.bindTechnique(n,r,this._colorParameters),h.screen.draw(),u.release(),n.release(),c.attachDepth(i.getAttachment(this.gl.DEPTH_STENCIL_ATTACHMENT)),c}setExtrudedVolume(){const e=this.focusAreaGeometries;this._vaos=[],this._count=[],this._origins=[];for(let n=0;n<e.length;n++){var t;const r=e[n],i=new Array,o=r.indicesBottom;this._origins.push(r.origin);for(let e=0;e<o.length;e++)i.push(r.positions[3*(o[e]-1)]),i.push(r.positions[3*(o[e]-1)+1]),i.push(r.positions[3*(o[e]-1)+2]);const s=r.indicesExtruded;for(let e=0;e<s.length;e++)i.push(r.positions[3*s[e]]),i.push(r.positions[3*s[e]+1]),i.push(r.positions[3*s[e]+2]);const l=new Float32Array(i),a=new O.Z(this.renderingContext,I.D,new Map([["geometry",P.SL]]),new Map([["geometry",H.g.createVertex(this.renderingContext,T._U.STATIC_DRAW,l)]]));null!==(t=this._vaos)&&void 0!==t&&t.push(a),this._count.push(o.length+s.length)}}};(0,r._)([(0,s.MZ)()],F.prototype,"consumes",void 0),(0,r._)([(0,s.MZ)()],F.prototype,"produces",void 0),(0,r._)([(0,s.MZ)({constructOnly:!0})],F.prototype,"techniques",void 0),(0,r._)([(0,s.MZ)()],F.prototype,"focusAreaGeometries",void 0),(0,r._)([(0,s.MZ)()],F.prototype,"effect",void 0),F=(0,r._)([(0,l.$)("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaRenderNode")],F);class L{constructor(e,t,n,r,i){this.positions=e,this.indicesBottom=t,this.indicesExtruded=n,this.height=r,this.origin=i}}var k,D;(D=k||(k={}))[D.NONE=0]="NONE",D[D.BRIGHT=1]="BRIGHT",D[D.DARK=2]="DARK";const q={none:k.NONE,bright:k.BRIGHT,dark:k.DARK};var U=n(91196);let W=class extends((0,y.w)(U.A)){constructor(){super(...arguments),this.type="focusArea-3d",this._elevationContext=new g.F,this._geometries=new Array}initialize(){this.addHandles([(0,o.wB)((()=>this.layer.geometries),((e,t)=>{t=e,this._extrudePolygons(t),this._setFocusAreaRenderNode()}),o.pc),(0,o.wB)((()=>this.layer.tmpEffect),((e,t)=>{t=e,this._renderNode&&t&&(this._renderNode.effect=q[t])}),o.pc),(0,o.wB)((()=>this.layer.visible),((e,t)=>{var n,r;e?null!==(n=this._renderNode)&&void 0!==n||(this._renderNode=new F({view:this.view,techniques:this.view._stage.renderView.techniques,focusAreaGeometries:this._geometries,effect:q[null!==(r=this.layer.tmpEffect)&&void 0!==r?r:"none"]})):this._renderNode=(0,i.pR)(this._renderNode)}),o.pc)])}destroy(){this._renderNode=(0,i.pR)(this._renderNode),this._geometries=[]}_extrudePolygons(e){this._geometries=[];for(const t of e){const e=(0,u.vt)(),n=(0,h.vt)(),r=this.view.renderCoordsHelper.viewingMode===x.RT.Global;r||this.view.renderCoordsHelper.worldUpAtPosition(null,n);const i=(0,w.W$)(t);if(null==i)return;(0,d.l)(t.spatialReference,[i.x,i.y,0],e,this.view.renderCoordsHelper.spatialReference);const o=(0,c.n)(z,[e[12]-0*n[0],e[13]-0*n[1],e[14]-0*n[2]]),s=(0,u.vt)();s[12]=-e[12],s[13]=-e[13],s[14]=-e[14];const l=(0,A.C8)(t,this.view.elevationProvider,this.view.renderCoordsHelper,this._elevationContext),{polygons:y,mapPositions:g,position:m}=l;for(const t of y){const i=t.count,l=(0,a.e)(t.mapPositions,t.holeIndices,3);if(0===l.length)continue;const u=l.length,c=6*i,h=(0,v.my)(c+u),d=(0,v.my)(u),x=(0,f.jh)(3*c),y=(0,f.jh)(3*c),w=(0,f.jh)(3*c),A=(0,f.jh)(c);(0,_.K)(m,g,l,t,x,w,y,A,h,d,1e4,n,r),(0,p.t)(x,x,s);const b=new L(x,d,h,1e4,[e[12]+0*o[0],e[13]+0*o[1],e[14]+0*o[2]]);this._geometries.push(b)}}}_setFocusAreaRenderNode(){var e;this._renderNode?(this._renderNode.focusAreaGeometries=this._geometries,this._renderNode.setExtrudedVolume()):this._renderNode=new F({view:this.view,techniques:this.view._stage.renderView.techniques,focusAreaGeometries:this._geometries,effect:q[null!==(e=this.layer.tmpEffect)&&void 0!==e?e:"none"]})}};(0,r._)([(0,s.MZ)()],W.prototype,"type",void 0),(0,r._)([(0,s.MZ)()],W.prototype,"layer",void 0),W=(0,r._)([(0,l.$)("esri.views.3d.layers.FocusAreaLayerView3D")],W);const z=(0,h.vt)(),V=W},83491:(e,t,n)=>{n.d(t,{w:()=>c});var r=n(35143),i=n(54901),o=n(50346),s=n(68134),l=n(46053),a=(n(81806),n(76460),n(47249),n(85842)),u=n(47700);const c=e=>{let t=class extends e{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(){super.postscript(),(0,u.jI)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.addHandles((0,i.hA)((()=>e.abort()))),await(0,s.C_)((()=>{var e;return null===(e=this.view.defaultsFromMap)||void 0===e?void 0:e.heightModelInfoReady}),t),(0,o.Te)(t);const n=(0,u.Hu)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(n)throw n}};return(0,r._)([(0,l.MZ)()],t.prototype,"view",void 0),(0,r._)([(0,l.MZ)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,r._)([(0,a.$)("esri.views.3d.layers.LayerView3D")],t),t}},91196:(e,t,n)=>{n.d(t,{A:()=>p});var r=n(35143),i=n(91967),o=n(54099),s=n(5632),l=n(76460),a=n(30726),u=n(91291),c=n(46053),h=(n(81806),n(47249),n(85842)),d=n(19451),f=n(90992);let v=class extends((0,s.sA)((0,u.g)(o.A.EventedMixin(i.A)))){constructor(e){super(e),this._updatingHandles=new d.U,this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){var t;const n=this.layer&&this.layer.id||"no id",r=(null===(t=this.layer)||void 0===t?void 0:t.title)||"no title";l.A.getLogger(this).error("#resolve()","Failed to resolve layer view (layer title: '".concat(r,"', id: '").concat(n,"')"),e)}}))}destroy(){this._updatingHandles=(0,a.pR)(this._updatingHandles)}get fullOpacity(){var e,t,n,r;return(null!==(e=null===(t=this.layer)||void 0===t?void 0:t.opacity)&&void 0!==e?e:1)*(null!==(n=null===(r=this.parent)||void 0===r?void 0:r.fullOpacity)&&void 0!==n?n:1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var e;return!this.suspended&&!0===(null===(e=this.layer)||void 0===e?void 0:e.legendEnabled)}get updating(){var e;return!((null===(e=this._updatingHandles)||void 0===e||!e.updating)&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){var e;return!0===(null===(e=this.layer)||void 0===e?void 0:e.visible)}set visible(e){this._overrideIfSome("visible",e)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){var e;const t=this.view.timeExtent,n=null===(e=this.layer)||void 0===e?void 0:e.visibilityTimeExtent;return!t||!n||!t.intersection(n).isEmpty}canResume(){var e,t,n;const r=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&(null===(e=this.layer)||void 0===e?void 0:e.loaded)&&!(null!==(t=this.parent)&&void 0!==t&&t.suspended)&&(null===(n=this.view)||void 0===n?void 0:n.ready)&&(0,f.g7)(r)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){var e,t;const n=null!==(e=this.parent)&&void 0!==e&&e.suspended?this.parent.suspendInfo:{};null!==(t=this.view)&&void 0!==t&&t.ready||(n.viewNotReady=!0),this.layer&&this.layer.loaded||(n.layerNotLoaded=!0);const r=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,f.g7)(r)&&this.visibleAtCurrentScale||(n.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(n.outsideVisibilityTimeExtent=!0),this.visible||(n.layerInvisible=!0),n}isUpdating(){return!1}};(0,r._)([(0,c.MZ)()],v.prototype,"view",void 0),(0,r._)([(0,c.MZ)()],v.prototype,"fullOpacity",null),(0,r._)([(0,c.MZ)()],v.prototype,"layer",void 0),(0,r._)([(0,c.MZ)()],v.prototype,"parent",void 0),(0,r._)([(0,c.MZ)({readOnly:!0})],v.prototype,"suspended",null),(0,r._)([(0,c.MZ)({readOnly:!0})],v.prototype,"suspendInfo",null),(0,r._)([(0,c.MZ)({readOnly:!0})],v.prototype,"legendEnabled",null),(0,r._)([(0,c.MZ)({type:Boolean,readOnly:!0})],v.prototype,"updating",null),(0,r._)([(0,c.MZ)({readOnly:!0})],v.prototype,"updatingProgress",null),(0,r._)([(0,c.MZ)()],v.prototype,"updateSuspended",null),(0,r._)([(0,c.MZ)()],v.prototype,"visible",null),(0,r._)([(0,c.MZ)({readOnly:!0})],v.prototype,"visibleAtCurrentScale",null),(0,r._)([(0,c.MZ)({readOnly:!0})],v.prototype,"visibleAtCurrentTimeExtent",null),v=(0,r._)([(0,h.$)("esri.views.layers.LayerView")],v);const p=v}}]);
//# sourceMappingURL=7371.58a60a8e.chunk.js.map