"use strict";(self.webpackChunksc_tbm=self.webpackChunksc_tbm||[]).push([[5955],{96820:(e,t,i)=>{i.d(t,{Ee:()=>h,Sz:()=>_,W4:()=>p,t_:()=>u,tr:()=>c,v7:()=>g,zJ:()=>d,zq:()=>v});var n=i(55877),o=(i(73582),i(15941)),s=(i(24648),i(88685)),r=i(31633),a=i(50265);function l(e,t,i){return e.units[t][i]}function d(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return"".concat((0,a.ZV)(t,{minimumFractionDigits:n,maximumFractionDigits:n,signDisplay:t>0?"never":"exceptZero"})," ").concat(l(e,i,o))}function h(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";const s=(0,r.x0)(t,i);return d(e,(0,r.oU)(t,i,s),s,n,o)}function p(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";const s=(0,r.x$)(t,i);return d(e,(0,r.oU)(t,i,s),s,n,o)}function c(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";const s=(0,r.OU)(t,i);return d(e,(0,r.oU)(t,i,s),s,n,o)}function u(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";const s=(0,r.y7)(t,i);return d(e,(0,r.oU)(t,i,s),s,n,o)}function v(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";const s=(0,r.wv)(t,i);return d(e,(0,r.oU)(t,i,s),s,n,o)}function _(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";const s=(0,r.TL)(t,i);return d(e,(0,r.oU)(t,i,s),s,n,o)}new Map;const m=["B","kB","MB","GB","TB"];function g(e,t){let i=0===(t=Math.round(t))?0:Math.floor(Math.log(t)/Math.log(n.u.KILOBYTES));i=(0,o.qE)(i,0,m.length-1);const r=(0,a.ZV)(t/n.u.KILOBYTES**i,{maximumFractionDigits:2});return(0,s.HC)(e.units.bytes[m[i]],{fileSize:r})}},4955:(e,t,i)=>{function n(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function o(e,t){var i;return"number"==typeof e?e:null!==e&&void 0!==e&&null!==(i=e.stops)&&void 0!==i&&i.length?function(e){let t=0,i=0;for(let n=0;n<e.length;n++){const o=e[n].size;"number"==typeof o&&(t+=o,i++)}return t/i}(e.stops):t}function s(e,t){if(!t)return e;const i=t.filter((e=>"size"===e.type)).map((t=>{const{maxSize:i,minSize:n}=t;return(o(i,e)+o(n,e))/2}));let n=0;const s=i.length;if(0===s)return e;for(let o=0;o<s;o++)n+=i[o];const r=Math.floor(n/s);return Math.max(r,e)}function r(e){const t=null===e||void 0===e?void 0:e.renderer,i="touch"===(null===e||void 0===e?void 0:e.pointerType)?9:6;if(!t)return i;const o="visualVariables"in t?s(i,t.visualVariables):i;if("simple"===t.type)return n(o,t.symbol);if("unique-value"===t.type){var r;let e=o;return null!==(r=t.uniqueValueInfos)&&void 0!==r&&r.forEach((t=>{e=n(e,t.symbol)})),e}if("class-breaks"===t.type){let e=o;return t.classBreakInfos.forEach((t=>{e=n(e,t.symbol)})),e}return"dot-density"===t.type||t.type,o}i.d(t,{o:()=>r})},37209:(e,t,i)=>{i.d(t,{A:()=>Ye});var n=i(35143),o=i(91967),s=(i(81806),i(46053)),r=(i(76460),i(47249),i(85842)),a=(i(35238),i(50076),i(54099)),l=i(53084),d=i(30726),h=i(50346),p=i(76931),c=i(63733),u=i(18117),v=i(64465),_=i(39356),m=(i(95444),i(54901)),g=i(19555),y=i(72745),w=i(9392),f=i(28808),x=i(23862),b=i(63078),P=i(14727),T=i(13904),C=i(23701),O=i(89465),S=i(76940),V=i(7246);class M extends P.b{constructor(e){super(),this._graphicsLayer=e,this._symbolPairingsByType=new Map}visualizeIntersectionPoint(e,t){return this._visualizeSnappingIndicator(new T.A({x:e.intersectionPoint[0],y:e.intersectionPoint[1],spatialReference:t.spatialReference}),this._getOrCreateSymbol("intersectionPoint",t.view.effectiveTheme.accentColor))}visualizePoint(e,t){return this._visualizeSnappingIndicator(new T.A({x:e.point[0],y:e.point[1],spatialReference:t.spatialReference}),this._getOrCreateSymbol("point",t.view.effectiveTheme.accentColor))}visualizeLine(e,t){return this._visualizeSnappingIndicator(new C.A({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.spatialReference}),this._getOrCreateSymbol("line",t.view.effectiveTheme.accentColor))}visualizeParallelSign(e,t){return this._visualizeSnappingIndicator(new C.A({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.spatialReference}),this._getOrCreateSymbol("parallelSign",t.view.effectiveTheme.accentColor))}visualizeRightAngleQuad(e,t){const i=(0,y.vt)(),n=(0,y.vt)(),o=(0,w.vt)();(0,g.Re)(i,(0,x.Xz)(e.centerVertex),(0,x.Xz)(e.previousVertex)),(0,g.Re)(n,(0,x.Xz)(e.nextVertex),(0,x.Xz)(e.previousVertex)),(0,g.$A)(o,i,n);const s="rightAngleQuad".concat(o[2]<0?45:225);return this._visualizeSnappingIndicator(new C.A({paths:[[e.previousVertex,e.centerVertex,e.nextVertex]],spatialReference:t.spatialReference}),this._getOrCreateSymbol(s,t.view.effectiveTheme.accentColor))}_visualizeSnappingIndicator(e,t){const i=new _.A({geometry:e,symbol:t});return this._graphicsLayer.add(i),(0,m.hA)((()=>{this._graphicsLayer.remove(i)}))}_getOrCreateSymbol(e,t){var i;const n=this._symbolPairingsByType;return(null===(i=n.get(e))||void 0===i?void 0:i.color)!==t&&n.set(e,{color:t,symbol:Z(e,t)}),n.get(e).symbol}}function Z(e,t){const i=[...t.toRgb(),255*t.a];switch(e){case"point":return new S.A({outline:{width:.5,color:[0,0,0,1]},size:10,color:t});case"intersectionPoint":return new S.A({outline:new V.A({width:1.5,color:t}),size:15,color:[0,0,0,0]});case"line":return new O.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:f.uT.Butt,joinStyle:f.wd.Round,miterLimit:10,width:(0,p.PN)(b.N.lineHintWidthTarget),color:i}]}}});case"parallelSign":return new O.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,1.5],[7,1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:i}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,-1.5],[7,-1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:i}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}});case"rightAngleQuad45":case"rightAngleQuad225":{const n="rightAngleQuad45"===e?45:225;return new O.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:.5,y:.5,z:0},anchorPointUnits:"Relative",size:(0,p.PN)(b.N.rightAngleHintSize),rotation:n,markerPlacement:{type:"CIMMarkerPlacementOnVertices",placePerPart:!0,angleToLine:!0,placeOnEndPoints:!1},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[5,-5],[-5,-5],[-5,5],[5,5],[5,-5]]]},symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:(0,p.PN)(b.N.rightAngleHintOutlineSize),color:i},{type:"CIMSolidFill",enable:!0,color:[...t.toRgb(),255*t.a*.4]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}})}}}var H,I=i(89238),A=i(974),D=i(39612),E=i(13284),L=i(14318);let k=H=class extends a.A.EventedAccessor{constructor(e){var t;super(e),this._hasZ=null,this._cursorScreenPoint=null,this._activePointerId=null,this._stagedVertexUnsnapped=null,this._lastVertexUnsnapped=null,this.interactiveUndoDisabled=!1,this.history=[],this.redoHistory=[],this.snapToScene=!1,this.view=null,this.elevationInfo=null,this.defaultZ=0,this._coordinateHelper=(0,I.BV)(!!e.hasZ,!1,e.view.spatialReference),this._snappingManager=e.snappingManager,this._editGeometryOperations=new D.p(new A.ZE(null!==(t=e.editGeometryType)&&void 0!==t?t:"polygon",this._coordinateHelper)),this._snappingGraphicsLayer=new c.A({id:H.SNAPPING_GRAPHICS_LAYER_ID,listMode:"hide",internal:!0}),this._snappingContext=new E.e({editGeometryOperations:this._editGeometryOperations,elevationInfo:{mode:"on-the-ground",offset:0},pointer:"mouse",visualizer:new M(this._snappingGraphicsLayer)}),this._activeComponent=new A.uA(e.view.spatialReference,v.RT.Local),this._editGeometryOperations.data.components.push(this._activeComponent)}normalizeCtorArgs(e){const t={...e};return delete t.editGeometryType,t}initialize(){this._snappingOperation=new L.O({view:this.view}),"2d"===this.view.type&&this.view.map.layers.add(this._snappingGraphicsLayer)}destroy(){this.view.map.layers.remove(this._snappingGraphicsLayer),this._snappingGraphicsLayer.destroy(),null!=this._snappingManager&&this._snappingManager.doneSnapping(),this._snappingOperation=(0,d.pR)(this._snappingOperation),this._editGeometryOperations.destroy()}get _committedVertices(){return this._editGeometryOperations.data.components[0].vertices.map((e=>e.pos))}get vertices(){return null!=this._stagedVertex?[...this._committedVertices,this._coordinateHelper.pointToArray(this._stagedVertex)]:this._committedVertices}get hasZ(){return null!=this._hasZ?this._hasZ:"3d"===this.view.type}set hasZ(e){this._hasZ=e,this.notifyChange("hasZ")}get _stagedVertex(){return this._snappingOperation.stagedPoint}set _stagedVertex(e){this._snappingOperation.stagedPoint=(0,l.o8)(e)}canUndo(){return this._editGeometryOperations.canUndo}canRedo(){return this._editGeometryOperations.canRedo}undo(){this.canUndo&&this._editGeometryOperations.undo()}redo(){this.canRedo&&this._editGeometryOperations.redo()}getCoordsFromScreenPoint(e){const t=e&&this.screenToMap(e);return null==t?null:t.hasZ?[t.x,t.y,t.z]:[t.x,t.y]}getCoordsAndPointFromScreenPoint(e){const t=this.screenToMap(e);return null==t?null:t.hasZ?{vertex:[t.x,t.y,t.z],mapPoint:t}:{vertex:[t.x,t.y],mapPoint:t}}screenToMap(e){let t=null;if("3d"===this.view.type)if(this.hasZ){var i;const n=null!==(i=this.elevationInfo)&&void 0!==i?i:R;t=this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,p.gs)(e.x,e.y),n,this._getGeometryZValue())}else{var n;const i=null!==(n=this.elevationInfo)&&void 0!==n?n:U;t=this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,p.gs)(e.x,e.y),i,0),null!=t&&(t.z=void 0)}else t=this.view.toMap(e),null!=t&&(t.z=this.hasZ?this._getGeometryZValue():void 0);return t}_pushCursorVertex(e,t){const i=(0,u.T)(e[0],e[1],void 0,this.view.spatialReference);this._stagedVertexUnsnapped=i;const n=this._snappingManager;if(null==n)return this._stagedVertex=i,void t();(0,h.QZ)(this._snappingOperation.snap({point:i},n,this._snappingContext)).then((()=>{t()}))}_popCursorVertex(){this._stagedVertexUnsnapped=null,this._stagedVertex=null}_getGeometryZValue(){return this.defaultZ}_abortSnapping(){this._snappingOperation.abort()}_isDuplicateOfLastVertex(e){var t;const i=null===(t=this._editGeometryOperations.data.components[0].getLastVertex())||void 0===t?void 0:t.pos;if(i&&e[0]===i[0]&&e[1]===i[1])return!0;const{x:n,y:o}=this._coordinateHelper.vectorToDehydratedPoint(e);return null!=this._lastVertexUnsnapped&&n===this._lastVertexUnsnapped.x&&o===this._lastVertexUnsnapped.y}_shouldHandlePointerEvent(e){return this._isPrimaryPointerAction(e)&&(null==this._activePointerId||this._activePointerId===e.pointerId)}_vertexAddHandler(e){const t=null!=this._stagedVertex?this._coordinateHelper.pointToArray(this._stagedVertex):this.getCoordsFromScreenPoint(this._cursorScreenPoint);null!=t&&this._addVertex(t,e.native)}_drawCompleteHandler(e){this._completeDrawing(e.native)}_isPrimaryPointerAction(e){return"mouse"!==e.pointerType||0===e.button}};k.SNAPPING_GRAPHICS_LAYER_ID="DrawAction-snapping-graphics-layer",(0,n._)([(0,s.MZ)({readOnly:!0})],k.prototype,"vertices",null),(0,n._)([(0,s.MZ)({type:Boolean,nonNullable:!0})],k.prototype,"interactiveUndoDisabled",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],k.prototype,"history",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],k.prototype,"redoHistory",void 0),(0,n._)([(0,s.MZ)()],k.prototype,"snapToScene",void 0),(0,n._)([(0,s.MZ)()],k.prototype,"view",void 0),(0,n._)([(0,s.MZ)()],k.prototype,"elevationInfo",void 0),(0,n._)([(0,s.MZ)({nonNullable:!0})],k.prototype,"defaultZ",void 0),(0,n._)([(0,s.MZ)()],k.prototype,"hasZ",null),(0,n._)([(0,s.MZ)()],k.prototype,"_snappingOperation",void 0),(0,n._)([(0,s.MZ)()],k.prototype,"_stagedVertex",null),k=H=(0,n._)([(0,r.$)("esri.views.draw.DrawAction")],k);const R={mode:"absolute-height",offset:0},U={mode:"on-the-ground",offset:0},G=k;class z{constructor(e,t,i){this.view=e,this.vertexIndex=t,this.vertices=i,this.defaultPrevented=!1,this.type="vertex-add"}preventDefault(){this.defaultPrevented=!0}}class F{constructor(e,t,i){this.view=e,this.vertexIndex=t,this.vertices=i,this.defaultPrevented=!1,this.type="vertex-remove"}preventDefault(){this.defaultPrevented=!0}}class N{constructor(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.view=e,this.vertexIndex=t,this.vertices=i,this.mapPoint=n,this.coordinates=null,this.defaultPrevented=!1,this.type="cursor-update",this.coordinates=1===i.length?i[0]:null}preventDefault(){this.defaultPrevented=!0}}class W{constructor(e){this.vertices=e,this.coordinates=null,this.defaultPrevented=!1,this.type="draw-complete",this.coordinates=1===e.length?e[0]:null}preventDefault(){this.defaultPrevented=!0}}var B=i(88847),K=i(82307),$=i(11500);const q=Symbol("view-handles"),X=Symbol("undo-redo-handles");let Y=class extends G{constructor(e){super(e),this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1}initialize(){this._addViewHandles(),this._addUndoRedoHandles()}destroy(){this._removeViewHandles(),this._removeUndoRedoHandles(),this.emit("destroy")}undo(){super.undo(),this.notifyChange("vertices")}redo(){super.redo(),this.notifyChange("vertices")}complete(){this._completeDrawing()}_addViewHandles(){this._removeViewHandles(),this.addHandles([this.view.on("click",(e=>{e.stopPropagation()}),B.o.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,$.ZV)(e),"touch"===e.pointerType&&this._updateCursor())}),B.o.TOOL),this.view.on("pointer-move",(e=>{this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._abortSnapping(),this._cursorScreenPoint=(0,$.ZV)(e),"touch"!==e.pointerType&&this._updateCursor()}),B.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._addVertexOnPointerUp=!1)}),B.o.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp)this._vertexAddHandler(e);else{const t="touch"===e.pointerType;this._updateCursor(t)}}),B.o.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),B.o.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),B.o.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),B.o.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t===K.NE.vertexAdd&&!i&&this._cursorScreenPoint?(e.stopPropagation(),this._abortSnapping(),this._vertexAddHandler(e)):t!==K.NE.complete||i?t!==K.NE.undo||this.interactiveUndoDisabled||i?t!==K.NE.redo||this.interactiveUndoDisabled||i?t!==K.NE.pan||i||e.stopPropagation():(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e))}),B.o.TOOL),this.view.on("key-up",(e=>{e.key===K.NE.pan&&e.stopPropagation()}),B.o.TOOL)],q)}_addUndoRedoHandles(){this._removeUndoRedoHandles(),this.addHandles([this._editGeometryOperations.on("vertex-remove",(e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new F(this.view,e.vertices[0].index,t))}})),this._editGeometryOperations.on("vertex-add",(e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._committedVertices.length-1,t=new z(this.view,e,this.vertices);this.emit("vertex-add",t),t.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new z(this.view,e.vertices[0].index,t))}}))],X)}_removeViewHandles(){this.removeHandles(q)}_removeUndoRedoHandles(){this.removeHandles(X)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||this._editGeometryOperations.appendVertex(t)}_updateCursor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==t||e||this._pushCursorVertex(t.vertex,(()=>this.emit("cursor-update",new N(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new T.A(this._stagedVertex):null))))}_completeDrawing(){if(this._activePointerId=null,this._popCursorVertex(),this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping(),this.vertices.length<1)return;const e=new W(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this._removeViewHandles()}};Y=(0,n._)([(0,r.$)("esri.views.draw.MultipointDrawAction")],Y);var Q=i(12482),j=i(56002),J=i(68134),ee=i(15011),te=i(19451),ie=i(74e3);const ne=["freehand","hybrid","click"],oe="click";class se{constructor(e){let{consumesClicks:t,grabbableForEvent:i}=e;this.events=new a.A,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=t,this.grabbableForEvent=i}destroy(){}intersectionDistance(e,t){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}var re=i(70825),ae=i(75543);let le=class extends o.A{constructor(e){super(e),this.enabled=!1}};(0,n._)([(0,s.MZ)({type:Boolean,nonNullable:!0})],le.prototype,"enabled",void 0),le=(0,n._)([(0,r.$)("esri.views.interactive.sketch.SketchLabelOptions")],le);const de=le;var he=i(61237),pe=i(9730),ce=i(24648),ue=i(31633),ve=i(20664),_e=i(14487),me=(i(7137),i(89646));function ge(e,t,i){if(null==t||null==e)return;const n=(0,ue._H)(i.measurementSR);if(null==n)return;const o=Pe(e,i);if(null==o)return;const s=(0,ce.l3)(t,n);return new ae.ej((0,x._7)(o),s)}function ye(e,t,i,n){if(null==i||null==e)return;const o=Pe(e,n);if(null==o)return;const s=(0,me.hF)(i),r=e=>{if(null==e)return;const t=(0,w.vt)(),i=(0,ce.Wq)(e,"degrees","geographic");return(0,me.rT)(t,o,n.measurementSR,10,i,n.mode)?new ae.FX(o,t):void 0},a=()=>{if(null!=t&&null!=e)return(0,me.hF)((0,me.$h)(t,e))};switch(n.directionMode){case me.rZ.Absolute:return r(s);case me.rZ.Relative:{const e=a();if(null==e)return;return r(e+s)}case me.rZ.RelativeBilateral:{const e=a();if(null==e)return;return(0,ae.xW)([r(e+s),r(e-s)])}}}function we(e,t){const i=function(e,t){var i,n;return null!==(i=null===(n=Te(e,t))||void 0===n?void 0:n.value)&&void 0!==i?i:void 0}(e,t);return null!=i?new ae.qR(i):void 0}function fe(e,t,i,n,o,s){if(null==i&&null==n&&null==o)return;if(null==t)return we(n,s);const{view:r,elevationInfo:a,measurementSR:l}=s,d=(0,x.vf)(t,r,a);if(!l||!(0,_e.F)(d,t.spatialReference,Ce,l))return;const h=[Ce[0],Ce[1]],p=null!=i?(0,ce.l3)(i,"meters"):void 0,c=function(e,t){const i=Te(e,t);return null!=i?(0,ce.l3)(i,"meters"):void 0}(n,s),u=(0,me.hF)(o),v=e=>{const t=new ae.jf(h,l,p,c,e);return null==p||null==e||null==c&&s.hasZ?t:new ae.i7(t.closestTo(d))};if(null==u)return v(void 0);const _=()=>{if(null!=e&&null!=t)return(0,me.hF)((0,me.$h)(e,t))};switch(s.directionMode){case me.rZ.Absolute:return v(u);case me.rZ.Relative:{const e=_();if(null==e)return;return v(e+u)}case me.rZ.RelativeBilateral:{const e=_();if(null==e)return;return(0,ae.xW)([v(e+u),v(e-u)])}}}function xe(e,t){return"geodesic"===t.mode?fe(null,null,null,e,null,t):we(e,t)}function be(e,t,i,n,o,s){return"geodesic"===s.mode?fe(t,e,i,o,n,s):function(e){let t;for(const o of e){var i,n;o&&(t=null!==(i=null===(n=t)||void 0===n?void 0:n.intersect(o))&&void 0!==i?i:o)}return t}([ge(e,i,s),ye(e,t,n,s),we(o,s)])}function Pe(e,t){const{view:i,elevationInfo:n,measurementSR:o,origin:s,mode:r}=t,a=(0,x.vf)(e,i,n);if((0,_e.F)(a,e.spatialReference,a,o))return"geodesic"!==r&&(0,ve.f)(a,a,s),a}function Te(e,t){let{view:i,origin:n,elevationInfo:o,hasZ:s,measurementSR:r}=t;if(null==e||!s)return;const a=(0,ue.mq)(r);if(null==a)return;const[l,d]=n,h=(0,ce.l3)(e,a),p="3d"===(null===i||void 0===i?void 0:i.type)?(0,Q.Fo)(i,l,d,h,r,o):h;return null!=p?(0,ce.d_)(p,a):void 0}const Ce=(0,w.vt)();let Oe=class extends(a.A.EventedMixin(o.A)){constructor(e){super(e),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new Set,this._stagedScreenPoint=null,this._stagedPointerType=null,this._stagedPointerId=null,this._updatingHandles=new te.U,this.constraintsEnabled=!1,this.constraintInfo=void 0,this._getPointConstraint=(0,j.B)(xe),this._getPolylineOrPolygonConstraint=(0,j.B)(be),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new de,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,null==e.elevationInfo&&(this.elevationInfo=(0,Q.bK)(!!e.hasZ))}initialize(){const{geometryType:e,view:t}=this,i=t.spatialReference,n="viewingMode"in t.state?t.state.viewingMode:v.RT.Local,o="segment"===e||"multipoint"===e?"polyline":e;this.coordinateHelper=(0,I.BV)(this.hasZ,this.hasM,i),this._editGeometryOperations=new D.p(new A.ZE(o,this.coordinateHelper)),this._snappingOperation=new L.O({view:t}),this.addHandles([(0,J.wB)((()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this.constraint})),((e,t)=>{var i,n;let{stagedPoint:o,constraint:s}=e;const{snappingOptions:r}=this;if(r&&(r.forceDisabled=null!=s&&(0,ae.fT)(s),r.constraintsActive=null!=(null===(i=this.constraintInfo)||void 0===i?void 0:i.distance)||null!=(null===(n=this.constraintInfo)||void 0===n?void 0:n.direction)),null!=t&&o===t.stagedPoint&&s!==t.constraint)return this._onKeyboardBasedChange();this._processCursor(null!==o&&void 0!==o?o:this._screenToMap(this._stagedScreenPoint))}),{sync:!0,equals:(e,t)=>e.stagedPoint===t.stagedPoint&&(0,d.CM)(e.constraint,t.constraint)}),(0,J.wB)((()=>this.view.viewpoint),((e,t)=>{e&&t&&(0,ee.Ui)(e,t)&&this._onKeyboardBasedChange()}))]),this._activeComponent=new A.uA(i,n),this._editGeometryOperations.data.components.push(this._activeComponent);const s=this.segmentLabels;null!=s&&(s.context={view:t,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles((0,J.wB)((()=>this.labelOptions.enabled),(e=>{s.visible=e}),J.pc))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],(e=>{var t,i,n,o,s,r;const a=e.vertices.map((e=>({componentIndex:0,vertexIndex:e.index,coordinates:this.coordinateHelper.vectorToArray(e.pos)}))),l=a.map((e=>e.coordinates)),d=null!==(t=this.coordinateHelper.vectorToDehydratedPoint(null===(i=this._activeComponent.getFirstVertex())||void 0===i?void 0:i.pos))&&void 0!==t?t:null;(0,ie.CI)(d,this.firstVertex)||(this.firstVertex=d);const h=null!==(n=this.coordinateHelper.vectorToDehydratedPoint(null===(o=this._activeComponent.getLastVertex())||void 0===o?void 0:o.pos))&&void 0!==n?n:null;(0,ie.CI)(h,this.lastVertex)||(this.lastVertex=h);const p=null!==(s=this.coordinateHelper.vectorToDehydratedPoint(null===(r=this._activeComponent.edges.at(-1))||void 0===r||null===(r=r.leftVertex)||void 0===r?void 0:r.pos))&&void 0!==s?s:null;switch((0,ie.CI)(p,this.secondToLastVertex)||(this.secondToLastVertex=p),this._processCursor(this.cursorVertex),e.type){case"vertex-add":this.emit(e.type,{...e,added:l,vertices:a});break;case"vertex-update":this.emit(e.type,{...e,updated:l,vertices:a});break;case"vertex-remove":this.emit(e.type,{...e,removed:l,vertices:a})}})));const r=this._manipulator=new se({consumesClicks:!1,grabbableForEvent:e=>"click"!==this.drawingMode||"touch"===e.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size});this.manipulators.add(r),r.grabbable="point"!==e,this.addHandles([this._createManipulatorDragPipeline(r),r.events.on("immediate-click",(e=>this._onImmediateClick(e))),r.events.on("immediate-double-click",(e=>this._onImmediateDoubleClick(e))),(0,J.wB)((()=>({effectiveCursor:this.effectiveCursor})),(e=>{let{effectiveCursor:t}=e;r.cursor=t}),J.pc)]),(0,pe.BY)(this,(()=>{var e;const t=null!==(e=this.view.inputManager.latestPointerType)&&void 0!==e?e:"mouse",i=this._getSnappingContext(t);null!=this.snappingManager&&this._updatingHandles.addPromise((0,h.QZ)(this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,i)))}))}destroy(){(0,d.pR)(this.segmentLabels),(0,d.pR)(this._snappingOperation),this._editGeometryOperations=(0,d.pR)(this._editGeometryOperations),this._updatingHandles.destroy()}get _snappingEnabled(){return null!=this.snappingManager&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const e=this._updateAndGetEffectiveDrawSurface();return"3d"===this.view.type&&this.drawSurface!==e}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map((e=>this.coordinateHelper.vectorToArray(e.pos)))}get constraint(){const{constraintInfo:e,constraintsEnabled:t}=this;if(e&&t)switch(this.geometryType){case"point":return this._getPointConstraint(e.elevation,e.context);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,e.distance,e.direction,e.elevation,e.context)}}set drawingMode(e){this._set("drawingMode",null!==e&&void 0!==e?e:oe)}get effectiveCursor(){return this.loading?"progress":this._hideDefaultCursor?null:this.cursor||"crosshair"}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return null!=this.snappingManager?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return"mouse"===this._stagedPointerType?this.cursorVertex:null}get committableVertex(){const{cursorVertex:e,lastVertex:t,firstVertex:i,geometryType:n}=this;return"polygon"===n&&(0,ie.fk)(e,i)||(0,ie.fk)(e,t)?null:e}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:e,committableVertex:t,coordinateHelper:i}=this,n=e.slice();return null!=t&&n.push(i.pointToArray(t)),n}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:e}=this;null!=e&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}complete(e){var t;const i=(null===e||void 0===e?void 0:e.aborted)||!1;this._snappingOperation.abort(),null===(t=this.snappingManager)||void 0===t||t.doneSnapping();const{geometryType:n,numCommittedVertices:o}=this,s="multipoint"===n&&0===o||"polyline"===n&&o<2||"polygon"===n&&o<3;"segment"!==n&&"point"!==n||this.commitStagedVertex(),this._createOperationCompleted=!s,(this.isCompleted||i)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map(((e,t)=>({componentIndex:0,vertexIndex:t,coordinates:e}))),aborted:i,type:"complete"}))}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){null!=this.snappingManager&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(e){var t,i,n;const o=(0,l.o8)(this.cursorVertex),s=(0,l.o8)(e),r=s&&(null!==(t=null===(i=this._updateAndGetEffectiveDrawSurface())||void 0===i?void 0:i.constrainZ(s))&&void 0!==t?t:s),a=this._snapToClosingVertex(r),d=this._applyConstraints(a);(0,ie.fk)(o,d)||(this._set("cursorVertex",d),null!==(n=this.segmentLabels)&&void 0!==n&&n.set("stagedVertex",null!=d?this.coordinateHelper.pointToVector(d):null),null==d||"mouse"!==this._stagedPointerType?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(d)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(e){if(null==e||"polygon"!==this.geometryType||this.numCommittedVertices<=2)return e;const t=this._mapToScreen(e);if(!t)return e;const i=this._activeComponent;return this._vertexWithinPointerDistance(i.vertices[0].pos,t)?this.firstVertex:this._vertexWithinPointerDistance(i.vertices.at(-1).pos,t)?this.lastVertex:e}_createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return(0,re.Xt)(e,((e,t,i,n)=>{const o="touch"===n&&this._snappingEnabled;if(this.isCompleted||!o)return;const{snappingStep:s,cancelSnapping:r}=(0,he.L)({predicate:()=>o,snappingManager:this.snappingManager,snappingContext:new E.e({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:n,visualizer:this.snappingVisualizer}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});i=i.next((e=>(o&&null!=this.snappingManager&&this.snappingManager.doneSnapping(),e))).next(r),t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this._processCursor(e.mapStart),("segment"===this.geometryType||o&&!this.numCommittedVertices)&&this.commitStagedVertex()),e))).next((0,re.pg)(this.view,this.elevationInfo)).next(...s).next((e=>(o&&(this._processCursor(e.mapEnd),"end"===e.action&&this.commitStagedVertex()),e))).next((e=>("end"===e.action&&("mouse"!==this._stagedPointerType&&this._snappingOperation.abort(),"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),e)))}))}_createManipulatorDragPipelineFreehand(e){return(0,re.Xt)(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this._snappingOperation.abort(),null==this.committableVertex&&this._processCursor(e.mapStart),"segment"===this.geometryType&&this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this._processCursor(e.mapEnd),"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return e}))}))}_createManipulatorDragPipelineHybrid(e){return(0,re.Xt)(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this._snappingOperation.abort(),this._processCursor(e.mapStart),this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this._processCursor(e.mapEnd),"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"mouse"!==this._stagedPointerType&&this._snappingOperation.abort(),"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return e}))}))}get _drawAtFixedElevation(){const{constraintsEnabled:e,constraintZ:t,geometryType:i,numCommittedVertices:n}=this;return e?null!=t||"segment"===i&&n>0:("segment"===i||"polygon"===i)&&n>0}_updateAndGetEffectiveDrawSurface(){var e;const{constraintsEnabled:t,coordinateHelper:i,drawSurface:n,elevationDrawSurface:o,snapToSceneEnabled:s}=this;if(null==o)return n;if(!this.hasZ)return o.defaultZ=null,o;const r=null===(e=this.elevationInfo)||void 0===e?void 0:e.mode;let a=this.defaultZ,l=t||"absolute-height"===r;var d;(null!=s&&(l=s),"on-the-ground"===r&&(l=!1),this._drawAtFixedElevation)&&(a=null!==(d=t?this.constraintZ:null)&&void 0!==d?d:i.getZ(this._activeComponent.vertices[0].pos),l=!1);return l?n:(o.defaultZ=a,o)}_mapToScreen(e){var t;return null===(t=this._updateAndGetEffectiveDrawSurface())||void 0===t?void 0:t.mapToScreen(e)}_onHold(e){this._snappingOperation.abort(),"click"===this.drawingMode&&"touch"===e.pointerType&&this._snappingEnabled&&this._processCursor(e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if(!("mouse"===e.pointerType&&2===e.button||this._manipulator.dragging))try{const{drawingMode:t,geometryType:i}=this;this._stagedPointerType=e.pointerType,this._stagedScreenPoint=e.screenPoint;const n=this._screenToMap(e.screenPoint);if(null==n)return;if(null==n||"freehand"===t&&"point"!==i)return;if(this._snappingEnabled&&null!=this.cursorVertex||this._processCursor(n),null==this.committableVertex)return void this.complete();this.commitStagedVertex(),"mouse"!==e.pointerType&&this._processCursor(null),("freehand"===t||"point"===i||"segment"===i&&2===this.numCommittedVertices||"segment"===i&&"hybrid"===t&&1===this.numCommittedVertices)&&this.complete()}finally{e.stopPropagation()}}_onImmediateDoubleClick(e){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),e.stopPropagation())}_onPointerMove(e){const t=(0,p.tc)(e.x,e.y);this._stagedScreenPoint=t,this._stagedPointerType=e.pointerType,this._stagedPointerId=e.pointerId;const i=this._snappingOperation,n=this._manipulator;this._pointerDownStates.has(e.pointerId)||n.grabbing||!n.interactive?i.abort():(e.stopPropagation(),this._processCursorMovementRelativeToSurface(t,e.pointerType))}_onKeyboardBasedChange(){const e=this._manipulator;"mouse"===this._stagedPointerType&&this._stagedScreenPoint&&null!=this._stagedPointerId&&!this._pointerDownStates.has(this._stagedPointerId)&&!e.grabbing&&e.interactive?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(e,t){var i;const n=this._snappingOperation,o=this._screenToMap(e),s=this._requiresScenePoint?null===(i=this.drawSurface)||void 0===i?void 0:i.screenToMap(e):null;if(null==o)return this._hideDefaultCursor=!0,this._processCursor(null),void n.abort();this._hideDefaultCursor=!1;const r=this.snappingManager;if(null==r)return this._processCursor(o),void n.abort();const a=this._getSnappingContext(t);this._updatingHandles.addPromise((0,h.QZ)(n.snap({point:o,scenePoint:s},r,a)))}_applyConstraints(e){const{constraint:t,constraintInfo:i}=this;if(!e||!i||!t)return e;const{context:n}=i,o=Pe(e,n),s=o?t.closestTo(o):void 0;if(!s)return e;const r=function(e,t,i){const{view:n,measurementSR:o,spatialReference:s,origin:r,mode:a}=i,l=Ce;if("geodesic"===a?(0,ve.c)(l,e):(0,ve.g)(l,e,r),(0,_e.F)(l,o,l,s))return(0,x.xF)(l,n,t,i)}(s,e,n);return null!=r&&"absolute-height"!==n.elevationInfo.mode&&null!=this.constraintZ&&this.hasZ&&(r.z=this.constraintZ),r}_screenToMap(e){var t;return e?null===(t=this._updateAndGetEffectiveDrawSurface())||void 0===t?void 0:t.screenToMap(e):null}_screenToMapDragEventStep(){let e=null;return t=>{if("start"===t.action&&(e=this._screenToMap(t.screenStart)),null==e)return null;const i=this._screenToMap(t.screenEnd);return null!=i?{...t,mapStart:e,mapEnd:i}:null}}_vertexWithinPointerDistance(e,t){const i=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return null!=i&&function(e,t,i){const n=e.x-t.x,o=e.y-t.y;return n*n+o*o<=i}(i,t,25)}_getSnappingContext(e){var t;const i=this._drawAtFixedElevation?null===(t=this.elevationDrawSurface)||void 0===t?void 0:t.defaultZ:null;return new E.e({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:null!=i?{value:i,elevationInfo:this.elevationInfo}:null})}};(0,n._)([(0,s.MZ)()],Oe.prototype,"_hideDefaultCursor",void 0),(0,n._)([(0,s.MZ)()],Oe.prototype,"_snappingOperation",void 0),(0,n._)([(0,s.MZ)()],Oe.prototype,"_snappingEnabled",null),(0,n._)([(0,s.MZ)({constructOnly:!0})],Oe.prototype,"graphic",void 0),(0,n._)([(0,s.MZ)()],Oe.prototype,"constraintsEnabled",void 0),(0,n._)([(0,s.MZ)()],Oe.prototype,"constraintInfo",void 0),(0,n._)([(0,s.MZ)()],Oe.prototype,"constraint",null),(0,n._)([(0,s.MZ)()],Oe.prototype,"constraintZ",void 0),(0,n._)([(0,s.MZ)()],Oe.prototype,"defaultZ",void 0),(0,n._)([(0,s.MZ)()],Oe.prototype,"isDraped",void 0),(0,n._)([(0,s.MZ)({value:oe})],Oe.prototype,"drawingMode",null),(0,n._)([(0,s.MZ)({constructOnly:!0})],Oe.prototype,"elevationDrawSurface",void 0),(0,n._)([(0,s.MZ)({constructOnly:!0})],Oe.prototype,"elevationInfo",void 0),(0,n._)([(0,s.MZ)({constructOnly:!0,type:de})],Oe.prototype,"labelOptions",void 0),(0,n._)([(0,s.MZ)({constructOnly:!0})],Oe.prototype,"geometryType",void 0),(0,n._)([(0,s.MZ)({constructOnly:!0})],Oe.prototype,"hasM",void 0),(0,n._)([(0,s.MZ)({constructOnly:!0})],Oe.prototype,"hasZ",void 0),(0,n._)([(0,s.MZ)()],Oe.prototype,"cursor",void 0),(0,n._)([(0,s.MZ)()],Oe.prototype,"effectiveCursor",null),(0,n._)([(0,s.MZ)()],Oe.prototype,"loading",void 0),(0,n._)([(0,s.MZ)({constructOnly:!0})],Oe.prototype,"manipulators",void 0),(0,n._)([(0,s.MZ)({constructOnly:!0})],Oe.prototype,"drawSurface",void 0),(0,n._)([(0,s.MZ)({constructOnly:!0})],Oe.prototype,"segmentLabels",void 0),(0,n._)([(0,s.MZ)({constructOnly:!0})],Oe.prototype,"snappingManager",void 0),(0,n._)([(0,s.MZ)({constructOnly:!0})],Oe.prototype,"snappingVisualizer",void 0),(0,n._)([(0,s.MZ)()],Oe.prototype,"snapToSceneEnabled",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],Oe.prototype,"cursorVertex",null),(0,n._)([(0,s.MZ)({readOnly:!0})],Oe.prototype,"visualizationCursorVertex",null),(0,n._)([(0,s.MZ)()],Oe.prototype,"committableVertex",null),(0,n._)([(0,s.MZ)()],Oe.prototype,"firstVertex",void 0),(0,n._)([(0,s.MZ)()],Oe.prototype,"lastVertex",void 0),(0,n._)([(0,s.MZ)()],Oe.prototype,"secondToLastVertex",void 0),(0,n._)([(0,s.MZ)()],Oe.prototype,"updating",null),(0,n._)([(0,s.MZ)({constructOnly:!0})],Oe.prototype,"view",void 0),Oe=(0,n._)([(0,r.$)("esri.views.draw.DrawOperation")],Oe);var Se=i(32535),Ve=i(13312);class Me{constructor(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._elevationInfo=e,this.defaultZ=t,this._view=i,this._excludeGraphics=n}screenToMap(e){const{defaultZ:t,_view:i}=this,n=i.sceneIntersectionHelper.intersectElevationFromScreen((0,p.gs)(e.x,e.y),this._elevationInfo,null!==t&&void 0!==t?t:0,this._excludeGraphics);return null==t&&null!=n&&(n.z=void 0),n}mapToScreen(e){const t=(0,u.T)(e.x,e.y,(0,Q.wS)(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(t)}constrainZ(e){const{defaultZ:t}=this;return null!=t&&e.z!==t&&((e=(0,Se.EL)(e)).z=t),e}}class Ze{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this.view=e,this.elevationInfo=t,this.exclude=i}screenToMap(e){const t=this.view.toMap(e,{exclude:this.exclude,excludeHud:!0});return null!=t&&(t.z=(0,Q.id)(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return null!=this.elevationInfo&&(t=(0,u.T)(e.x,e.y,(0,Q.wS)(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}constrainZ(e){return e}}class He{screenToMap(e){const{x:t,y:i}=e;return new T.A({x:t,y:i,spatialReference:He.spatialReference})}mapToScreen(e){return(0,p.tc)(e.x,e.y)}constrainZ(e){return e}}He.spatialReference=new Ve.A;var Ie=i(56829);let Ae=class extends(a.A.EventedMixin(Ie.g)){constructor(e){super(e),this.defaultZ=0,this.elevationInfo=null,this.hasZ=!0,this.mode=null,this.snapToScene=null,this.type="draw-3d"}initialize(){const e=this.view,t=(0,Q.bK)(this.hasZ,this.elevationInfo);this.drawOperation=new Oe({view:e,manipulators:this.manipulators,geometryType:this.geometryType,drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:"3d"===e.type?new Ze(e,t):null,elevationDrawSurface:"3d"===e.type?new Me(t,this.defaultZ,e):null,hasM:!1,elevationInfo:t}),this.addHandles([this.drawOperation.on("vertex-add",(e=>this.onVertexAdd(e))),this.drawOperation.on("vertex-remove",(e=>this.onVertexRemove(e))),this.drawOperation.on("vertex-update",(e=>this.onVertexUpdate(e))),this.drawOperation.on("cursor-update",(e=>this.onCursorUpdate(e))),this.drawOperation.on("complete",(e=>this.onComplete(e)))]),this.finishToolCreation()}destroy(){this.drawOperation=(0,d.pR)(this.drawOperation),this._set("view",null)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}get updating(){var e,t;return null!==(e=null===(t=this.drawOperation)||void 0===t?void 0:t.updating)&&void 0!==e&&e}completeCreateOperation(){this.drawOperation.complete()}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}getVertexCoords(){return this.drawOperation.geometryIncludingUncommittedVertices}onInputEvent(e){this.drawOperation.onInputEvent(e)}canRedo(){return this.drawOperation.canRedo}canUndo(){return this.drawOperation.canUndo}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}onComplete(e){this.emit("complete",e)}onCursorUpdate(e){this.emit("cursor-update",e)}onVertexAdd(e){this.emit("vertex-add",e)}onVertexRemove(e){this.emit("vertex-remove",e)}onVertexUpdate(e){this.emit("vertex-update",e)}};(0,n._)([(0,s.MZ)({constructOnly:!0,nonNullable:!0})],Ae.prototype,"defaultZ",void 0),(0,n._)([(0,s.MZ)()],Ae.prototype,"drawOperation",void 0),(0,n._)([(0,s.MZ)({constructOnly:!0})],Ae.prototype,"elevationInfo",void 0),(0,n._)([(0,s.MZ)({value:!0})],Ae.prototype,"enabled",null),(0,n._)([(0,s.MZ)({constructOnly:!0})],Ae.prototype,"geometryType",void 0),(0,n._)([(0,s.MZ)({constructOnly:!0})],Ae.prototype,"hasZ",void 0),(0,n._)([(0,s.MZ)({constructOnly:!0})],Ae.prototype,"mode",void 0),(0,n._)([(0,s.MZ)()],Ae.prototype,"snapToScene",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],Ae.prototype,"type",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],Ae.prototype,"updating",null),(0,n._)([(0,s.MZ)({constructOnly:!0,nonNullable:!0})],Ae.prototype,"view",void 0),Ae=(0,n._)([(0,r.$)("esri.views.draw.DrawTool")],Ae);let De=class extends G{constructor(e){super(e),this._addVertexOnPointerUp=!1,this._drawTool=null}initialize(){this._addViewHandles(),"3d"===this.view.type&&this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}complete(){this._completeDrawing()}_addViewHandles(){this._addViewHandles2DOnly(),this.addHandles([this.view.on("key-down",(e=>{e.key===K.NE.complete&&(this._drawTool?this.complete():(this._abortSnapping(),this._vertexAddHandler(e)))}),B.o.TOOL)])}_addViewHandles2DOnly(){"2d"===this.view.type&&this.addHandles([this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,$.ZV)(e),"touch"===e.pointerType&&this._updateCursor())}),B.o.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),this._cursorScreenPoint=(0,$.ZV)(e),"touch"!==e.pointerType&&this._updateCursor()}),B.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._addVertexOnPointerUp=!1)}),B.o.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp)e.stopPropagation(),this._vertexAddHandler(e);else{const t="touch"===e.pointerType;this._updateCursor(t)}}),B.o.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),B.o.TOOL)])}_addDrawTool(){const e=new Ae({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"point",mode:"click"});this._drawTool=e,this.view.addAndActivateTool(e),this.addHandles([e.on("cursor-update",(t=>{1===t.vertices.length&&this.emit("cursor-update",new N(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("complete",(t=>{this.emit("draw-complete",new W(e.getVertexCoords())),this._removeDrawTool(),this.removeAllHandles()}))])}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t),this.notifyChange("vertices"),this._completeDrawing())}_updateCursor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==t||e||this._pushCursorVertex(t.vertex,(()=>this.emit("cursor-update",new N(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new T.A(this._stagedVertex):null))))}_completeDrawing(){if(this._drawTool)return void this._drawTool.completeCreateOperation();this._activePointerId=null,this._popCursorVertex(),this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping();const e=new W(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}};De=(0,n._)([(0,r.$)("esri.views.draw.PointDrawAction")],De);let Ee=class extends G{constructor(e){super(e),this._panEnabled=!1,this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this._drawTool=null,this.mode=oe}initialize(){this._addViewHandles(),"3d"===this.view.type&&this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}get _dragEnabled(){return"freehand"===this.mode||"hybrid"===this.mode}get _clickEnabled(){return"click"===this.mode||"hybrid"===this.mode}undo(){this._drawTool?this._drawTool.undo():(super.undo(),this.notifyChange("vertices"))}redo(){this._drawTool?this._drawTool.redo():(super.redo(),this.notifyChange("vertices"))}canUndo(){var e,t;return null!==(e=null===(t=this._drawTool)||void 0===t?void 0:t.canUndo())&&void 0!==e?e:super.canUndo()}canRedo(){var e,t;return null!==(e=null===(t=this._drawTool)||void 0===t?void 0:t.canRedo())&&void 0!==e?e:super.canRedo()}complete(){this._completeDrawing()}_getGeometryZValue(){return this.hasZ&&this.vertices.length>0?this.vertices[0][2]:this.defaultZ}_addViewHandles(){this._addViewHandles2DOnly(),this.addHandles(this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t!==K.NE.vertexAdd||i?t!==K.NE.complete||i?t!==K.NE.undo||this.interactiveUndoDisabled||i?t!==K.NE.redo||this.interactiveUndoDisabled||i||(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e)):(e.stopPropagation(),this._handleVertexAddKey(e))}),B.o.TOOL))}_addViewHandles2DOnly(){"2d"===this.view.type&&(this.addHandles([this.view.on("click",(e=>{e.stopPropagation()}),B.o.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,$.ZV)(e),"touch"===e.pointerType&&this._updateCursor())}),B.o.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._cursorScreenPoint=(0,$.ZV)(e),"touch"!==e.pointerType&&this._updateCursor()}),B.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._cursorScreenPoint=(0,$.ZV)(e),this._dragEnabled&&!this._panEnabled?this._vertexAddHandler(e):this._addVertexOnPointerUp=!1)}),B.o.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp){if(!this._clickEnabled)return 1===this.vertices.length&&this.vertices.pop(),void this._drawCompleteHandler(e);this._vertexAddHandler(e)}else{const t="touch"===e.pointerType;this._updateCursor(t)}}),B.o.TOOL),this.view.on("drag",(e=>{this._dragEnabled&&null!=this._activePointerId&&!this._panEnabled&&e.stopPropagation()}),B.o.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),B.o.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),B.o.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),B.o.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t!==K.NE.pan||i||(e.stopPropagation(),this._panEnabled=!0)}),B.o.TOOL),this.view.on("key-up",(e=>{e.key===K.NE.pan&&(e.stopPropagation(),this._panEnabled=!1)}),B.o.TOOL)]),this._addUndoRedoHandles())}_handleVertexAddKey(e){this._drawTool?this._drawTool.drawOperation.commitStagedVertex():this._cursorScreenPoint&&(this._abortSnapping(),this._vertexAddHandler(e))}_addUndoRedoHandles(){this.addHandles([this._editGeometryOperations.on("vertex-remove",(e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new F(this.view,e.vertices[0].index,t))}})),this._editGeometryOperations.on("vertex-add",(e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._committedVertices.length-1,t=new z(this.view,e,this.vertices);this.emit("vertex-add",t),t.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new z(this.view,e.vertices[0].index,t))}}))])}_addDrawTool(){const e=new Ae({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polygon",mode:this.mode});this._drawTool=e,this.view.addAndActivateTool(e),e.on("vertex-add",(t=>{if(1===t.vertices.length){const{view:i}=this,n=t.vertices[0].vertexIndex,o=e.getVertexCoords();this.emit("vertex-add",new z(i,n,o)),"undo"!==t.operation&&"redo"!==t.operation||this.emit(t.operation,new z(i,n,o))}})),e.on("vertex-remove",(t=>{if(1===t.vertices.length){const{view:i}=this,n=t.vertices[0].vertexIndex,o=e.getVertexCoords();this.emit("vertex-remove",new F(i,n,o)),"undo"!==t.operation&&"redo"!==t.operation||this.emit(t.operation,new F(i,n,o))}})),e.on("cursor-update",(t=>{1===t.vertices.length&&this.emit("cursor-update",new N(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("complete",(t=>{this.emit("draw-complete",new W(e.getVertexCoords())),this._removeDrawTool(),this.removeAllHandles()}))}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t))}_updateCursor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==t||e||this._pushCursorVertex(t.vertex,(()=>this.emit("cursor-update",new N(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new T.A(this._stagedVertex):null))))}_completeDrawing(){if(this._drawTool)return void this._drawTool.completeCreateOperation();if(this._activePointerId=null,this._popCursorVertex(),this._committedVertices.length<3)return;this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping();const e=new W(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}};(0,n._)([(0,s.MZ)()],Ee.prototype,"_dragEnabled",null),(0,n._)([(0,s.MZ)()],Ee.prototype,"_clickEnabled",null),(0,n._)([(0,s.MZ)({type:ne})],Ee.prototype,"mode",void 0),Ee=(0,n._)([(0,r.$)("esri.views.draw.PolygonDrawAction")],Ee);let Le=class extends G{constructor(e){super(e),this._panEnabled=!1,this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this._drawTool=null,this.mode=oe}initialize(){this._addViewHandles(),"3d"===this.view.type&&this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}get _clickEnabled(){return"click"===this.mode||"hybrid"===this.mode}get _dragEnabled(){return"freehand"===this.mode||"hybrid"===this.mode}undo(){this._drawTool?this._drawTool.undo():(super.undo(),this.notifyChange("vertices"))}redo(){this._drawTool?this._drawTool.redo():(super.redo(),this.notifyChange("vertices"))}canUndo(){var e,t;return null!==(e=null===(t=this._drawTool)||void 0===t?void 0:t.canUndo())&&void 0!==e?e:super.canUndo()}canRedo(){var e,t;return null!==(e=null===(t=this._drawTool)||void 0===t?void 0:t.canRedo())&&void 0!==e?e:super.canRedo()}complete(){this._completeDrawing()}_addViewHandles(){this._addViewHandles2DOnly(),this.addHandles([this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t!==K.NE.vertexAdd||i?t!==K.NE.complete||i?t!==K.NE.undo||this.interactiveUndoDisabled||i?t!==K.NE.redo||this.interactiveUndoDisabled||i||(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e)):(e.stopPropagation(),this._handleVertexAddKey(e))}),B.o.TOOL)])}_addViewHandles2DOnly(){"2d"===this.view.type&&(this.addHandles([this.view.on("click",(e=>{e.stopPropagation()}),B.o.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&!this._panEnabled&&(this._abortSnapping(),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,$.ZV)(e),"touch"===e.pointerType&&this._updateCursor())}),B.o.TOOL),this.view.on("pointer-move",(e=>{this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._abortSnapping(),this._cursorScreenPoint=(0,$.ZV)(e),"touch"!==e.pointerType&&this._updateCursor()}),B.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._cursorScreenPoint=(0,$.ZV)(e),this._dragEnabled&&!this._panEnabled?this._vertexAddHandler(e):this._addVertexOnPointerUp=!1)}),B.o.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._abortSnapping(),this._activePointerId=null,this._addVertexOnPointerUp){if(!this._clickEnabled)return 1===this.vertices.length&&this.vertices.pop(),void this._drawCompleteHandler(e);this._vertexAddHandler(e)}else{const t="touch"===e.pointerType;this._updateCursor(t)}}),B.o.TOOL),this.view.on("drag",(e=>{this._dragEnabled&&null!=this._activePointerId&&!this._panEnabled&&e.stopPropagation()}),B.o.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),B.o.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),B.o.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),B.o.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t!==K.NE.pan||i||(e.stopPropagation(),this._panEnabled=!0)}),B.o.TOOL),this.view.on("key-up",(e=>{e.key===K.NE.pan&&(e.stopPropagation(),this._panEnabled=!1)}),B.o.TOOL)]),this._addUndoRedoHandles())}_handleVertexAddKey(e){this._drawTool?this._drawTool.drawOperation.commitStagedVertex():this._cursorScreenPoint&&(this._abortSnapping(),this._vertexAddHandler(e))}_addUndoRedoHandles(){this.addHandles([this._editGeometryOperations.on("vertex-remove",(e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new F(this.view,e.vertices[0].index,t))}})),this._editGeometryOperations.on("vertex-add",(e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._committedVertices.length-1,t=new z(this.view,e,this.vertices);this.emit("vertex-add",t),t.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=[...this._committedVertices];null!=this._stagedVertex&&t.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new z(this.view,e.vertices[0].index,t))}}))])}_addDrawTool(){const e=new Ae({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polyline",mode:this.mode});this._drawTool=e,this.view.addAndActivateTool(e),this.addHandles([e.on("vertex-add",(t=>{if(1!==t.vertices.length)return;const{view:i}=this,n=t.vertices[0].vertexIndex,o=e.getVertexCoords();this.emit("vertex-add",new z(i,n,o)),"undo"!==t.operation&&"redo"!==t.operation||this.emit(t.operation,new z(i,n,o))})),e.on("vertex-remove",(t=>{if(1!==t.vertices.length)return;const{view:i}=this,n=t.vertices[0].vertexIndex,o=e.getVertexCoords();this.emit("vertex-remove",new F(i,n,o)),"undo"!==t.operation&&"redo"!==t.operation||this.emit(t.operation,new F(i,n,o))})),e.on("cursor-update",(t=>{1===t.vertices.length&&this.emit("cursor-update",new N(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("complete",(t=>{this.emit("draw-complete",new W(e.getVertexCoords())),this._removeDrawTool(),this.removeAllHandles()}))])}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);this._isDuplicateOfLastVertex(t)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t))}_updateCursor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null==t||e||this._pushCursorVertex(t.vertex,(()=>this.emit("cursor-update",new N(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new T.A(this._stagedVertex):null))))}_completeDrawing(){if(this._drawTool)return void this._drawTool.completeCreateOperation();if(this._activePointerId=null,this._popCursorVertex(),this._committedVertices.length<2)return;this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping();const e=new W(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}};(0,n._)([(0,s.MZ)()],Le.prototype,"_clickEnabled",null),(0,n._)([(0,s.MZ)()],Le.prototype,"_dragEnabled",null),(0,n._)([(0,s.MZ)({type:ne})],Le.prototype,"mode",void 0),Le=(0,n._)([(0,r.$)("esri.views.draw.PolylineDrawAction")],Le);var ke=i(18690),Re=i(94967),Ue=i(99809),Ge=i(60008),ze=i(4336),Fe=i(5568);function Ne(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return null!=i?[e,t,i]:[e,t]}function We(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return null!=i?{x:e,y:t,z:i}:{x:e,y:t}}class Be{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map((e=>this.mapToLocal(e))).filter(ke.Ru)}get doUnnormalization(){return!1}}class Ke extends Be{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(t),this._defaultZ=i,this.transform=(0,Ue.vt)(),this.transformInv=(0,Ue.vt)(),this.transform=(0,Ue.o8)(e),(0,Re.B8)(this.transformInv,this.transform)}makeMapPoint(e,t){return Ne(e,t,this._defaultZ)}mapToLocal(e){return We(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return Ne(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}}class $e extends Be{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=(0,w.vt)(),this.tangentFrameUpWS=(0,w.vt)(),this.tangentFrameRightWS=(0,w.vt)(),this.tangentFrameForwardWS=(0,w.vt)(),this.localFrameRightWS=(0,w.vt)(),this.localFrameUpWS=(0,w.vt)(),this.worldToLocalTransform=(0,ze.vt)(),this.localToWorldTransform=(0,ze.vt)(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const i=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Fe._.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Fe._.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Fe._.Z,this.tangentFrameForwardWS);const n=(0,w.vt)();(0,ve.h)(n,this.tangentFrameForwardWS,(0,ve.k)(i,this.tangentFrameForwardWS)),(0,ve.f)(this.localFrameRightWS,i,n),(0,ve.n)(this.localFrameRightWS,this.localFrameRightWS),(0,ve.b)(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),(0,Ge.Yc)(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),(0,Ge.B8)(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(e,t){return Ne(e,t,this.defaultZ)}mapToLocal(e){const t=(0,w.vt)();this.view.renderCoordsHelper.toRenderCoords(new T.A({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),(0,ve.u)(t,t,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,new T.A({spatialReference:this.view.spatialReference}));return null!=i?We(i.x/this.scale,i.y/this.scale):null}localToMap(e){const t=(0,w.vt)();this.view.renderCoordsHelper.toRenderCoords(new T.A({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),(0,ve.u)(t,t,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,new T.A({spatialReference:this.view.spatialReference}));return null!=i?Ne(i.x,i.y,this.defaultZ):null}}let qe=class extends G{constructor(e){super(e),this._isDragging=!1,this._panEnabled=!1,this._addVertexOnPointerUp=!1,this._drawTool=null,this.viewAlignedCoordinateSystem=null,this.mode="freehand"}initialize(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool()}destroy(){this._removeDrawTool(),this.emit("destroy")}complete(){this._completeDrawing()}_getGeometryZValue(){return this.hasZ&&this.vertices.length>0?this.vertices[0][2]:this.defaultZ}_addViewHandles(){"click"===this.mode?this.addHandles(this._getClickModeViewHandles()):this.addHandles(this._getDragModeViewHandles())}_getDragModeViewHandles(){return[this.view.on("immediate-click",(e=>{e.stopPropagation(),e.mapPoint&&!this._panEnabled&&null!=this.getCoordsFromScreenPoint((0,$.ZV)(e))&&(this._vertexAddHandler(e),this._drawCompleteHandler(e))}),B.o.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._panEnabled||(this._resetGeometry(),this._addVertexOnPointerUp=!0,this._cursorScreenPoint=(0,$.ZV)(e),this._activePointerId=e.pointerId,this._vertexAddHandler(e),this._isDragging=!1,"touch"===e.pointerType&&this._updateCursor()))}),B.o.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),null==this._activePointerId&&"touch"!==e.pointerType&&(this._cursorScreenPoint=(0,$.ZV)(e),this._updateCursor())}),B.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._isDragging=!0,this._cursorScreenPoint=(0,$.ZV)(e),this._updateCursor())}),B.o.TOOL),this.view.on("pointer-up",(e=>{this._shouldHandlePointerEvent(e)&&this._addVertexOnPointerUp&&(this._abortSnapping(),this._activePointerId=null,this._isDragging&&this._vertexAddHandler(e),2===this._committedVertices.length&&this._drawCompleteHandler(e),this._isDragging=!1)}),B.o.TOOL),this.view.on("key-down",(e=>{e.key===K.NE.complete&&this._cursorScreenPoint?(this._abortSnapping(),this._vertexAddHandler(e),this._drawCompleteHandler(e)):e.key===K.NE.pan&&(this._panEnabled=!0)}),B.o.TOOL),this.view.on("key-up",(e=>{e.key===K.NE.pan&&(this._panEnabled=!1)}),B.o.TOOL),this.view.on("drag",(e=>{null!=this._activePointerId&&e.stopPropagation()}),B.o.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),B.o.TOOL)]}_getClickModeViewHandles(){return[this.view.on("pointer-down",(e=>{this._abortSnapping(),this._cursorScreenPoint=(0,$.ZV)(e),this._activePointerId=e.pointerId,this._isDragging=!1,"touch"===e.pointerType&&this._updateCursor()}),B.o.TOOL),this.view.on("pointer-move",(e=>{this._abortSnapping(),this._cursorScreenPoint=(0,$.ZV)(e),null==this._activePointerId&&"touch"!==e.pointerType&&this._updateCursor()}),B.o.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._isDragging=!0)}),B.o.TOOL),this.view.on("pointer-up",(e=>{this._shouldHandlePointerEvent(e)&&(this._abortSnapping(),this._activePointerId=null,e.stopPropagation(),this._isDragging||this._vertexAddHandler(e),2!==this.vertices.length||this._isDragging||this._drawCompleteHandler(e),this._isDragging=!1)}),B.o.TOOL),this.view.on("key-down",(e=>{e.key===K.NE.vertexAdd&&this._cursorScreenPoint&&(this._vertexAddHandler(e),2===this.vertices.length&&this._drawCompleteHandler(e)),e.key===K.NE.complete&&this._cursorScreenPoint&&2===this.vertices.length&&(this._vertexAddHandler(e),this._drawCompleteHandler(e))}),B.o.TOOL)]}_addDrawTool(){const e=new Ae({view:this.view,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"segment",mode:this.mode});this._drawTool=e,this.view.addAndActivateTool(e),this.addHandles([e.on("vertex-add",(t=>{1===t.vertices.length&&this.emit("vertex-add",new z(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("cursor-update",(t=>{1===t.vertices.length&&this.emit("cursor-update",new N(this.view,t.vertices[0].vertexIndex,e.getVertexCoords()))})),e.on("complete",(t=>{this.emit("draw-complete",new W(e.getVertexCoords())),this._removeDrawTool()})),this.view.on("key-down",(t=>{t.key!==K.NE.vertexAdd||t.repeat||"click"!==this.mode?t.key!==K.NE.complete||t.repeat||e.completeCreateOperation():e.drawOperation.numCommittedVertices>0?e.completeCreateOperation():e.drawOperation.commitStagedVertex()}),B.o.TOOL)])}_removeDrawTool(){this._drawTool&&(this.view.tools.remove(this._drawTool),this._drawTool=null)}_addVertex(e){const t=this._coordinateHelper.arrayToVector(e);if(this._isDuplicateOfLastVertex(t))return;this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometryOperations.appendVertex(t),1===this._committedVertices.length&&(this.viewAlignedCoordinateSystem=function(e,t){if("2d"===e.type)return new Ke(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if("3d"===e.type){const i=t.length>2?new T.A({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new T.A({x:t[0],y:t[1],spatialReference:e.spatialReference});return new $e(e,i)}return null}(this.view,this._committedVertices[0]));const i=this._committedVertices.length-1,n=new z(this.view,i,this.vertices);this.emit("vertex-add",n)}_updateCursor(){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const e=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);null!=e&&this._pushCursorVertex(e.vertex,(()=>this.emit("cursor-update",new N(this.view,this._activeComponent.vertices.length,this.vertices,null!=this._stagedVertex?new T.A(this._stagedVertex):null))))}_completeDrawing(){if(this._drawTool)return this._drawTool.completeCreateOperation(),void this.removeAllHandles();if(this._activePointerId=null,this._popCursorVertex(),this._cursorScreenPoint=null,this._isDragging=!1,this._abortSnapping(),null!=this._snappingManager&&this._snappingManager.doneSnapping(),this.vertices.length<1)return;const e=new W(this.vertices);this.emit("draw-complete",e),e.defaultPrevented||this.removeAllHandles()}_resetGeometry(){this._editGeometryOperations.destroy(),this._editGeometryOperations=new D.p(new A.ZE("polygon",this._coordinateHelper)),this._activeComponent=new A.uA(this._coordinateHelper.spatialReference,v.RT.Local),this._editGeometryOperations.data.components.push(this._activeComponent)}};(0,n._)([(0,s.MZ)({type:["freehand","click"]})],qe.prototype,"mode",void 0),qe=(0,n._)([(0,r.$)("esri/views/2d/engine/markup/SegmentDrawAction")],qe);let Xe=class extends o.A{constructor(){super(...arguments),this.activeAction=null,this.type="draw",this.view=null}destroy(){this.activeAction&&(this.activeAction.destroy(),this.activeAction=null)}create(e,t){this.reset();const i={view:this.view,...t};switch(e){case"point":i.editGeometryType="point",this.activeAction=new De(i);break;case"polyline":i.editGeometryType="polyline",this.activeAction=new Le(i);break;case"multipoint":i.editGeometryType="polygon",this.activeAction=new Y(i);break;case"polygon":i.editGeometryType="polygon",this.activeAction=new Ee(i);break;case"rectangle":case"circle":case"ellipse":case"triangle":i.editGeometryType="polygon",this.activeAction=new qe(i)}return this.activeAction}complete(){this.activeAction&&this.activeAction.complete(),this.activeAction=null}reset(){this.activeAction&&this.activeAction.destroy(),this.activeAction=null}};(0,n._)([(0,s.MZ)()],Xe.prototype,"activeAction",void 0),(0,n._)([(0,s.MZ)({readOnly:!0})],Xe.prototype,"type",void 0),(0,n._)([(0,s.MZ)()],Xe.prototype,"view",void 0),Xe=(0,n._)([(0,r.$)("esri.views.draw.Draw")],Xe);const Ye=Xe},70321:(e,t,i)=>{i.d(t,{l:()=>w});var n=i(35143),o=i(91967),s=i(54099),r=i(68134),a=i(76931),l=i(46053),d=(i(81806),i(76460),i(47249),i(85842)),h=i(19555),p=i(20664),c=i(9392),u=i(9624),v=i(64232),_=i(12482),m=i(84202),g=i(731);var y=i(55754);let w=class extends o.A{set graphic(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}get elevationInfo(){const{layer:e}=this.graphic,t=e&&"elevationInfo"in e?e.elevationInfo:null,i=(0,_.ky)(this.graphic),n=t?t.offset:0;return new g.A({mode:i,offset:n})}set focusedSymbol(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}set hovering(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}set selected(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.consumesClicks=!0,this.events=new s.A.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(e){const t=this.graphic;if(!1===t.visible)return null;const i=t.geometry;if(null==i)return null;const n=this._get("focusedSymbol"),o=null!=n?n:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,i,o):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),null!=this.layer&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),null!=this.layer&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=(0,r.wB)((()=>{var e;return null===(e=this.graphic)||void 0===e?void 0:e.symbol}),(e=>{null!=e&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&null!=this.focusedSymbol&&(this.graphic.symbol=this.focusedSymbol))}),r.OH)}detachSymbolChanged(){null!=this._graphicSymbolChangedHandle&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&null!=this.focusedSymbol?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,i,n){var o;if(null==(n=n||(0,m.SF)(i)))return null;let s=this._circleCollisionCache;if("point"===i.type&&"cim"===n.type&&"CIMPointSymbol"===(null===(o=n.data.symbol)||void 0===o?void 0:o.type)&&n.data.symbol.symbolLayers){const{offsetX:o,offsetY:s,size:r}=function(e){let t=0,i=0,n=0;return e?("cim"===e.type&&e.data.symbol&&"symbolLayers"in e.data.symbol&&e.data.symbol.symbolLayers&&e.data.symbol.symbolLayers.map((e=>{"CIMVectorMarker"===e.type&&e.anchorPoint&&(Math.abs(e.anchorPoint.x)>t&&(t=e.anchorPoint.x),Math.abs(e.anchorPoint.y)>i&&(i=e.anchorPoint.y),null!=e.size&&e.size>n&&(n=e.size))})),t=(0,a.Lz)(t),i=(0,a.Lz)(i),n=(0,a.Lz)(n),{offsetX:t,offsetY:i,size:n}):{offsetX:t,offsetY:i,size:n}}(n),l=(0,a.WA)(t,x),d=r/2,p=e.toScreen(i),c=p.x+o,u=p.y+s;return(0,h.hG)(l,[c,u])<d*d?1:null}if("point"!==i.type||"simple-marker"!==n.type)return(0,y.t)(t,i,e)?1:null;if(null==s||!s.originalPoint.equals(i)){const t=i,o=e.spatialReference;if((0,u.canProjectWithoutEngine)(t.spatialReference,o)){const e=(0,u.project)(t,o);s={originalPoint:t.clone(),mapPoint:e,radiusPx:(0,a.Lz)(n.size)},this._circleCollisionCache=s}}if(null!=s){var r;const i=(0,a.WA)(t,x),o=null===(r=e.toScreen)||void 0===r?void 0:r.call(e,s.mapPoint);if(!o)return null;const l=s.radiusPx,d=o.x+(0,a.Lz)(n.xoffset),p=o.y-(0,a.Lz)(n.yoffset);return(0,h.hG)(i,[d,p])<l*l?1:null}return null}_intersectDistance3D(e,t,i){const n=e.toMap(t,{include:[i]});return n&&(0,v.g)(n,f,e.renderSpatialReference)?(0,p.q)(f,e.state.camera.eye):null}};(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],w.prototype,"graphic",null),(0,n._)([(0,l.MZ)()],w.prototype,"elevationInfo",null),(0,n._)([(0,l.MZ)({constructOnly:!0,nonNullable:!0})],w.prototype,"view",void 0),(0,n._)([(0,l.MZ)({value:null})],w.prototype,"focusedSymbol",null),(0,n._)([(0,l.MZ)({constructOnly:!0})],w.prototype,"layer",void 0),(0,n._)([(0,l.MZ)()],w.prototype,"interactive",void 0),(0,n._)([(0,l.MZ)()],w.prototype,"selectable",void 0),(0,n._)([(0,l.MZ)()],w.prototype,"grabbable",void 0),(0,n._)([(0,l.MZ)({value:!1})],w.prototype,"grabbing",null),(0,n._)([(0,l.MZ)()],w.prototype,"dragging",void 0),(0,n._)([(0,l.MZ)()],w.prototype,"hovering",null),(0,n._)([(0,l.MZ)({value:!1})],w.prototype,"selected",null),(0,n._)([(0,l.MZ)()],w.prototype,"cursor",void 0),w=(0,n._)([(0,d.$)("esri.views.interactive.GraphicManipulator")],w);const f=(0,c.vt)(),x=(0,a.gs)()},14318:(e,t,i)=>{i.d(t,{O:()=>h});var n=i(35143),o=i(91967),s=i(30726),r=i(50346),a=i(46053),l=(i(81806),i(76460),i(47249),i(85842)),d=i(59752);let h=class extends o.A{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,r.sg)((async(e,t,i,n)=>{const o=this._frameTask;if(null==o)return;const s=await o.schedule((()=>t.snap({...e,context:i,signal:n})),n);s.valid&&await o.schedule((()=>{this.stagedPoint=s.apply(),e!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=t.update({...this._snapPoints,context:i}))}),n)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){var e;const t="3d"===this.view.type?null===(e=this.view)||void 0===e||null===(e=e.resourceController)||void 0===e?void 0:e.scheduler:null;this._frameTask=null!=t?t.registerTask(d.W6.SNAPPING):d.nu}destroy(){this._abortController=(0,s.DC)(this._abortController),this._frameTask=(0,s.xt)(this._frameTask)}update(e,t,i){this._snapPoints=e;const{point:n,scenePoint:o}=e,s=t.update({point:n,scenePoint:o,context:i});return this.stagedPoint=s,s}async snap(e,t,i){const{point:n,scenePoint:o}=e;return this.stagedPoint=t.update({point:n,scenePoint:o,context:i}),this._snapPoints=e,null==this._abortController&&(this._abortController=new AbortController),this._snap(e,t,i,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){null!=this._snapPoints&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=(0,s.DC)(this._abortController),this._snapPoints=null}};(0,n._)([(0,a.MZ)({constructOnly:!0})],h.prototype,"view",void 0),(0,n._)([(0,a.MZ)()],h.prototype,"stagedPoint",null),(0,n._)([(0,a.MZ)()],h.prototype,"constrainResult",void 0),(0,n._)([(0,a.MZ)()],h.prototype,"_stagedPoint",void 0),h=(0,n._)([(0,l.$)("esri.views.interactive.snapping.SnappingOperation")],h)},55754:(e,t,i)=>{i.d(t,{V:()=>r,t:()=>a});i(35238);var n=i(31633),o=i(4955),s=i(76797);function r(e,t,i){var o;let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new s.A,a=0;if("2d"===i.type)a=t*(null!==(o=i.resolution)&&void 0!==o?o:0);else if("3d"===i.type){const o=i.overlayPixelSizeInMapUnits(e),s=i.basemapSpatialReference;a=null==s||s.equals(i.spatialReference)?t*o:(0,n.GA)(s)/(0,n.GA)(i.spatialReference)}const l=e.x-a,d=e.y-a,h=e.x+a,p=e.y+a,{spatialReference:c}=i;return r.xmin=Math.min(l,h),r.ymin=Math.min(d,p),r.xmax=Math.max(l,h),r.ymax=Math.max(d,p),r.spatialReference=c,r}function a(e,t,i){const n=i.toMap(e);return null!=n&&r(n,(0,o.o)(),i,l).intersects(t)}const l=new s.A},69124:(e,t,i)=>{i.d(t,{j:()=>d});var n=i(35143),o=i(91967),s=i(76460),r=i(68134),a=i(46053),l=(i(81806),i(47249),i(85842));let d=class extends o.A{constructor(e){super(e),this.tool=null,this._loggedUnsupportedErrorOnce=!1,this.logger=s.A.getLogger(this),null!=(null===e||void 0===e?void 0:e.visible)&&(this.visible=e.visible)}initialize(){this.addHandles((0,r.wB)((()=>({ready:null!=this.view&&this.view.ready,supported:this.supported})),(e=>{let{ready:t,supported:i}=e;!t||i||this._loggedUnsupportedErrorOnce||(this.logError(this.unsupportedErrorMessage),this._loggedUnsupportedErrorOnce=!0)}),r.pc))}destroy(){this.removeTool(),this.view=null}get active(){return null!=this.tool&&this.tool.active}get disabled(){return null==this.view||!this.view.ready||!this.supported}get supported(){return null==this.view||this.view.type===this.supportedViewType}get view(){return this._get("view")}set view(e){if(e===this.view)return;this.removeTool(),this._set("view",e);const t="tools";this.removeHandles(t),null!=e&&this.addHandles(e.tools.on("after-remove",(e=>{e.item===this.tool&&this._set("tool",null)})),t)}set visible(e){this._set("visible",e),null!=this.tool&&(this.tool.visible=e)}createTool(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{interactive:!1};if(this.removeTool(),null==this.view||!this.view.ready||!this.supported)return;const t=this.constructTool();t.created?(this._set("tool",t),this.view.tools.add(t)):e.interactive?(this._set("tool",t),this.view.addAndActivateTool(t),(0,r.z7)((()=>t.created),(()=>{t.active&&null!=this.view&&(this.view.activeTool=null)}),{initial:!0,once:!0})):t.destroy()}removeTool(){var e;const t=this.tool;if(null==t)return;const i=null===(e=this.view)||void 0===e?void 0:e.tools;null!=i?i.remove(t):t.destroy(),this._set("tool",null)}logError(){this.logger.error(...arguments)}};(0,n._)([(0,a.MZ)({constructOnly:!0})],d.prototype,"tool",void 0),(0,n._)([(0,a.MZ)()],d.prototype,"active",null),(0,n._)([(0,a.MZ)()],d.prototype,"disabled",null),(0,n._)([(0,a.MZ)()],d.prototype,"supported",null),(0,n._)([(0,a.MZ)({value:null})],d.prototype,"view",null),(0,n._)([(0,a.MZ)({type:Boolean,value:!0})],d.prototype,"visible",null),d=(0,n._)([(0,l.$)("esri.widgets.support.InteractiveToolViewModel")],d)},19371:(e,t,i)=>{i.d(t,{I:()=>m});var n=i(35143),o=i(46053),s=(i(81806),i(76460),i(47249),i(85842)),r=i(25329),a=i(77666),l=i(31633),d=(i(76099),i(63582)),h=i(54761);const p="esri-unit-select",c={base:p,label:"".concat(p,"__label"),select:"".concat(p,"__select")};let u=class extends r.A{constructor(e,t){super(e,t),this._onSelectChange=e=>{this.onChange(e.target.value)}}loadDependencies(){return(0,a.W)({label:()=>Promise.resolve().then(i.bind(i,42054)),option:()=>i.e(2764).then(i.bind(i,92764)),select:()=>i.e(1381).then(i.bind(i,81381))})}render(){const{messages:e,options:t,selectLabel:i,value:n,_onSelectChange:o}=this;return(0,h.K)("div",{class:c.base,key:"units"},(0,h.K)("calcite-label",{class:c.label},i,(0,h.K)("calcite-select",{class:c.select,label:i,onCalciteSelectChange:o},t.map((t=>{var i;return(0,h.K)("calcite-option",{key:t,selected:t===n,value:t},(0,l.GT)(t)?e.systems[t]:null===(i=e.units[t])||void 0===i?void 0:i.pluralCapitalized)})))))}};(0,n._)([(0,o.MZ)()],u.prototype,"options",void 0),(0,n._)([(0,o.MZ)()],u.prototype,"onChange",void 0),(0,n._)([(0,o.MZ)()],u.prototype,"selectLabel",void 0),(0,n._)([(0,o.MZ)()],u.prototype,"value",void 0),(0,n._)([(0,o.MZ)(),(0,d.G)("esri/core/t9n/Units")],u.prototype,"messages",void 0),u=(0,n._)([(0,s.$)("esri.widgets.support.UnitSelect")],u);const v="esri-measurement-widget-content",_={base:v,actions:"".concat(v,"__actions"),error:"".concat(v,"__error"),hint:"".concat(v,"__hint"),hintText:"".concat(v,"__hint-text"),panelError:"".concat(v,"__panel--error"),settings:"".concat(v,"__settings"),measurement:"".concat(v,"__measurement"),measurementItem:"".concat(v,"__measurement-item"),measurementItemDisabled:"".concat(v,"__measurement-item--disabled"),measurementItemTitle:"".concat(v,"__measurement-item__title"),measurementItemValue:"".concat(v,"__measurement-item__value")};let m=class extends r.A{constructor(e,t){super(e,t)}loadDependencies(){return(0,a.W)({button:()=>i.e(2602).then(i.bind(i,52602))})}render(){return(0,h.K)("div",{class:_.base},this._renderContent())}_renderContent(){const{supported:e,active:t,state:i}=this;switch(i){case"disabled":case"ready":return e?t?this._renderHint():this._renderActions():this._renderUnsupportedMessage();case"measuring":case"measured":return[this._renderSettings(),this._renderMeasurement(),this._renderActions()]}}_renderUnsupportedMessage(){return(0,h.K)("section",{class:_.error,key:"unsupported"},(0,h.K)("p",null,this.messages.unsupported))}_renderHint(){const{messages:e}=this;return(0,h.K)("section",{class:_.hint,key:"hint"},(0,h.K)("p",{class:_.hintText},e.hint))}_renderSettings(){return(0,h.K)("div",{class:_.settings,key:"settings"},(0,h.K)(u,{options:this.unitOptions,selectLabel:this.messages.unit,value:this.unit,onChange:this.onUnitChange}))}_renderMeasurement(){return(0,h.K)("section",{class:_.measurement,key:"measurement"},this.measurementItems.map((e=>this._renderMeasurementItem(e))))}_renderMeasurementItem(e){let{key:t,title:i,value:n}=e;return(0,h.K)("div",{class:this.classes(_.measurementItem,null==n&&_.measurementItemDisabled),key:t},(0,h.K)("span",{class:_.measurementItemTitle},i),(0,h.K)("span",{"aria-live":"polite",class:_.measurementItemValue},null!==n&&void 0!==n?n:this.messages.notApplicable))}_renderActions(){const{messages:e}=this;return(0,h.K)("div",{class:_.actions},(0,h.K)("calcite-button",{class:this.newMeasurementButtonClass,disabled:"disabled"===this.state,onclick:this.onNewMeasurementClick},e.newMeasurement))}};(0,n._)([(0,o.MZ)()],m.prototype,"active",void 0),(0,n._)([(0,o.MZ)()],m.prototype,"measurementItems",void 0),(0,n._)([(0,o.MZ)()],m.prototype,"messages",void 0),(0,n._)([(0,o.MZ)()],m.prototype,"newMeasurementButtonClass",void 0),(0,n._)([(0,o.MZ)()],m.prototype,"onNewMeasurementClick",void 0),(0,n._)([(0,o.MZ)()],m.prototype,"onUnitChange",void 0),(0,n._)([(0,o.MZ)()],m.prototype,"state",void 0),(0,n._)([(0,o.MZ)()],m.prototype,"supported",void 0),(0,n._)([(0,o.MZ)()],m.prototype,"unit",void 0),(0,n._)([(0,o.MZ)()],m.prototype,"unitOptions",void 0),m=(0,n._)([(0,s.$)("esri.widgets.support.MeasurementWidgetContent")],m)}}]);
//# sourceMappingURL=5955.e1636832.chunk.js.map