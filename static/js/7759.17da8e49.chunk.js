"use strict";(self.webpackChunksc_tbm=self.webpackChunksc_tbm||[]).push([[7759],{56567:(t,e,i)=>{i.d(e,{A:()=>m});var n=i(35143),a=(i(35238),i(23458)),s=i(69098),o=i(73582),r=i(42553),l=i(46053),c=i(21403),u=(i(47249),i(81806),i(85842)),d=i(40565),p=i(13904);let h=class extends((0,r.Te)(s.P)){constructor(t){super(t),this.type="length",this.startPoint=null,this.endPoint=null,this.measureType=a.L.Direct,this.offset=0,this.orientation=0}};(0,n._)([(0,l.MZ)({type:["length"],json:{write:{isRequired:!0}}})],h.prototype,"type",void 0),(0,n._)([(0,l.MZ)({type:p.A,json:{write:!0}})],h.prototype,"startPoint",void 0),(0,n._)([(0,l.MZ)({type:p.A,json:{write:!0}})],h.prototype,"endPoint",void 0),(0,n._)([(0,l.MZ)({type:a.h,nonNullable:!0,json:{write:{isRequired:!0}}})],h.prototype,"measureType",void 0),(0,n._)([(0,l.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],h.prototype,"offset",void 0),(0,n._)([(0,l.MZ)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,c.w)((t=>o.ie.normalize((0,d.GB)(t),0,!0)))],h.prototype,"orientation",void 0),h=(0,n._)([(0,u.$)("esri.analysis.LengthDimension")],h);const m=h},23458:(t,e,i)=>{var n;i.d(e,{L:()=>n,h:()=>a}),function(t){t.Horizontal="horizontal",t.Vertical="vertical",t.Direct="direct"}(n||(n={}));const a=[n.Horizontal,n.Vertical,n.Direct]},29201:(t,e,i)=>{i.d(e,{I:()=>S,b:()=>M});var n,a,s,o=i(57528),r=i(34981),l=i(26917),c=i(59395),u=i(81993),d=i(90235),p=i(80883),h=i(3799),m=i(21390),g=i(64839),v=i(32307),_=i(70367),f=i(10773),y=i(66470);function M(t){const e=new v.N5,{vertex:i,fragment:M}=e;return(0,h.NB)(i,t),e.include(c.d,t),e.attributes.add(y.r.POSITION,"vec3"),e.attributes.add(y.r.UV0,"vec2"),t.perspectiveInterpolation&&e.attributes.add(y.r.PERSPECTIVEDIVIDE,"float"),e.varyings.add("vpos","vec3"),t.multipassEnabled&&e.varyings.add("depth","float"),i.code.add((0,g.H)(n||(n=(0,o.A)(["\n    void main(void) {\n      vpos = position;\n      ","\n      vTexCoord = uv0;\n      gl_Position = transformPosition(proj, view, vpos);\n\n      ","\n    }\n  "])),t.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",t.perspectiveInterpolation?"gl_Position *= perspectiveDivide;":"")),e.include(l.HQ,t),e.include(u.Q,t),M.uniforms.add(new _.N("tex",(t=>t.texture)),new m.m("opacity",(t=>t.opacity))),e.varyings.add("vTexCoord","vec2"),t.output===r.V.Alpha?M.code.add((0,g.H)(a||(a=(0,o.A)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n\n      float alpha = texture(tex, vTexCoord).a * opacity;\n      if (alpha  < ",") {\n        discard;\n      }\n\n      fragColor = vec4(alpha);\n    }\n    "])),t.multipassEnabled?"terrainDepthTest(depth);":"",g.H.float(d.H))):(M.include(p.a),M.code.add((0,g.H)(s||(s=(0,o.A)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      fragColor = texture(tex, vTexCoord) * opacity;\n\n      if (fragColor.a < ",") {\n        discard;\n      }\n\n      fragColor = highlightSlice(fragColor, vpos);\n      ","\n    }\n    "])),t.multipassEnabled?"terrainDepthTest(depth);":"",g.H.float(d.H),t.transparencyPassType===f.y.Color?"fragColor = premultiplyAlpha(fragColor);":""))),e}const S=Object.freeze(Object.defineProperty({__proto__:null,build:M},Symbol.toStringTag,{value:"Module"}))},57759:(t,e,i)=>{i.r(e),i.d(e,{default:()=>pi});var n,a=i(35143),s=i(91967),o=i(54901),r=i(76460),l=i(30726),c=i(68134),u=i(46053),d=(i(81806),i(47249),i(85842)),p=i(2522),h=i(23458),m=i(31633),g=i(19747),v=i(15941),_=i(24648),f=i(34761),y=i(13191),M=i(20664),S=i(9392),w=i(5568),P=i(75762),b=i(18117),C=i(32535),O=i(25191),D=i(14487),T=i(80963),A=i(41868);function x(t,e,i){const a=I(t,e,i,n.Direct);return null!=a?(0,_.d_)(a.direct,a.unit):null}function z(t,e,i){const a=I(t,e,i,n.Horizontal);return null!=a?(0,_.d_)(a.horizontal,a.unit):null}function I(t,e,i,a){const s=(0,A.l)(i),o=(0,m._H)(s);if(null==o)return null;const r=e[2]-t[2];if(a===n.Vertical)return{verticalSigned:r,unit:o};if(!(0,D.F)(t,i,L,s)||!(0,D.F)(e,i,E,s))return null;if(a===n.Direct)return{direct:(0,M.q)(E,L),unit:o};if((0,M.s)(Z,t[0],t[1],e[2]),!(0,D.F)(Z,i,Z,s))return null;const l=(0,M.q)(Z,E);return a===n.Horizontal?{horizontal:l,unit:o}:{direct:(0,M.q)(E,L),horizontal:l,vertical:Math.abs(r),unit:o}}!function(t){t[t.Direct=0]="Direct",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"}(n||(n={}));const R=(0,S.vt)(),H=(0,S.vt)(),L=(0,S.vt)(),E=(0,S.vt)(),Z=(0,S.vt)();var k=i(92854);function N(t,e){var i;return null!==(i=(0,k.Og)(t,e))&&void 0!==i?i:function(t,e){const{spatialReference:i}=t;return(0,T.aI)(i,e.spatialReference)?(R[0]=t.x,R[1]=t.y,R[2]=t.hasZ?t.z:0,H[0]=e.x,H[1]=e.y,H[2]=e.hasZ?e.z:0,z(R,H,i)):null}(t,e)}(0,S.vt)(),(0,S.vt)();var V,G=i(90659);function j(t){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:i,dimension:{offset:n,measureType:a,orientation:s}}=t;return{elevationAlignedStartPoint:e,elevationAlignedEndPoint:i,offset:n,measureType:a,orientation:s}}function B(t,e){var i,n,a;let{elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,offset:r,measureType:l,orientation:c}=t,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null==s||null==o)return null;const d=W(null!==(i=null===u||void 0===u?void 0:u.directSegment)&&void 0!==i?i:new O.C,{elevationAlignedStartPoint:s,elevationAlignedEndPoint:o},e),p=null!==(n=null===u||void 0===u?void 0:u.primaryOffsetAxis)&&void 0!==n?n:(0,S.vt)();X(p,{measureType:l,elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,directSegment:d,orientation:c,renderCoordsHelper:e});const m=null!==(a=null===u||void 0===u?void 0:u.dimensionSegment)&&void 0!==a?a:new O.C;return Q({elevationAlignedStartPoint:s,elevationAlignedEndPoint:o})&&l===h.L.Vertical?((0,M.c)(m.startRenderSpace,d.startRenderSpace),(0,M.c)(m.endRenderSpace,d.endRenderSpace)):J(m,{offsetAxis:p,offset:r,relativeToSegment:d,renderCoordsHelper:e}),{elevationAlignedStartPoint:s,elevationAlignedEndPoint:o,directSegment:d,dimensionSegment:m,primaryOffsetAxis:p,spatialReference:e.spatialReference}}function U(t,e,i,n){return e===V.Start?((0,M.c)(t.startRenderSpace,i.startRenderSpace),(0,M.c)(t.endRenderSpace,n.startRenderSpace)):((0,M.c)(t.startRenderSpace,i.endRenderSpace),(0,M.c)(t.endRenderSpace,n.endRenderSpace)),t}function F(t,e,i,n){switch(e){case h.L.Direct:return W(t,i,n);case h.L.Horizontal:case h.L.Vertical:{const{elevationAlignedStartPoint:a,elevationAlignedEndPoint:s,dimension:o,geometry:r}=i;let l;o.measureType===h.L.Direct?(l=function(t,e){const i=t.directSegment.eval(.5,P.rq.get()),n=e.worldUpAtPosition(i,P.rq.get()),a=t.dimensionSegment.eval(.5,P.rq.get()),s=(0,M.z)(P.rq.get(),a,i);return!(0,M.G)(s,S.uY)&&(0,M.k)(s,n)>0}(r,n)===a.z>s.z,e===h.L.Horizontal&&(l=!l)):l=!function(t){const{startRenderSpace:e,endRenderSpace:i}=t.dimensionSegment,{startRenderSpace:n,endRenderSpace:a}=t.directSegment;return(0,M.w)(n,e)<(0,M.w)(a,i)}(r);const[c,u]=l?[a,s]:[s,a],d=(0,C.EL)(u,Y);return e===h.L.Horizontal?d.z=c.z:(d.x=c.x,d.y=c.y),n.toRenderCoords(c,t.startRenderSpace),n.toRenderCoords(d,t.endRenderSpace),t}}}function W(t,e,i){return i.toRenderCoords(e.elevationAlignedStartPoint,t.startRenderSpace),i.toRenderCoords(e.elevationAlignedEndPoint,t.endRenderSpace),t}!function(t){t[t.Start=0]="Start",t[t.End=1]="End"}(V||(V={}));const Y=(0,b.T)(0,0,0,null);const q=new O.C;function X(t,e){const{measureType:i,elevationAlignedStartPoint:n,elevationAlignedEndPoint:a,directSegment:{startRenderSpace:s,endRenderSpace:o},directSegment:r,renderCoordsHelper:l}=e,c=r.eval(.5,P.rq.get()),u=l.worldUpAtPosition(c,P.rq.get()),d=l.worldBasisAtPosition(c,w._.Y,P.rq.get());switch(i){case h.L.Horizontal:(0,M.c)(t,u);break;case h.L.Vertical:(0,M.k)(s,u)<(0,M.k)(o,u)?(0,M.z)(t,o,s):(0,M.z)(t,s,o),(0,M.b)(t,t,u),(0,M.b)(t,t,u);break;case h.L.Direct:{var p;const i=null!==(p=e.orientation)&&void 0!==p?p:0;if(Q({elevationAlignedStartPoint:n,elevationAlignedEndPoint:a}))(0,f.$0)($,-(0,v.kU)(i),u),(0,M.e)(t,d,$);else{const e=(0,M.z)(P.rq.get(),o,s),n=(0,M.b)(P.rq.get(),e,u);(0,M.b)(n,n,e),(0,f.$0)($,(0,v.kU)(i),e),(0,M.e)(t,n,$)}break}}return(0,M.G)(t,S.uY)?(0,M.c)(t,d):(0,M.n)(t,t)}const $=(0,y.vt)();function Q(t){let{elevationAlignedStartPoint:e,elevationAlignedEndPoint:i}=t;return null!=e&&null!=i&&e.x===i.x&&e.y===i.y}function J(t,e){const{offsetAxis:i,offset:n,relativeToSegment:{startRenderSpace:a,endRenderSpace:s},relativeToSegment:o,renderCoordsHelper:r}=e,l=n/r.unitInMeters,[c,u]=function(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const a=(0,M.k)(e,i),s=(0,M.k)(t,i),o=Math.abs(a-s)+n;return a>s?[o,n]:[n,o]}(a,s,i,l);return(0,M.r)(t.startRenderSpace,o.startRenderSpace,i,c),(0,M.r)(t.endRenderSpace,o.endRenderSpace,i,u),t}function K(t,e,i){const n=e.directSegment.eval(.5,P.rq.get());return i.worldUpAtPosition(n,t)}function tt(t,e){const{startRenderSpace:i,endRenderSpace:n}=e.directSegment;return(0,M.z)(t,n,i)}function et(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{invert:!1};const{startRenderSpace:n,endRenderSpace:a}=e.dimensionSegment;return i.invert?(0,M.z)(t,n,a):(0,M.z)(t,a,n)}function it(t,e){const i=t.directSegment.eval(.5,P.rq.get());return e.headingAtPosition(i,t.primaryOffsetAxis)}const nt=(0,S.vt)();function at(t){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:i}=t;if(null==e||null==i)return!1;const n=function(t,e){const{spatialReference:i}=t;return(0,T.aI)(i,e.spatialReference)?(R[0]=t.x,R[1]=t.y,R[2]=t.hasZ?t.z:0,H[0]=e.x,H[1]=e.y,H[2]=e.hasZ?e.z:0,x(R,H,i)):null}(e,i);return null!=n&&(0,_.kM)(n,"meters").value>G.U}function st(t){return null!=t.geometry}let ot=class extends s.A{constructor(t){super(t)}initialize(){const t=(0,c.LF)((()=>this.analysisViewData.computations),(t=>{let{computation:e}=t;return this._watchComputation(e)}));this.addHandles((0,o.DQ)(t))}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return(0,g.c)(this.view)}_watchComputation(t){return(0,c.wB)((()=>j(t)),(e=>{const{measureType:i}=e;if(at(e)&&i!==h.L.Direct){const e=Math.round((0,m.oU)(G.U,"meters","kilometers"));return r.A.getLogger(this).warnOnce("A ".concat(i," dimension in the analysis (id: '").concat(this.analysis.id,"') will not display, because only direct dimensions can measure lengths greater than ").concat(e,' km. Update the measureType of the affected dimension to "direct" to display it.')),void(t.geometry=null)}const n=B(e,this.view.renderCoordsHelper,t.geometry);t.geometry=n,t.result.length=function(t,e,i){if(null==t)return null;let n;if(e===h.L.Horizontal)n=N(t.elevationAlignedStartPoint,t.elevationAlignedEndPoint);else{const{startRenderSpace:e,endRenderSpace:i}=t.dimensionSegment;n=x(e,i,t.spatialReference)}if(null==n)return null;const a=e===h.L.Vertical?(0,m.jE)(n.value,n.unit,i):(0,m.Vs)(n.value,n.unit,i);return(0,_.kM)(n,a)}(n,i,this._defaultUnit)}),c.pc)}};(0,a._)([(0,u.MZ)({constructOnly:!0})],ot.prototype,"analysisViewData",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0})],ot.prototype,"view",void 0),(0,a._)([(0,u.MZ)()],ot.prototype,"analysis",null),(0,a._)([(0,u.MZ)()],ot.prototype,"_defaultUnit",null),ot=(0,a._)([(0,d.$)("esri.views.3d.analysis.Dimension.support.DimensionController")],ot);i(35238);var rt=i(50176),lt=i(69539),ct=i(73582),ut=i(76931),dt=i(55855),pt=i(13927),ht=i(59784);function mt(t){return(0,ht._L)(t.accentColor,.5)}function gt(t){return(0,ht.bJ)(t.accentColor)}const vt=new lt.A([127,127,127,.5]),_t=6,ft=5;var yt=i(56121),Mt=i(38317),St=i(91175),wt=i(7947),Pt=i(99443),bt=i(50468),Ct=i(51799),Ot=i(62577),Dt=i(45463),Tt=i(66470),At=i(77447),xt=i(425),zt=i(70825),It=i(76336),Rt=i(13904);class Ht{constructor(t){this.start=t.start,this.end=t.end,this.offset=t.offset,this.heading=t.heading,this.rotation=t.rotation,this.direct=t.direct,this.horizontal=t.horizontal,this.vertical=t.vertical}manipulatorName(t){return Object.keys(this).find((e=>this.hasOwnProperty(e)&&t===this[e]))}values(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}forEachMeasureTypeManipulator(t){for(const e of h.h)t(this.manipulatorForMeasureType(e),e)}manipulatorForMeasureType(t){switch(t){case h.L.Direct:return this.direct;case h.L.Horizontal:return this.horizontal;case h.L.Vertical:return this.vertical}}}class Lt extends yt.q{constructor(t,e){const i=(0,Mt.UM)(lt.A.toUnitRGBA(mt(t.effectiveTheme))),n=[new St.M((0,Ot.CM)(i,1,32,32),Jt)];super({view:t,renderObjects:n,metadata:e.metadata,available:!1,grabCursor:"crosshair",radius:5,collisionPriority:1}),this._themeHandle=(0,c.wB)((()=>({color:lt.A.toUnitRGBA(mt(t.effectiveTheme))})),(t=>i.setParameters(t)))}destroy(){this._themeHandle.remove(),super.destroy()}}class Et extends yt.q{constructor(t,e){let{lineSizePt:i,material:n,metadata:a}=e;super({view:t,autoScaleRenderObjects:!1,collisionPriority:1,metadata:a}),this._options={calloutColor:(0,dt.vt)(),lineSizePt:i,material:n},this._themeHandle=(0,c.wB)((()=>lt.A.toUnitRGBA(mt(t.effectiveTheme))),(t=>{this._options.calloutColor=t,Qt(this,Zt({...this._options,metadata:this.metadata}))}),c.Vh)}update(t){let{lineSizePt:e,material:i}=t;this._options.lineSizePt=e,this._options.material=i,Qt(this,Zt({...this._options,metadata:this.metadata}))}destroy(){this._themeHandle.remove(),super.destroy()}}function Zt(t){let{calloutColor:e,lineSizePt:i,material:n,metadata:a}=t;return{calloutLength:.25*Pt.PV*.8*(0,ut.Lz)(i)+18,calloutColor:e,calloutWidth:2,customStateMask:Jt,discScale:.3,focusMultiplier:2,material:n,metadata:a}}function kt(t,e){let{computation:i,view:n}=e;return[(0,zt.Xt)(t,((t,e,a)=>{Nt({cancel:a,computation:i,settingHeading:!1,steps:e,view:n})})),t.events.on("immediate-click",(t=>{!function(t,e,i){const{dimension:n,geometry:a}=e;if(90===n.orientation||270===n.orientation)return n.orientation=0,void t.stopPropagation();if(null==a)return;const{renderCoordsHelper:s}=i,o=B({...j(e),orientation:90},s),r=B({...j(e),orientation:270},s);if(null==o||null==r)return;const l=it(o,s),c=it(r,s),u=jt(a,i),d=ct.ie.shortestSignedDiff(u,l),p=ct.ie.shortestSignedDiff(u,c);n.orientation=Math.abs(d)<Math.abs(p)?90:270,t.stopPropagation()}(t,i,n)}))]}function Nt(t){var e,i;const{cancel:n,computation:a,settingHeading:s,steps:o,view:r}=t;if(!st(a))return;const{renderCoordsHelper:l}=r,{dimension:c,geometry:u}=a,d=(0,S.vt)(),p=Wt((0,S.vt)(),u,u.directSegment,l),h=Yt(P.rq.get(),{forHeading:s,geometry:u,renderCoordsHelper:l}),m=(0,pt.O_)(p,h,(0,pt.vt)()),g=s?null!==(e=c.orientation)&&void 0!==e?e:it(u,r.renderCoordsHelper):null!==(i=c.orientation)&&void 0!==i?i:0;o.next((0,wt.AA)(r,m)).next((t=>{"start"===t.action&&(0,M.c)(d,t.renderStart);const e=(0,pt.Qj)(m),i=(0,Mt.FY)(d,t.renderEnd,p,e);let n=g-(0,v.KJ)(i);s||(n=function(t){const e=ct.ie.normalize(t)%90;return e<ft?t-e:90-e<ft?t+(90-e):t}(n)),c.orientation=n})),n.next((0,zt.VG)(c,["orientation"]))}function Vt(t,e){let{computation:i,manipulatorMeasureType:n,view:a}=e,s=h.L.Direct,o=0,r=0;return[t.events.on("grab-changed",(e=>{if("start"!==e.action||!st(i))return;const{dimension:l,geometry:c}=i;s=l.measureType,o=l.offset,r=l.orientation;const u=(0,M.c)(P.rq.get(),t.renderLocation);l.measureType=n,l.offset=function(t,e,i,n){const{directSegment:a}=i,s=X(P.rq.get(),{measureType:e,directSegment:a,renderCoordsHelper:n}),o=J(q,{offsetAxis:s,offset:0,relativeToSegment:a,renderCoordsHelper:n}).eval(.5,P.rq.get()),r=(0,M.z)(P.rq.get(),t,o);return(0,M.k)(r,s)*n.unitInMeters}(u,n,c,a.renderCoordsHelper),l.orientation=0})),(0,zt.Xt)(t,((t,e,l)=>{if(!st(i))return;const{geometry:c,dimension:u}=i,{renderCoordsHelper:d}=a,p=F(ie,n,i,d),h=X(P.rq.get(),{measureType:n,directSegment:c.directSegment,renderCoordsHelper:d}),m=(0,wt.z7)(t);e.next(m).next(Gt(a,u,p,h)),l.next(m).next((t=>(u.measureType=s,u.offset=o,u.orientation=r,t)))}))]}function Gt(t,e,i,n){const a=(0,M.f)(P.rq.get(),i.endRenderSpace,i.startRenderSpace);(0,M.b)(a,a,n);const s=(0,pt.O_)(i.startRenderSpace,a,(0,pt.vt)()),o=(0,pt.O_)(i.startRenderSpace,n,(0,pt.vt)()),r=e.offset;let l,c=0;const u=new zt.rh;return u.next((0,wt.AA)(t,s)).next((i=>{"start"===i.action&&(c=(0,pt.mN)(o,i.renderStart));const n=((0,pt.mN)(o,i.renderEnd)-c)*t.renderCoordsHelper.unitInMeters;e.offset=r+n,l=i})),t=>(u.execute(t),l)}function jt(t,e){const{directSegment:i}=t,{renderCoordsHelper:n}=e,a=K(P.rq.get(),t,n),s=tt(P.rq.get(),t),o=(0,M.b)(P.rq.get(),s,a),{viewForward:r}=e.state.camera;(0,M.k)(o,r)>0&&(0,M.h)(o,o,-1);const l=i.eval(.5,P.rq.get());return n.headingAtPosition(l,o)}function Bt(t,e,i,n){let{forHeading:a}=n;const{dimension:s,geometry:o}=e,{primaryOffsetAxis:r}=o,l=(0,M.h)(Ut,r,s.offset>=0?1:-1),c=Yt(Ft,{forHeading:a,geometry:o,renderCoordsHelper:i});(0,M.b)(c,c,l);const u=(0,Mt.wQ)(l,c,S.uY,ee);t.modelTransform=u,t.renderLocation=Wt(Kt,o,o.dimensionSegment,i)}const Ut=(0,S.vt)(),Ft=(0,S.vt)();function Wt(t,e,i,n){const{startRenderSpace:a,endRenderSpace:s}=i,o=function(t,e){const i=tt(qt,t),n=K(Xt,t,e);return(0,M.k)(i,n)>0}(e,n)?a:s;return(0,M.c)(t,o)}function Yt(t,e){let{forHeading:i,geometry:n,renderCoordsHelper:a}=e;return i?K(t,n,a):et(t,n,{invert:!0})}const qt=(0,S.vt)(),Xt=(0,S.vt)();function $t(t){return(0,ut.Lz)(t)+_t}function Qt(t,e){var i,n,a,s,o,r,l;const c=null!==(i=e.material)&&void 0!==i?i:new At.r({transparent:!0,writeDepth:!1,textureId:null===(n=e.texture)||void 0===n?void 0:n.id,renderOccluded:Dt.m$.Opaque,isDecoration:!0}),u=null!==(a=e.focusMultiplier)&&void 0!==a?a:Mt.eO.focusMultiplier,d=null!==(s=e.calloutLength)&&void 0!==s?s:Mt.eO.calloutLength,p=Mt.eO.discRadius*(null!==(o=e.discScale)&&void 0!==o?o:1),h=p*u,m=(t,e)=>{const i=[0,1,2,2,3,0];return new Ct.V(e,[[Tt.r.POSITION,new bt.n([d-t,-t,0,d+t,-t,0,d+t,t,0,d-t,t,0],i,3,!0)],[Tt.r.UV0,new bt.n([0,0,1,0,1,1,0,1],i,2,!0)]])},g=null!==(r=e.calloutWidth)&&void 0!==r?r:Mt.eO.calloutWidth,v=new xt.W({width:g,color:e.calloutColor,renderOccluded:Dt.m$.OccludeAndTransparent,isDecoration:!0}),_=(0,Ot.Z8)(v,[[0,0,0],[d-p,0,0]]),f=(0,Ot.Z8)(v,[[0,0,0],[d-h,0,0]]),y=null!==(l=e.customStateMask)&&void 0!==l?l:It.SJ.None;t.collisionType={type:"disc",direction:[0,0,1],offset:[d,0,0]},t.focusMultiplier=u,t.metadata=e.metadata,t.radius=p,t.renderObjects=[new St.M(m(p,c),It.p7.Unfocused|y),new St.M(_,It.p7.Unfocused|y),new St.M(m(h,c),It.p7.Focused|y),new St.M(f,It.p7.Focused|y)]}const Jt=It.SJ.Custom1,Kt=(0,S.vt)(),te=(0,S.vt)(),ee=(0,y.vt)(),ie=new O.C;var ne,ae=i(56567),se=i(88321),oe=i(53084),re=i(56002),le=i(50346),ce=i(19451);function ue(t,e,i){const{constraint:n,elevationAlignedStartPoint:a,elevationAlignedEndPoint:s,unconstrainedGeometry:o,view:r}=i,{dimension:l,previousConstraint:c,preConstraintProperties:u}=t;if(null==a||null==s)return;const d=()=>{"startPoint"in e?l.startPoint=e.startPoint:"endPoint"in e&&(l.endPoint=e.endPoint)};if(null==n)d(),null!=c&&null!=u&&(l.measureType=u.measureType,l.orientation=u.orientation);else switch(l.measureType=h.L.Direct,n){case ne.Horizontal:if(n!==c&&(l.orientation=0),"startPoint"in e){const t=e.startPoint;null!=t&&(t.z=s.z),l.startPoint=t}else if("endPoint"in e){const t=e.endPoint;null!=t&&(t.z=a.z),l.endPoint=t}break;case ne.Vertical:if(n!==c&&(l.orientation=jt(o,r)),"startPoint"in e){const t=e.startPoint;null!=t&&(t.x=s.x,t.y=s.y),l.startPoint=t}else if("endPoint"in e){const t=e.endPoint;null!=t&&(t.x=a.x,t.y=a.y),l.endPoint=t}break;case ne.Direct:n!==c&&null!=u&&(l.orientation=u.orientation),d()}t.previousConstraint=n,t.unconstrainedGeometry=o}!function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Direct=2]="Direct"}(ne||(ne={}));var de=i(59962),pe=i(3233),he=i(7256),me=i(43047),ge=i(32314),ve=i(49296),_e=i(44815),fe=i(67425);var ye=i(83490),Me=i(84294);class Se extends ge.X{constructor(t){super(t),this.view=null,this._renderOccluded=Dt.m$.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=(0,dt.ci)([1,127/255,0,1]),this._size=11,this._outlineColor=(0,dt.ci)([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(t){this._vertices=t,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(t){this._spatialReference=t,this.recreateGeometry()}get color(){return this._color}set color(t){(0,me.a)(t,this._color)||((0,me.c)(this._color,t),this._updateMaterial())}get size(){return this._size}set size(t){t!==this._size&&(this._size=t,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(t){(0,me.a)(t,this._outlineColor)||((0,me.c)(this._outlineColor,t),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(t){t!==this._outlineSize&&(this._outlineSize=t,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(t){this._elevationInfo=t,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const t=this.vertices;if(null==t||0===t.length)return[];const e=function(t,e,i,n,a){const s=(0,_e.jh)(3*t.length),o=(0,_e.jh)(s.length);t.forEach(((t,e)=>{s[3*e]=t[0],s[3*e+1]=t[1],s[3*e+2]=t.length>2?t[2]:0}));const r=(0,fe.au)(s,e,0,o,0,s,0,s.length/3,i,n,a),l=null!=r;return{numVertices:t.length,position:s,mapPositions:o,projectionSuccess:l,sampledElevation:r}}(t,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,ve.F.fromElevationInfo(this.elevationInfo)),i=[],n=e.numVertices,a=e.position;for(let s=0;s<n;++s){const t=(0,M.s)(we,a[3*s],a[3*s+1],a[3*s+2]),e=Pe(this._vertexMaterial,.5,t),n=Pe(this._vertexOutlineMaterial,.5,t);i.push({vertexGeometry:e,vertexOutlineGeometry:n})}return i}createGeometries(t){const e=this._createRenderGeometries();for(const{vertexGeometry:i,vertexOutlineGeometry:n}of e)t.addGeometry(i),t.addGeometry(n)}createExternalResources(){this._vertexMaterial=new Me.A({...this._vertexMaterialParameters,writeDepth:!0,cullFace:ye.s2.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new Me.A({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:ye.s2.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(t){t(this._vertexMaterial),t(this._vertexOutlineMaterial)}}const we=(0,S.vt)();function Pe(t,e,i){return(0,Ot.CM)(t,e,16,16,{offset:i})}var be=i(35925),Ce=i(89238),Oe=i(974),De=i(39612),Te=i(56119),Ae=i(13284),xe=i(61237),ze=i(14318),Ie=i(9730);let Re=class extends s.A{constructor(t){super(t),this._stagedDimension=null,this._computationManipulators=new Map,this._computationHandles=new se.A,this._orientationManipulatorTexture=null,this._updatingHandles=new ce.U,this._getSnappingContext=(0,re.B)((t=>new Ae.e({elevationInfo:{mode:"absolute-height",offset:0},pointer:t,editGeometryOperations:new De.p(new Oe.ZE("point",(0,Ce.BV)(!0,!1,this.view.spatialReference))),visualizer:new pe.s})));const{view:e}=t;this._snappingManagerResult=(0,Te.X)(e),this.addHandles(this._snappingManagerResult),this._unfocusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._focusedOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial=this._createOffsetManipulatorMaterial(),this._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,be.wk)(2)}),this._constraintSnappingIndicator=new he.t({view:e,attached:!0,width:1,renderOccluded:Dt.m$.OccludeAndTransparent,stipplePattern:(0,be.wk)(5),isDecoration:!0});const i=lt.A.toUnitRGBA(vt);this._stagedStartIndicator=new Se({view:e,attached:!1,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:t.view.renderCoordsHelper.spatialReference,color:i,size:10,outlineSize:0,renderOccluded:Dt.m$.OccludeAndTransparent,isDecoration:!0})}initialize(){var t;const{view:e}=this;this._snappingOperation=new ze.O({view:e});const i=!(null!==(t=e._stage)&&void 0!==t&&t.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result);this._orientationManipulatorMaterial=new At.r({transparent:!0,writeDepth:!1,renderOccluded:Dt.m$.Opaque,isDecoration:!0}),this.addHandles((0,c.wB)((()=>({accentColor:mt(e.effectiveTheme),contrastColor:gt(e.effectiveTheme)})),(t=>{let{accentColor:n,contrastColor:a}=t;const s=this._orientationManipulatorTexture,o=(0,de.t)(e.textures,{accentColor:n,contrastColor:a,preMultiplyAlpha:i});this._orientationManipulatorMaterial.setParameters({textureId:o.texture.id}),this._orientationManipulatorTexture=o,null===s||void 0===s||s.release();const r=lt.A.toUnitRGBA(n);this._unfocusedOffsetManipulatorMaterial.setParameters({color:r}),this._focusedOffsetManipulatorMaterial.setParameters({color:r}),this._thinOffsetManipulatorMaterial.setParameters({color:r}),this._constraintSnappingIndicator.color=r}),c.Vh));const n=(0,c.LF)((()=>this.analysisViewData.computations),(t=>{let{computation:e}=t;return this._createManipulators(e)}));this.addHandles((0,o.DQ)(n)),this.addHandles([(0,c.wB)((()=>({stagedPoint:this._snappingOperation.stagedPoint,stagedComputation:this._stagedComputation})),(t=>{let{stagedPoint:e,stagedComputation:i}=t;if(null==i||null==e)return;const n=(0,C.EL)(e,new Rt.A);this._applyPointUpdate(i,{endPoint:n})}),c.OH),(0,c.wB)((()=>({stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator})),((t,e)=>{const{stagedDimension:i,selectedComputation:n,firstGrabbedManipulator:a}=t;if(i===(null===e||void 0===e?void 0:e.stagedDimension)&&a===(null===e||void 0===e?void 0:e.firstGrabbedManipulator)){for(const s of[n,null===e||void 0===e?void 0:e.selectedComputation])if(null!=s){const e=this._computationManipulators.get(s);null!=e&&this._updateManipulators(s,e,t)}}else for(const[s,o]of this._computationManipulators)this._updateManipulators(s,o,t)}),c.pc),(0,c.wB)((()=>this.analysis.style.lineSize),(t=>{this._updateManipulatorStyle(t)}),c.Vh),(0,c.wB)((()=>this.view.state.camera),(()=>{null!=this._stagedComputation&&this._updateStagedDimensionOffset(this._stagedComputation)})),(0,c.wB)((()=>{const t=this._stagedComputation;if(!t)return null;const e=t.elevationAlignedStartPoint,i=(0,S.vt)();return null!=e&&this.view.renderCoordsHelper.toRenderCoords(e,i)?i:null}),(t=>{null!=t?(this._stagedStartIndicator.vertices=[t],this._stagedStartIndicator.attached=!0):this._stagedStartIndicator.attached=!1}))]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),(0,Ie.BY)(this,(()=>{const t=this._activeComputation,e=this._stagedComputation;if(null==t||null!=e){var i;const t=null!==(i=this.view.inputManager.latestPointerType)&&void 0!==i?i:"mouse",e=this._getSnappingContext(t);this._updatingHandles.addPromise((0,le.QZ)(this._snappingOperation.snapAgainNearPreviousMapPoint(this._snappingManager,e)))}if(null!=t){const{start:e,end:i}=this._computationManipulators.get(t);if(e.grabbing||i.grabbing){!function(t,e,i){let{constraint:n,view:a}=i;const{unconstrainedGeometry:s}=t;if(null==s)return;const{renderCoordsHelper:o,spatialReference:r}=a,{startRenderSpace:l,endRenderSpace:c}=s.directSegment,u=o.fromRenderCoords(l,new Rt.A({spatialReference:r})),d=o.fromRenderCoords(c,new Rt.A({spatialReference:r}));let p;p="start"===e?{startPoint:u}:{endPoint:d},ue(t,p,{constraint:n,elevationAlignedStartPoint:t.elevationAlignedStartPoint,elevationAlignedEndPoint:t.elevationAlignedEndPoint,unconstrainedGeometry:s,view:a})}(t,e.grabbing?"start":"end",{constraint:this._computeConstraint(t),view:this.view})}}}))}destroy(){var t;this._snappingOperation=(0,l.pR)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),null===(t=this._orientationManipulatorTexture)||void 0===t||t.release()}get updating(){return this._updatingHandles.updating||this._snappingManager.updating}get firstGrabbedManipulator(){return this.parentTool.firstGrabbedManipulator}get hasGrabbedManipulators(){return this.parentTool.hasGrabbedManipulators}get snappingOptions(){return this._snappingManager.options}get _snappingManager(){return this._snappingManagerResult.snappingManager}get _activeComputation(){if(null!=this._stagedComputation)return this._stagedComputation;const{selectedComputation:t}=this.analysisViewData;return this.hasGrabbedManipulators&&null!=t?t:null}get _stagedComputation(){var t;const e=this._stagedDimension,i=null===(t=this.analysisViewData.computations.at(-1))||void 0===t?void 0:t.computation;return null==e||null==i||i.dimension!==e?null:i}get _constraintHandles(){return[(0,c.z7)((()=>this.analysisViewData.selectedComputation),(t=>{t.previousConstraint=this._computeConstraint(t)}),{...c.pc,equals:oe.aI}),(0,c.wB)((()=>{const t=this._activeComputation;if(null==t)return null;const{measureType:e,orientation:i}=t.dimension;return{measureType:e,orientation:i,computation:t}}),((t,e)=>{if(null!=t&&null==e){const{measureType:e,orientation:i,computation:n}=t;switch(n.previousConstraint){case ne.Horizontal:n.preConstraintProperties={measureType:h.L.Horizontal,orientation:0};break;case ne.Vertical:n.preConstraintProperties={measureType:h.L.Vertical,orientation:0};break;case ne.Direct:n.preConstraintProperties={measureType:h.L.Direct,orientation:i};break;default:n.preConstraintProperties={measureType:e,orientation:i}}}null==t&&null!=e&&(e.computation.preConstraintProperties=null)}),c.OH)]}get _snappingIndicatorHandles(){const t="snapping-indicator-event-handles";return[(0,c.wB)((()=>({stagedComputation:this._stagedComputation,activeComputation:this._activeComputation})),(e=>{let{stagedComputation:i,activeComputation:n}=e;const a=this._constraintSnappingIndicator;if(this.removeHandles(t),null!=n)if(n===i)a.attached=!0;else{const{start:e,end:i}=this._computationManipulators.get(n),s=()=>{a.attached=e.grabbing||i.grabbing};s(),this.addHandles([e.events.on("grab-changed",s),i.events.on("grab-changed",s)],t)}else a.attached=!1})),(0,c.wB)((()=>{const t=this._activeComputation;return null!=t?{geometry:t.geometry,constraint:t.previousConstraint}:{}}),(t=>{let{geometry:e,constraint:i}=t;const n=this._constraintSnappingIndicator;null!=e&&null!=i&&i!==ne.Direct?(n.visible=!0,n.setGeometryFromSegment(e.directSegment)):n.visible=!1}))]}removeStaged(){return null!=this._stagedDimension&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}onDeactivate(){this.removeStaged(),this._resetSnappingState()}onClick(t){const{_stagedDimension:e}=this;if(null==e){const e=this._onUnstagedClick(t);return this.analysis.dimensions.add(e),null}return this._onStagedClick(t),e}onPointerMove(t){let{mapPoint:e,pointerType:i}=t;if("touch"===i)return;const n=this._getSnappingContext(i);this._updatingHandles.addPromise((0,le.QZ)(this._snappingOperation.snap({point:e},this._snappingManager,n)))}onManipulatorSelectionChanged(){null!=this.analysisViewData.selectedComputation&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}_onUnstagedClick(t){let{mapPoint:e,pointerType:i}=t,n=e;if("mouse"===i){const t=this._getSnappingContext(i);n=this._snappingManager.update({point:e,context:t})}const a=new ae.A({startPoint:(0,C.EL)(n,new Rt.A),endPoint:null,measureType:h.L.Horizontal});return this._stagedDimension=a,this._resetSnappingState(),a}_onStagedClick(t){let{mapPoint:e,pointerType:i}=t;const n=this._stagedComputation;if(null==n)return;let a=e;if("mouse"===i){const t=this._getSnappingContext(i);a=this._snappingManager.update({point:e,context:t})}const s=(0,C.EL)(a,new Rt.A);this._applyPointUpdate(n,{endPoint:s}),this._stagedDimension=null,this._resetSnappingState()}_resetSnappingState(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}_createManipulators(t){const e=this._setupPointManipulator(t,{isStart:!0}),i=this._setupPointManipulator(t,{isStart:!1}),n=this._setupOffsetManipulator(t),a=this._setupHeadingManipulator(t),s=this._setupRotationManipulator(t),o=this._setupMeasureTypeManipulator(t,h.L.Direct),r=this._setupMeasureTypeManipulator(t,h.L.Horizontal),l=this._setupMeasureTypeManipulator(t,h.L.Vertical),c=new Ht({start:e,end:i,offset:n,heading:a,rotation:s,direct:o,horizontal:r,vertical:l});return this._setupComputationToManipulatorsSync(t,c),this._computationManipulators.set(t,c),this.manipulators.addMany(c.values()),{manipulators:c,remove:()=>{this._computationHandles.remove(t),this._computationManipulators.delete(t);for(const t of c.values())this.manipulators.remove(t)}}}_setupComputationToManipulatorsSync(t,e){this._computationHandles.add([(0,c.wB)((()=>t.geometry),(()=>this._updateManipulators(t,e)),{...c.pc,equals:oe.aI})],t)}_setupPointManipulator(t,e){const{view:i}=this,{dimension:n}=t,a=new Lt(i,{metadata:n}),s=function(t,e){let{isStart:i,createSnappingPipelineStep:n,dimension:a,onUpdate:s,view:o}=e;const r=i?"startPoint":"endPoint",l=(0,zt.Xt)(t,((t,e,i,l)=>{const c=(0,wt.z7)(t),{snappingStep:u,cancelSnapping:d}=n(l);i=i.next(c).next((0,zt.VG)(a,[r,"measureType","orientation"])).next(d),e.next(c).next((0,wt.xk)(o)).next(...u).next((t=>{const e=(0,C.EL)(t.mapEnd,new Rt.A);s("startPoint"===r?{startPoint:e}:{endPoint:e})}))}));return[l]}(a,{isStart:e.isStart,createSnappingPipelineStep:t=>(0,xe.L)({snappingContext:this._getSnappingContext(t),snappingManager:this._snappingManager,updatingHandles:this._updatingHandles}),dimension:n,onUpdate:e=>this._applyPointUpdate(t,e),view:i});return this._computationHandles.add(s,t),a}_setupOffsetManipulator(t){const{view:e}=this,i=function(t,e){const i=[(0,S.fA)(-.5,0,0),(0,S.fA)(.5,0,0)],n=(0,Ot.Z8)(e.unfocusedMaterial,i.map((t=>(0,M.h)((0,S.vt)(),t,.5)))),a=n.instantiate({material:e.focusedMaterial});return new yt.q({view:t,renderObjects:[new St.M(n,It.p7.Unfocused|It.p7.Selected|Jt),new St.M(a,It.p7.Focused|Jt)],collisionType:{type:"line",paths:[i]},radius:$t(e.lineSizePt)/2,metadata:e.metadata,available:!1,...Mt.MO})}(e,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:t.dimension}),n=function(t,e){let{computation:i,view:n}=e;return[(0,zt.Xt)(t,((t,e,a)=>{if(!st(i)||!t.selected)return;const{geometry:s,dimension:o}=i,r=(0,wt.z7)(t);e.next(r).next(Gt(n,o,s.dimensionSegment,s.primaryOffsetAxis)),a.next(r).next((0,zt.VG)(o,["offset"]))}))]}(i,{computation:t,view:e});return this._computationHandles.add(n,t),i}_setupHeadingManipulator(t){const{view:e}=this,i=new Et(e,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:t.dimension}),n=function(t,e){let{computation:i,view:n}=e;return[(0,zt.Xt)(t,((t,e,a)=>{Nt({cancel:a,computation:i,settingHeading:!0,steps:e,view:n})}))]}(i,{computation:t,view:e});return this._computationHandles.add(n,t),i}_setupRotationManipulator(t){const{view:e}=this,i=new Et(e,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:t.dimension}),n=kt(i,{computation:t,view:e});return this._computationHandles.add(n,t),i}_setupMeasureTypeManipulator(t,e){const{view:i}=this,n=function(t,e){const i=[(0,S.fA)(-.5,0,0),(0,S.fA)(.5,0,0)],n=(0,Ot.Z8)(e.thinOffsetManipulatorMaterial,i),a=(0,Ot.Z8)(e.unfocusedMaterial,i.map((t=>(0,M.h)((0,S.vt)(),t,.5)))),s=a.instantiate({material:e.focusedMaterial});return new yt.q({view:t,renderObjects:[new St.M(a,It.p7.Unfocused|Jt),new St.M(s,It.p7.Focused|Jt),new St.M(n,Jt)],collisionType:{type:"line",paths:[i]},radius:$t(e.lineSizePt)/2,available:!1,metadata:e.metadata,...Mt.MO})}(i,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:t.dimension}),a=Vt(n,{computation:t,manipulatorMeasureType:e,view:i});return this._computationHandles.add(a,t),n}_updateManipulators(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator};const{stagedDimension:n,selectedComputation:a,firstGrabbedManipulator:s}=i,{start:o,end:r,offset:l,heading:c,rotation:u}=e,d=a===t,p=st(t),{dimension:m}=t;for(const h of e.values()){const t=p&&null==n&&(null==s||h===s);h===l?(h.available=t,h.selected=d):h.available=t&&d}if(!p)return;null!=this._computeConstraint(t)?e.forEachMeasureTypeManipulator((t=>t.available=!1)):e.manipulatorForMeasureType(m.measureType).available=!1;for(const _ of[c,u])m.measureType===h.L.Direct&&0!==m.offset||(_.available=!1);Q(t)?u.available=!1:c.available=!1;const{geometry:g}=t;o.renderLocation=g.directSegment.startRenderSpace,r.renderLocation=g.directSegment.endRenderSpace;const{renderCoordsHelper:v}=this.view;(function(t,e,i){const{dimensionSegment:n,primaryOffsetAxis:a}=e,s=et(Kt,e),o=(0,M.j)(s,S.uY)?(0,f.D_)(ee):(0,Mt.wQ)(s,a,S.uY,ee),r=Math.max((0,M.l)(s),.1/i.unitInMeters);(0,f.hs)(o,o,(0,M.s)(Kt,r,r,r)),t.modelTransform=o,t.renderLocation=n.eval(.5,Kt)})(l,g,v),c.available&&function(t,e,i){Bt(t,e,i,{forHeading:!0})}(c,t,v),u.available&&function(t,e,i){Bt(t,e,i,{forHeading:!1})}(u,t,v),e.forEachMeasureTypeManipulator(((e,i)=>{e.available&&function(t,e,i,n){const{geometry:a}=e,s=F(ie,i,e,n),o=X(Kt,{measureType:i,directSegment:a.directSegment,renderCoordsHelper:n}),r=(0,M.z)(te,s.endRenderSpace,s.startRenderSpace),l=(0,Mt.wQ)(r,o,S.uY,ee),c=(0,M.l)(r);(0,f.hs)(l,l,(0,M.s)(te,c,c,c)),t.modelTransform=l,t.renderLocation=s.eval(.5,te)}(e,t,i,v)}))}_updateManipulatorStyle(t){const e=function(t){return(0,ut.Lz)(t)+4}(t),i=$t(t),n={lineSizePt:t,material:this._orientationManipulatorMaterial};for(const{offset:a,heading:s,rotation:o}of this._computationManipulators.values())a.radius=i/2,s.update(n),o.update(n);this._unfocusedOffsetManipulatorMaterial.setParameters({width:e}),this._focusedOffsetManipulatorMaterial.setParameters({width:i})}_applyPointUpdate(t,e){const{view:i}=this,n=j(t);"startPoint"in e&&(n.elevationAlignedStartPoint=e.startPoint),"endPoint"in e&&(n.elevationAlignedEndPoint=e.endPoint);const a=B(n,i.renderCoordsHelper);if(null==a)return;const s=this._computeConstraint({...n,geometry:a});ue(t,e,{...n,constraint:s,unconstrainedGeometry:a,view:i}),t===this._stagedComputation&&this._updateStagedDimensionOffset(t)}_updateStagedDimensionOffset(t){if(null==t.geometry)return;t.geometry.directSegment.eval(.5,He);const e=this.view.state.camera.computeScreenPixelSizeAt(He);t.dimension.offset=50*e}_computeConstraint(t){return function(t,e){if(at(t))return ne.Direct;if(!t.enabled)return null;const{geometry:i}=t;if(null==i||(0,M.j)(i.directSegment.startRenderSpace,i.directSegment.endRenderSpace))return null;const{camera:n}=e.state,a=K(P.rq.get(),i,e.renderCoordsHelper),s=tt(P.rq.get(),i),o=(0,M.h)(P.rq.get(),a,(0,M.k)(s,a)),r=(0,M.f)(P.rq.get(),s,o),l=(0,M.p)(r),c=(0,M.p)(o),{startRenderSpace:u,endRenderSpace:d}=i.directSegment,p=Math.max(10*n.computeScreenPixelSizeAt(u),10*n.computeScreenPixelSizeAt(d))**2;return l<p?ne.Vertical:c<p?ne.Horizontal:null}(function(t,e){return{enabled:e.effectiveFeatureEnabled,elevationAlignedStartPoint:t.elevationAlignedStartPoint,elevationAlignedEndPoint:t.elevationAlignedEndPoint,geometry:t.geometry}}(t,this._snappingManager.options),this.view)}_createOffsetManipulatorMaterial(){return new xt.W({width:1,renderOccluded:Dt.m$.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0,isDecoration:!0})}get testInfo(){const t=t=>{var e;return null===(e=this.analysisViewData.computations.find((e=>{let{computation:i}=e;return i.dimension===t})))||void 0===e?void 0:e.computation};return{disableManipulatorPartialOcclusion:()=>{this._stagedStartIndicator.renderOccluded=Dt.m$.Occlude,this.manipulators.forEach((t=>{let{manipulator:e}=t;for(const{geometry:i}of e.renderObjects)i.material.setParameters({renderOccluded:Dt.m$.Occlude})}))},getManipulatorsForDimension:e=>this._computationManipulators.get(t(e)),getComputationForDimension:e=>t(e),getConstraintForDimension:e=>{const i=t(e);return null!=i?this._computeConstraint(i):null},stagedDimension:this._stagedDimension,stagedStartIndicator:this._stagedStartIndicator,constraintSnappingIndicator:this._constraintSnappingIndicator,snappingManager:this._snappingManager}}};(0,a._)([(0,u.MZ)({constructOnly:!0})],Re.prototype,"analysis",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0})],Re.prototype,"analysisViewData",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0})],Re.prototype,"manipulators",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0})],Re.prototype,"parentTool",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],Re.prototype,"view",void 0),(0,a._)([(0,u.MZ)({readOnly:!0})],Re.prototype,"updating",null),(0,a._)([(0,u.MZ)()],Re.prototype,"firstGrabbedManipulator",null),(0,a._)([(0,u.MZ)()],Re.prototype,"hasGrabbedManipulators",null),(0,a._)([(0,u.MZ)()],Re.prototype,"snappingOptions",null),(0,a._)([(0,u.MZ)()],Re.prototype,"_stagedDimension",void 0),(0,a._)([(0,u.MZ)()],Re.prototype,"_activeComputation",null),(0,a._)([(0,u.MZ)()],Re.prototype,"_stagedComputation",null),Re=(0,a._)([(0,d.$)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],Re);const He=(0,S.vt)();var Le,Ee=i(5109),Ze=i(82307),ke=i(46576),Ne=i(11500);!function(t){t.Ready="ready",t.Creating="creating",t.Created="created"}(Le||(Le={}));let Ve=class extends Ee.k{constructor(t){super(t),this.automaticManipulatorSelection=!1,this.removeIncompleteOnCancel=!1,this._pointerMoveTimerMs=2500,this._prevPointerMoveTimeout=null}initialize(){this._intersector=(0,ke.T)(this.view.state.viewingMode),this._lengthDimensionSubTool=new Re({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,o.DQ)(this._lengthDimensionSubTool),(0,o.hA)((()=>this._clearPointerMoveTimeout())),(0,c.wB)((()=>this.state),(t=>{t===Le.Created&&this.finishToolCreation()}),c.pc),(0,c.z7)((()=>this.firstGrabbedManipulator),(t=>{this.selectedDimension=t.metadata}),c.pc),(0,c.wB)((()=>this.selectedDimension),(()=>this._resetPointerMoveTimeout()),c.pc)])}get state(){return this.analysis.dimensions.some((t=>"length"===t.type))?null!=this._activeSubTool?Le.Creating:Le.Created:Le.Ready}get updating(){return this._lengthDimensionSubTool.updating}get cursor(){return this.active?"crosshair":null}get selectedDimension(){return this.analysisViewData.selectedDimension}set selectedDimension(t){this.analysisViewData.selectedDimension=t}onInputEvent(t){switch(t.type){case"immediate-click":this._clickHandler(t);break;case"immediate-double-click":this._doubleClickHandler(t);break;case"pointer-move":this._pointerMoveHandler(t);break;case"key-down":if(Ze.NE.cancel===t.key){if(null!=this._activeSubTool&&this._activeSubTool.removeStaged())return void t.stopPropagation();this.active||(this.selectedDimension=null)}else Ze.NE.delete.includes(t.key)&&this._deleteKeyHandler()}}onActivate(){this._activeSubTool=this._lengthDimensionSubTool}onDeactivate(){null!=this._activeSubTool&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}onShow(){this._resetPointerMoveTimeout()}onManipulatorSelectionChanged(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}onHide(){this.selectedDimension=null}_clickHandler(t){if(this.hasFocusedManipulators)return void t.stopPropagation();if(null==this._activeSubTool)return;const e=this._intersectScreen(t);null!=e&&(this.selectedDimension=this._activeSubTool.onClick({mapPoint:e,pointerType:t.pointerType}),t.stopPropagation())}_doubleClickHandler(t){this.active&&(this.view.activeTool=null,t.stopPropagation())}_pointerMoveHandler(t){if(this._resetPointerMoveTimeout(),null==this._activeSubTool)return;if(this.hasFocusedManipulators)return;const e=this._intersectScreen(t);null!=e&&this._activeSubTool.onPointerMove({mapPoint:e,pointerType:t.pointerType})}_deleteKeyHandler(){null!=this._activeSubTool&&this._activeSubTool.removeStaged(),this._removeSelected()}_intersectScreen(t){const e=(0,Ne.sC)(t);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(e,this._intersector);const i=this._intersector.results.min,n=P.rq.get();return i.getIntersectionPoint(n)?this.view.renderCoordsHelper.fromRenderCoords(n,new Rt.A({spatialReference:this.view.spatialReference})):null}_removeSelected(){null!=this.selectedDimension&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout=(0,l.xt)(this._prevPointerMoveTimeout)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.manipulators.forEach((t=>t.manipulator.state|=Jt)),this._prevPointerMoveTimeout=rt.p.setTimeout((()=>{this.manipulators.forEach((t=>t.manipulator.state&=~Jt))}),this._pointerMoveTimerMs)}get testInfo(){return{...this._lengthDimensionSubTool.testInfo,setManipulatorAutoHideDelay:t=>{this._pointerMoveTimerMs=t,this._resetPointerMoveTimeout()}}}};(0,a._)([(0,u.MZ)({constructOnly:!0})],Ve.prototype,"view",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0})],Ve.prototype,"analysis",void 0),(0,a._)([(0,u.MZ)({readOnly:!0})],Ve.prototype,"state",null),(0,a._)([(0,u.MZ)({readOnly:!0})],Ve.prototype,"updating",null),(0,a._)([(0,u.MZ)({readOnly:!0})],Ve.prototype,"cursor",null),(0,a._)([(0,u.MZ)({constructOnly:!0})],Ve.prototype,"analysisViewData",void 0),(0,a._)([(0,u.MZ)()],Ve.prototype,"selectedDimension",null),(0,a._)([(0,u.MZ)()],Ve.prototype,"automaticManipulatorSelection",void 0),(0,a._)([(0,u.MZ)()],Ve.prototype,"_activeSubTool",void 0),(0,a._)([(0,u.MZ)()],Ve.prototype,"_lengthDimensionSubTool",void 0),Ve=(0,a._)([(0,d.$)("esri.views.3d.analysis.Dimension.DimensionTool")],Ve);i(11265);var Ge=i(11113),je=i(11020),Be=i(28608),Ue=i(70667),Fe=i(60561);class We extends ge.X{constructor(t,e){super(t),this._hasExternalMaterial=!1,this._renderOccluded=Dt.m$.OccludeAndTransparent,this._width=1,this._color=(0,Be.fA)(1,0,1,1),this._placement="end",this._markerPrimitive="arrow",this._material=e,this._hasExternalMaterial=null!=e,this.applyProperties(t)}setGeometryFromSegment(t,e){const i=t.endRenderSpace;this.transform=(0,f.kN)(Ye,i),this._normal=e;const{points:n}=t.createRenderGeometry(i,this.view.renderCoordsHelper);this.geometry=[n]}get renderOccluded(){return null!=this._material?this._material.parameters.renderOccluded:this._renderOccluded}set renderOccluded(t){this._renderOccluded=t,null!=this._material&&this._material.setParameters({renderOccluded:t})}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.recreateGeometry()}get normal(){return this._normal}set normal(t){this._normal=t,this.recreateGeometry()}get width(){return null!=this._material?this._material.parameters.width:this._width}set width(t){this._width=t,null!=this._material&&this._material.setParameters({width:t})}get color(){return null!=this._material?this._material.parameters.color:this._color}set color(t){this._color=(0,Be.o8)(t),null!=this._material&&this._material.setParameters({color:this._color})}get placement(){return null!=this._material?this._material.parameters.placement:this._placement}set placement(t){this._placement=t,null!=this._material&&this._material.setParameters({placement:this._placement})}get markerPrimitive(){var t,e;return null!==(t=null===(e=this._material)||void 0===e?void 0:e.parameters.markerPrimitive)&&void 0!==t?t:this._markerPrimitive}set markerPrimitive(t){this._markerPrimitive=t,null!=this._material&&this._material.setParameters({markerPrimitive:t})}createExternalResources(){this._hasExternalMaterial||(this._material=new Fe.i({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,markerPrimitive:this._markerPrimitive,isDecoration:this.isDecoration}))}destroyExternalResources(){this._hasExternalMaterial||(this._material=null)}createGeometries(t){for(const e of(0,Ue.z)(this.geometry,this.normal)){const i=(0,Ue.t)(this._material,e);t.addGeometry(i)}}forEachExternalMaterial(t){this._hasExternalMaterial||t(this._material)}}const Ye=(0,y.vt)();class qe{set visible(t){for(const e of this._visualElements.values())e.attached=t}constructor(t){this.destroyed=!1,this._handles=new se.A,this._messages=null,this._labelSegment=new O.C;const{analysis:e,computation:i,view:n,messages:a,isDecoration:s}=t;this.analysis=e,this.computation=i,this.view=n,this._messages=a;const o=t.visible,r={view:n,attached:o,isDecoration:s},{fontSize:l,textColor:u,textBackgroundColor:d}=e.style;this._visualElements=new Je({marker:new We(r,t.markerMaterial),dimension:new he.t(r,t.dimensionLineMaterial),startOffset:new he.t(r,t.offsetLineMaterial),endOffset:new he.t(r,t.offsetLineMaterial),dimensionSmall:new he.t(r,t.smallDimensionLineMaterial),startOffsetSmall:new he.t(r,t.smallOffsetLineMaterial),endOffsetSmall:new he.t(r,t.smallOffsetLineMaterial),label:new je.N({view:n,attached:o,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,ut.Lz)(l),textColor:u.clone(),backgroundColor:d.clone(),isDecoration:s})}),this._handles.add([(0,c.wB)((()=>i.geometry),(t=>{this.updateCameraDependentElements(n.state.camera,t,e.style),null!=i.geometry&&this._updateLines(i.geometry)}),{...c.Vh,equals:oe.aI}),(0,c.wB)((()=>i.length),(t=>this._updateLabelContent(t)),c.Vh)])}destroy(){this.destroyed=!0,this._handles=(0,l.pR)(this._handles);for(const t of this._visualElements.values())t.destroy()}get testInfo(){return{dimensionVisualElement:this._visualElements.dimension,label:this._visualElements.label}}_updateLines(t){const e=U(Xe,V.Start,t.directSegment,t.dimensionSegment),i=U($e,V.End,t.directSegment,t.dimensionSegment),n=this._visualElements;n.marker.setGeometryFromSegment(t.dimensionSegment,t.primaryOffsetAxis),n.dimension.setGeometryFromSegment(t.dimensionSegment),n.startOffset.setGeometryFromSegment(e),n.endOffset.setGeometryFromSegment(i),n.dimensionSmall.setGeometryFromSegment(t.dimensionSegment),n.startOffsetSmall.setGeometryFromSegment(e),n.endOffsetSmall.setGeometryFromSegment(i)}updateCameraDependentElements(t,e,i){const n=this._visualElements;if(null==e){for(const t of n.values())t.visible=!1;return}const a=t.computeScreenPixelSizeAt(e.dimensionSegment.eval(.5,Qe)),s=function(t,e){return(0,M.p)(et(nt,t))/e**2}(e,a),o=s<(2*(0,ut.Lz)(i.lineSize))**2,r=!o;n.marker.visible=r,n.dimension.visible=r,n.startOffset.visible=r,n.endOffset.visible=r,n.dimensionSmall.visible=o,n.startOffsetSmall.visible=o,n.endOffsetSmall.visible=o;const l=5*(0,ut.Lz)(i.fontSize),{label:c}=n;if(c.visible=s>=l**2,!c.visible)return;const{dimensionSegment:u,primaryOffsetAxis:d}=e,{offset:p}=this.computation.dimension,h=(Math.sign(p)>=0?1:-1)*this._labelOffsetPx(i)*a;(function(t,e,i,n){(0,M.r)(t.startRenderSpace,e.startRenderSpace,i,n),(0,M.r)(t.endRenderSpace,e.endRenderSpace,i,n)})(this._labelSegment,u,d,h),c.updateLabelPosition()}updateLabelStyle(t){const{label:e}=this._visualElements;e.fontSize=(0,ut.Lz)(t.fontSize),e.textColor=t.textColor,e.backgroundColor=t.textBackgroundColor}updateUnitsMessages(t){this._messages=t;const{length:e}=this.computation;this._updateLabelContent(e)}_updateLabelContent(t){const{label:e}=this._visualElements;null!=t&&null!=this._messages?e.text=(0,Ge.zJ)(this._messages,t,t.unit):e.text=""}_labelOffsetPx(t){return 1.5*(0,ut.Lz)(t.fontSize)+20+(0,ut.Lz)(t.lineSize/2)}}const Xe=new O.C,$e=new O.C,Qe=(0,S.vt)();class Je{constructor(t){this.marker=t.marker,this.dimension=t.dimension,this.startOffset=t.startOffset,this.endOffset=t.endOffset,this.dimensionSmall=t.dimensionSmall,this.startOffsetSmall=t.startOffsetSmall,this.endOffsetSmall=t.endOffsetSmall,this.label=t.label}values(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}var Ke=i(50125),ti=i(38042),ei=i(63860);let ii=class extends s.A{get analysis(){return this.analysisViewData.analysis}get visible(){return this.analysisViewData.visible}constructor(t){super(t),this.loadingMessages=!1,this._messages=null}initialize(){const t=this.isDecoration;this._markerMaterial=new Fe.i({width:1,anchor:Ke.kJ.Tip,color:dt.uY,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:Dt.m$.OccludeAndTransparent,markerPrimitive:"triangle",isDecoration:t}),this._dimensionLineMaterial=new xt.W({width:1,color:dt.uY,renderOccluded:Dt.m$.OccludeAndTransparent,markerParameters:this._markerMaterial.parameters,isDecoration:t}),this._offsetLineMaterial=new xt.W({width:1,color:dt.uY,renderOccluded:Dt.m$.OccludeAndTransparent,stipplePattern:(0,be.wk)(5),isDecoration:t}),this._smallDimensionLineMaterial=new xt.W({width:1,color:dt.uY,renderOccluded:Dt.m$.OccludeAndTransparent,isDecoration:t}),this._smallOffsetLineMaterial=new xt.W({width:1,color:dt.uY,renderOccluded:Dt.m$.OccludeAndTransparent,stipplePattern:(0,be.wk)(5),isDecoration:t});for(const i of this._lineMaterials())this.view._stage.add(i),this.addHandles((0,o.hA)((()=>{var t;null===(t=this.view._stage)||void 0===t||t.remove(i)})));const e=(0,c.LF)((()=>this.analysisViewData.computations),(t=>{let{computation:e}=t;return this._createVisualization(e)}));this._dimensionVisualizations=e,this.addHandles([(0,o.DQ)(e),(0,c.wB)((()=>lt.A.toUnitRGBA(this.analysis.style.color)),(t=>{for(const e of this._lineMaterials())e.setParameters({color:t})}),c.pc),(0,c.wB)((()=>this.analysis.style.lineSize),(t=>{const e=(0,ut.Lz)(t);this._markerMaterial.setParameters({width:.8*e}),this._dimensionLineMaterial.setParameters({width:e,markerParameters:this._markerMaterial.parameters});const i=Math.max(.25*e,1);this._offsetLineMaterial.setParameters({width:i})}),c.pc),(0,c.wB)((()=>({camera:this.view.state.camera,style:ni(this.analysis)})),(t=>{let{camera:e,style:i}=t;for(const{visualization:n}of this._dimensionVisualizations)n.updateCameraDependentElements(e,n.computation.geometry,i),n.updateLabelStyle(i)})),(0,c.wB)((()=>this.visible),(t=>{for(const{visualization:e}of this._dimensionVisualizations)e.visible=t}))]),this.addHandles([(0,ti.oQ)((()=>this._updateMessageBundle())),(0,c.z7)((()=>!this.loadingMessages),(()=>{for(const{visualization:t}of this._dimensionVisualizations)t.updateUnitsMessages(this._messages)}),c.OH)]),this._updateMessageBundle()}get testInfo(){return{visualizations:this._dimensionVisualizations.items.map((t=>{let{visualization:e}=t;return e})),disablePartialOcclusion:()=>{for(const t of this._lineMaterials())t.setParameters({renderOccluded:Dt.m$.Occlude})}}}_createVisualization(t){const e=new qe({analysis:this.analysis,computation:t,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages,isDecoration:this.isDecoration});return{visualization:e,remove:()=>e.destroy()}}_lineMaterials(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}async _updateMessageBundle(){this.loadingMessages=!0;try{this._messages=await(0,ei.ud)("esri/core/t9n/Units")}finally{this.loadingMessages=!1}}};function ni(t){const{fontSize:e,lineSize:i,textColor:n,textBackgroundColor:a}=t.style;return{fontSize:e,lineSize:i,textBackgroundColor:a.clone(),textColor:n.clone()}}(0,a._)([(0,u.MZ)({constructOnly:!0})],ii.prototype,"analysisViewData",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],ii.prototype,"view",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0})],ii.prototype,"isDecoration",void 0),(0,a._)([(0,u.MZ)()],ii.prototype,"analysis",null),(0,a._)([(0,u.MZ)()],ii.prototype,"visible",null),(0,a._)([(0,u.MZ)()],ii.prototype,"loadingMessages",void 0),ii=(0,a._)([(0,d.$)("esri.views.3d.analysis.Dimension.DimensionVisualization")],ii);let ai=class extends s.A{constructor(t){super(t),this.dimension=null,this.length=null}};(0,a._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],ai.prototype,"dimension",void 0),(0,a._)([(0,u.MZ)()],ai.prototype,"length",void 0),ai=(0,a._)([(0,d.$)("esri.views.3d.analysis.LengthDimensionResult")],ai);const si=ai;let oi=class extends s.A{constructor(t){super(t),this.geometry=null,this.unconstrainedGeometry=null,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}normalizeCtorArgs(t){const{dimension:e,...i}=t;return{result:new si({dimension:e}),...i}}initialize(){this.addHandles([(0,c.wB)((()=>this.dimension.startPoint),(t=>this.elevationAlignedStartPoint=this.projectAndAlignPoint(t)),c.pc),(0,c.wB)((()=>this.dimension.endPoint),(t=>this.elevationAlignedEndPoint=this.projectAndAlignPoint(t)),c.pc)])}get dimension(){return this.result.dimension}get length(){return this.result.length}};(0,a._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],oi.prototype,"result",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],oi.prototype,"projectAndAlignPoint",void 0),(0,a._)([(0,u.MZ)()],oi.prototype,"dimension",null),(0,a._)([(0,u.MZ)()],oi.prototype,"length",null),(0,a._)([(0,u.MZ)()],oi.prototype,"geometry",void 0),(0,a._)([(0,u.MZ)()],oi.prototype,"unconstrainedGeometry",void 0),(0,a._)([(0,u.MZ)()],oi.prototype,"elevationAlignedStartPoint",void 0),(0,a._)([(0,u.MZ)()],oi.prototype,"elevationAlignedEndPoint",void 0),(0,a._)([(0,u.MZ)()],oi.prototype,"preConstraintProperties",void 0),(0,a._)([(0,u.MZ)()],oi.prototype,"previousConstraint",void 0),oi=(0,a._)([(0,d.$)("esri.views.3d.analysis.LengthDimensionComputation")],oi);var ri=i(17430),li=i(10260),ci=i(19276);const ui=t=>{let e=class extends t{constructor(){super(...arguments),this.analysis=null,this.tool=null,this.selectedDimension=null,this.interactive=!1,this.visible=null}get results(){return new ci.A}createLengthDimensions(t){throw new Error("Method not implemented.")}};return(0,a._)([(0,u.MZ)({constructOnly:!0})],e.prototype,"view",void 0),(0,a._)([(0,u.MZ)({constructOnly:!0,nonNullable:!0})],e.prototype,"analysis",void 0),(0,a._)([(0,u.MZ)()],e.prototype,"tool",void 0),(0,a._)([(0,u.MZ)({readOnly:!0})],e.prototype,"results",null),(0,a._)([(0,u.MZ)()],e.prototype,"selectedDimension",void 0),(0,a._)([(0,u.MZ)()],e.prototype,"interactive",void 0),(0,a._)([(0,u.MZ)()],e.prototype,"visible",void 0),e=(0,a._)([(0,d.$)("esri.views.analysis.DimensionAnalysisView")],e),e};let di=class extends(ui((0,p.P)(s.A))){constructor(t){super(t),this.type="dimension-view-3d",this.tool=null,this.selectedDimension=null,this._dimensionsToComputations=new Map,this._placementTask=null,this._projectAndAlignPoint=null}initialize(){this._projectAndAlignPoint=t=>{if(null==t)return null;const{spatialReference:e,elevationProvider:i}=this.view,n=(0,ri.B)(t,e,i);return null==n&&(0,ri.V)(this.analysis,t.spatialReference,r.A.getLogger(this)),n};const t=(0,c.LF)((()=>this.analysis.dimensions),(t=>this._createComputation(t)));this.computations=t,this.addHandles([(0,li.Hd)(this,Ve),(0,o.DQ)(t)]),this._analysisVisualization=new ii({analysisViewData:this,view:this.view,isDecoration:!this.parent}),this._analysisController=new ot({analysisViewData:this,view:this.view})}destroy(){this._placementTask=(0,l.DC)(this._placementTask),this._analysisVisualization=(0,l.pR)(this._analysisVisualization),(0,li.aS)(this)}get updating(){var t,e;return null!==(t=null===(e=this._analysisVisualization)||void 0===e?void 0:e.loadingMessages)&&void 0!==t&&t}get results(){return this.analysis.dimensions.map((t=>this._dimensionsToComputations.get(t).result))}get selectedComputation(){const{selectedDimension:t}=this;return null==t?null:this._dimensionsToComputations.get(t)}get testInfo(){return{visualization:this._analysisVisualization,controller:this._analysisController}}async createLengthDimensions(t){return this.selectedDimension=null,this._placementTask=(0,l.DC)(this._placementTask),this._placementTask=(0,li.JY)(this,t),this._placementTask.promise}_createComputation(t){const{_dimensionsToComputations:e}=this,i=new oi({dimension:t,projectAndAlignPoint:this._projectAndAlignPoint});return e.set(t,i),{computation:i,remove:()=>this._removeComputation(i)}}_removeComputation(t){const{dimension:e}=t;e===this.selectedDimension&&(this.selectedDimension=null),this._dimensionsToComputations.delete(e),t.destroy()}};(0,a._)([(0,u.MZ)({readOnly:!0})],di.prototype,"type",void 0),(0,a._)([(0,u.MZ)()],di.prototype,"tool",void 0),(0,a._)([(0,u.MZ)()],di.prototype,"updating",null),(0,a._)([(0,u.MZ)({readOnly:!0})],di.prototype,"results",null),(0,a._)([(0,u.MZ)()],di.prototype,"computations",void 0),(0,a._)([(0,u.MZ)()],di.prototype,"selectedDimension",void 0),(0,a._)([(0,u.MZ)()],di.prototype,"selectedComputation",null),(0,a._)([(0,u.MZ)()],di.prototype,"_analysisVisualization",void 0),(0,a._)([(0,u.MZ)()],di.prototype,"_analysisController",void 0),(0,a._)([(0,u.MZ)()],di.prototype,"_dimensionsToComputations",void 0),(0,a._)([(0,u.MZ)()],di.prototype,"_placementTask",void 0),di=(0,a._)([(0,d.$)("esri.views.3d.analysis.DimensionAnalysisView3D")],di);const pi=di},59962:(t,e,i)=>{i.d(e,{t:()=>u,k:()=>d});const n="theme-style";function a(t,e){return function(t,e){const i=new Image(e,e);return i.src=t,i}(function(t){const e=(new XMLSerializer).serializeToString(t);return"data:image/svg+xml;base64,".concat(btoa(e))}(s(function(t){const e=t.split(",")[1],i=atob(e);return(new DOMParser).parseFromString(i,"image/svg+xml")}(t),e)),e.size)}function s(t,e){let{accentColor:i,contrastColor:a}=e;const s=i.toHex(),o=i.a,r=a.toHex(),l=a.a,c=t.getElementsByTagNameNS("http://www.w3.org/2000/svg","style").namedItem(n);return c&&(c.innerHTML="\n      .contrast-fill { fill: ".concat(r,"; fill-opacity: ").concat(l,"; }\n      .contrast-stroke { stroke: ").concat(r,"; stroke-opacity: ").concat(l,";  }\n      .accent-fill { fill: ").concat(s,"; fill-opacity: ").concat(o,"; }\n      .accent-stroke { stroke: ").concat(s,"; stroke-opacity:  ").concat(o,"; }")),t}const o="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxwYXRoIGQ9Ik0yOCAwYTI4IDI4IDAgMSAxIDAgNTYgMjggMjggMCAwIDEgMC01NiIgY2xhc3M9ImFjY2VudC1maWxsIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI0Ljk5IiBkPSJNMjAuMDUgNDAuODZhMTUuMDUgMTUuMDUgMCAwIDAgMTcuMTQtMS41IDE1LjA1IDE1LjA1IDAgMCAwIDQuNDctMTYuNjUgMTUuMDUgMTUuMDUgMCAwIDAtMjIuNzItNy4xNSAxNS4wNSAxNS4wNSAwIDAgMC01LjUgNy4xNSIgY2xhc3M9ImNvbnRyYXN0LXN0cm9rZSIvPjxwYXRoIGQ9Im0xMC45NyAzNS41NyA1LjM4IDEyLjA3IDcuNzktMTMuNDd6IiBjbGFzcz0iY29udHJhc3QtZmlsbCIvPjwvc3ZnPg==",r="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSIgdmVyc2lvbj0iMi4wIj48c3R5bGUgaWQ9InRoZW1lLXN0eWxlIj4uY29udHJhc3QtZmlsbHtmaWxsOiNmZmZ9LmNvbnRyYXN0LXN0cm9rZXtzdHJva2U6I2ZmZn0uYWNjZW50LWZpbGx7ZmlsbDojZmY3ZjAwO2ZpbGwtb3BhY2l0eTouNX08L3N0eWxlPjxjaXJjbGUgY3g9IjM5LjQ3OCIgY3k9IjMuMDc4IiByPSIyOCIgY2xhc3M9ImFjY2VudC1maWxsIiB0cmFuc2Zvcm09InJvdGF0ZSg0MC41NDIpIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSI1IiBkPSJtNy4wNzQgMzAuMDUzIDI5LjM5NyAxMS45ODUtMy42NzMtMzMuNDkzIiBjbGFzcz0iY29udHJhc3Qtc3Ryb2tlIi8+PHBhdGggc3Ryb2tlLXdpZHRoPSIyLjk5NiIgZD0iTTI0LjUwNCAyMy4yMDdhMTEuOTggMTEuOTggMCAwIDAtOS44IDcuNTA3IiBjbGFzcz0iY29udHJhc3Qtc3Ryb2tlIGNvbnRyYXN0LWZpbGwiLz48cGF0aCBkPSJtMjkuODE4IDIyLjgwOC02LjE4NCA0LjYtLjU0MS04LjM2NHoiIGNsYXNzPSJjb250cmFzdC1maWxsIi8+PC9zdmc+";var l=i(96897);const c=64;function u(t,e){const{accentColor:i,contrastColor:n,preMultiplyAlpha:s}=e;return t.fromData("heading-rotate:[accent:".concat(i,",contrast:").concat(n,",size:").concat(c,"]"),(()=>new l.g(a(o,{accentColor:i,contrastColor:n,size:c}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:s})))}function d(t,e){const{accentColor:i,contrastColor:n,preMultiplyAlpha:s}=e;return t.fromData("tilt-rotate:[accent:".concat(i,",contrast:").concat(n,",size:").concat(c,"]"),(()=>new l.g(a(r,{accentColor:i,contrastColor:n,size:c}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:s})))}},77447:(t,e,i)=>{i.d(e,{r:()=>z});var n=i(88105),a=i(34981),s=i(83490),o=i(75803),r=i(45463),l=i(60322),c=i(77730),u=i(86994),d=i(66470),p=i(82809),h=i(86401),m=i(63928),g=i(52757),v=i(35143),_=(i(64839),i(16506)),f=i(42693),y=i(99415),M=i(28584),S=i(96643),w=i(10773),P=i(92656),b=i(29201),C=i(93345),O=i(57162);class D extends f.w{initializeProgram(t){return new M.B(t.rctx,D.shader.get().build(this.configuration),x)}_setPipelineState(t,e){const i=this.configuration,n=t===w.y.NONE,s=t===w.y.FrontFace;return(0,O.Ey)({blending:i.output!==a.V.Color&&i.output!==a.V.Alpha||!i.transparent?null:n?T:(0,l.ez)(t),culling:(0,O.Xt)(i.cullFace),depthTest:{func:(0,l.K_)(t)},depthWrite:n?i.writeDepth?O.kn:null:(0,l.XO)(t),colorWrite:O.wE,stencilWrite:i.hasOccludees?S.v0:null,stencilTest:i.hasOccludees?e?S.a9:S.qh:null,polygonOffset:n||s?null:(0,l.aB)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipeline(t){return t?this._occludeePipelineState:super.getPipeline()}}D.shader=new _.$(b.I,(()=>i.e(8391).then(i.bind(i,48391))));const T=(0,O.ox)(C.dn.ONE,C.dn.ONE_MINUS_SRC_ALPHA);class A extends P.E{constructor(){super(...arguments),this.output=a.V.Color,this.cullFace=s.s2.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=w.y.NONE,this.multipassEnabled=!1,this.cullAboveGround=!1,this.perspectiveInterpolation=!0}}(0,v._)([(0,y.W)({count:a.V.COUNT})],A.prototype,"output",void 0),(0,v._)([(0,y.W)({count:s.s2.COUNT})],A.prototype,"cullFace",void 0),(0,v._)([(0,y.W)()],A.prototype,"hasSlicePlane",void 0),(0,v._)([(0,y.W)()],A.prototype,"transparent",void 0),(0,v._)([(0,y.W)()],A.prototype,"enableOffset",void 0),(0,v._)([(0,y.W)()],A.prototype,"writeDepth",void 0),(0,v._)([(0,y.W)()],A.prototype,"hasOccludees",void 0),(0,v._)([(0,y.W)({count:w.y.COUNT})],A.prototype,"transparencyPassType",void 0),(0,v._)([(0,y.W)()],A.prototype,"multipassEnabled",void 0),(0,v._)([(0,y.W)()],A.prototype,"cullAboveGround",void 0),(0,v._)([(0,y.W)()],A.prototype,"perspectiveInterpolation",void 0),(0,v._)([(0,y.W)({constValue:!1})],A.prototype,"occlusionPass",void 0);const x=new Map([[d.r.POSITION,0],[d.r.UV0,2],[d.r.PERSPECTIVEDIVIDE,3]]);class z extends m.W{constructor(t){super(t,new H),this.supportsEdges=!0,this.produces=new Map([[c.N.OPAQUE_MATERIAL,t=>t===a.V.Highlight||(0,a.j8)(t)&&!this.parameters.transparent],[c.N.TRANSPARENT_MATERIAL,t=>(0,a.j8)(t)&&this.parameters.transparent&&this.parameters.writeDepth],[c.N.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,t=>(0,a.j8)(t)&&this.parameters.transparent&&!this.parameters.writeDepth],[c.N.DRAPED_MATERIAL,t=>(0,a.jS)(t)]]),this._vertexAttributeLocations=x,this._configuration=new A}getConfiguration(t,e){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=e.transparencyPassType,this._configuration.enableOffset=e.camera.relativeElevation<l.xt,this._configuration.multipassEnabled=e.multipassEnabled,this._configuration.cullAboveGround=e.multipassTerrain.cullAboveGround,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}createGLMaterial(t){return new I(t)}createBufferWriter(){const t=h.zK.clone();return this.parameters.perspectiveInterpolation&&t.f32(d.r.PERSPECTIVEDIVIDE),new R(t)}}class I extends o.m{constructor(t){super({...t,...t.material.parameters})}_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(D,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:t.hasOccludees}),this._updateParameters(t))}beginSlot(t){return this._output!==a.V.Color&&this._output!==a.V.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class R extends p.Z{write(t,e,i,a,s){for(const o of this.vertexBufferLayout.fields.keys()){const r=i.attributes.get(o);if(r)if(o===d.r.PERSPECTIVEDIVIDE){(0,u.vA)(1===r.size);const t=a.getField(o,n.Y$);t&&(0,g.uO)(r,t,s)}else(0,g.zC)(o,r,t,e,a,s)}}}class H extends r.qA{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=s.s2.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0,this.perspectiveInterpolation=!1}}},10260:(t,e,i)=>{i.d(e,{Hd:()=>l,JY:()=>r,aS:()=>c});var n=i(98773),a=i(30726),s=i(50346),o=i(68134);function r(t,e){t.interactive=!0;const{tool:i,view:r}=t;r.activeTool=i;let l=(0,s.u7)(e,(()=>{r.activeTool===i&&(r.activeTool=null)}));return(0,n.UT)((async t=>{await(0,o.C_)((()=>null==i||!i.active),t),l=(0,a.xt)(l)}),e)}function l(t,e){return(0,o.wB)((()=>t.interactive),(()=>function(t,e){t.interactive?function(t,e){c(t);const{view:i,analysis:n}=t,a=new e({view:i,analysis:n,analysisViewData:t});t.tool=a,i.tools.add(a)}(t,e):c(t)}(t,e)),o.pc)}function c(t){const{view:e,tool:i}=t;null!=i&&(e.tools.remove(i),t.tool=null)}},46576:(t,e,i)=>{i.d(e,{T:()=>s});var n=i(29808),a=i(3112);function s(t){const e=(0,n.hz)(t);return e.options.store=a.oH.MIN,e.options.hud=!1,e}},14318:(t,e,i)=>{i.d(e,{O:()=>u});var n=i(35143),a=i(91967),s=i(30726),o=i(50346),r=i(46053),l=(i(81806),i(76460),i(47249),i(85842)),c=i(59752);let u=class extends a.A{constructor(t){super(t),this.constrainResult=t=>t,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,o.sg)((async(t,e,i,n)=>{const a=this._frameTask;if(null==a)return;const s=await a.schedule((()=>e.snap({...t,context:i,signal:n})),n);s.valid&&await a.schedule((()=>{this.stagedPoint=s.apply(),t!==this._snapPoints&&null!=this._snapPoints&&(this.stagedPoint=e.update({...this._snapPoints,context:i}))}),n)}))}get stagedPoint(){return this._stagedPoint}set stagedPoint(t){this._stagedPoint=this.constrainResult(t)}initialize(){var t;const e="3d"===this.view.type?null===(t=this.view)||void 0===t||null===(t=t.resourceController)||void 0===t?void 0:t.scheduler:null;this._frameTask=null!=e?e.registerTask(c.W6.SNAPPING):c.nu}destroy(){this._abortController=(0,s.DC)(this._abortController),this._frameTask=(0,s.xt)(this._frameTask)}update(t,e,i){this._snapPoints=t;const{point:n,scenePoint:a}=t,s=e.update({point:n,scenePoint:a,context:i});return this.stagedPoint=s,s}async snap(t,e,i){const{point:n,scenePoint:a}=t;return this.stagedPoint=e.update({point:n,scenePoint:a,context:i}),this._snapPoints=t,null==this._abortController&&(this._abortController=new AbortController),this._snap(t,e,i,this._abortController.signal)}async snapAgainNearPreviousMapPoint(t,e){null!=this._snapPoints&&await this.snap(this._snapPoints,t,e)}abort(){this._abortController=(0,s.DC)(this._abortController),this._snapPoints=null}};(0,n._)([(0,r.MZ)({constructOnly:!0})],u.prototype,"view",void 0),(0,n._)([(0,r.MZ)()],u.prototype,"stagedPoint",null),(0,n._)([(0,r.MZ)()],u.prototype,"constrainResult",void 0),(0,n._)([(0,r.MZ)()],u.prototype,"_stagedPoint",void 0),u=(0,n._)([(0,l.$)("esri.views.interactive.snapping.SnappingOperation")],u)},41868:(t,e,i)=>{i.d(e,{l:()=>s});var n=i(9624),a=i(98510);function s(t){const e=(0,a.lO)(t),i=e===a.GD?a.Y0:e;return(0,n.canProjectWithoutEngine)(t,i)?i:t}}}]);
//# sourceMappingURL=7759.17da8e49.chunk.js.map